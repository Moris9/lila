!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.Chessground=e()}}(function(){var e;return function t(e,n,r){function o(i,c){if(!n[i]){if(!e[i]){var s="function"==typeof require&&require;if(!c&&s)return s(i,!0);if(a)return a(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[i]={exports:{}};e[i][0].call(u.exports,function(t){var n=e[i][1][t];return o(n?n:t)},u,u.exports,t,e,n,r)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,t){function n(e,t){var n=new o(t);return r.render(e,a(n)),i(n)}var r=e("mithril"),o=e("./ctrl"),a=e("./view"),i=e("./api");t.exports=n,t.exports.controller=o,t.exports.view=a,t.exports.fen=e("./fen"),t.exports.util=e("./util"),t.exports.configure=e("./configure"),t.exports.anim=e("./anim"),t.exports.board=e("./board"),t.exports.drag=e("./drag")},{"./anim":4,"./api":5,"./board":6,"./configure":7,"./ctrl":8,"./drag":10,"./fen":11,"./util":14,"./view":15,mithril:3}],2:[function(e,t){!function(e){function n(e,t){if("object"!==o(e))return t;for(var r in t)e[r]="object"===o(e[r])&&"object"===o(t[r])?n(e[r],t[r]):t[r];return e}function r(e,t,r){var i=r[0],c=r.length;(e||"object"!==o(i))&&(i={});for(var s=0;c>s;++s){var l=r[s],u=o(l);if("object"===u)for(var d in l){var f=e?a.clone(l[d]):l[d];i[d]=t?n(i[d],f):f}}return i}function o(e){return{}.toString.call(e).slice(8,-1).toLowerCase()}var a=function(e){return r(e===!0,!1,arguments)},i="merge";a.recursive=function(e){return r(e===!0,!0,arguments)},a.clone=function(e){var t,n,r=e,i=o(e);if("array"===i)for(r=[],n=e.length,t=0;n>t;++t)r[t]=a.clone(e[t]);else if("object"===i){r={};for(t in e)r[t]=a.clone(e[t])}return r},e?t.exports=a:window[i]=a}("object"==typeof t&&t&&"object"==typeof t.exports&&t.exports)},{}],3:[function(t,n){Mithril=m=new function r(e,t){function n(e){N=e.document,P=e.location,q=e.cancelAnimationFrame||e.clearTimeout,A=e.requestAnimationFrame||e.setTimeout}function o(){for(var e,t=[].slice.call(arguments),n=(!(null==t[1]||B.call(t[1])!=S||"tag"in t[1]||"subtree"in t[1])),r=n?t[1]:{},o=("class"in r?"class":"className"),a={tag:"div",attrs:{}},i=[];e=F.exec(t[0]);)if(""==e[1]&&e[2])a.tag=e[2];else if("#"==e[1])a.attrs.id=e[2];else if("."==e[1])i.push(e[2]);else if("["==e[3][0]){var c=K.exec(e[3]);a.attrs[c[1]]=c[3]||(c[2]?"":!0)}i.length>0&&(a.attrs[o]=i.join(" "));var s=n?t[2]:t[1];a.children=B.call(s)==D?s:t.slice(n?2:1);for(var l in r)a.attrs[l]=l==o?(a.attrs[l]||"")+" "+r[l]:r[l];return a}function a(e,n,r,o,s,d,f,p,h,v,g){if(null==s&&(s=""),"retain"===s.subtree)return d;var m=B.call(d),b=B.call(s);if(null==d||m!=b){if(null!=d)if(r&&r.nodes){var y=p-o,w=y+(b==D?s:d.nodes).length;c(r.nodes.slice(y,w),r.slice(y,w))}else d.nodes&&c(d.nodes,d);d=new s.constructor,d.tag&&(d={}),d.nodes=[]}if(b==D){s=u(s);for(var x=[],k=d.length===s.length,C=0,E=1,O=2,M=3,T={},j=[],P=!1,A=0;A<d.length;A++)d[A]&&d[A].attrs&&null!=d[A].attrs.key&&(P=!0,T[d[A].attrs.key]={action:E,index:A});if(P){for(var A=0;A<s.length;A++)if(s[A]&&s[A].attrs)if(null!=s[A].attrs.key){var q=s[A].attrs.key;T[q]=T[q]?{action:M,index:A,from:T[q].index,element:e.childNodes[T[q].index]||N.createElement("div")}:{action:O,index:A}}else j.push({index:A,element:e.childNodes[A]||N.createElement("div")});for(var F,K=Object.keys(T).map(function(e){return T[e]}),z=K.sort(function(e,t){return e.action-t.action||e.index-t.index}),X=d.slice(),A=0;F=z[A];A++){if(F.action==E&&(c(d[F.index].nodes,d[F.index]),X.splice(F.index,1)),F.action==O){var U=N.createElement("div");U.key=s[F.index].attrs.key,e.insertBefore(U,e.childNodes[F.index]||null),X.splice(F.index,0,{attrs:{key:s[F.index].attrs.key},nodes:[U]})}F.action==M&&(e.childNodes[F.index]!==F.element&&null!==F.element&&e.insertBefore(F.element,e.childNodes[F.index]||null),X[F.index]=d[F.from])}for(var A=0;A<j.length;A++){var F=j[A];e.insertBefore(F.element,e.childNodes[F.index]||null),X[F.index]=d[F.index]}d=X,d.nodes=[];for(var H,A=0;H=e.childNodes[A];A++)d.nodes.push(H)}for(var A=0,G=0;A<s.length;A++){var J=a(e,n,d,p,s[A],d[G],f,p+C||C,h,v,g);J!==t&&(J.nodes.intact||(k=!1),C+=J.$trusted?(J.match(/<[^\/]|\>\s*[^<]/g)||[]).length:B.call(J)==D?J.length:1,d[G++]=J)}if(!k){for(var A=0;A<s.length;A++)null!=d[A]&&(x=x.concat(d[A].nodes));for(var $,A=0;$=d.nodes[A];A++)null!=$.parentNode&&x.indexOf($)<0&&c([$],[d[A]]);for(var $,A=d.nodes.length;$=x[A];A++)null==$.parentNode&&e.appendChild($);s.length<d.length&&(d.length=s.length),d.nodes=x}}else if(null!=s&&b==S){s.attrs||(s.attrs={}),d.attrs||(d.attrs={});var _=Object.keys(s.attrs);if((s.tag!=d.tag||_.join()!=Object.keys(d.attrs).join()||s.attrs.id!=d.attrs.id)&&(d.nodes.length&&c(d.nodes),d.configContext&&typeof d.configContext.onunload==L&&d.configContext.onunload()),B.call(s.tag)!=R)return;var $,V=0===d.nodes.length;if(s.attrs.xmlns?v=s.attrs.xmlns:"svg"===s.tag?v="http://www.w3.org/2000/svg":"math"===s.tag&&(v="http://www.w3.org/1998/Math/MathML"),V?($=s.attrs.is?v===t?N.createElement(s.tag,s.attrs.is):N.createElementNS(v,s.tag,s.attrs.is):v===t?N.createElement(s.tag):N.createElementNS(v,s.tag),d={tag:s.tag,attrs:_.length?i($,s.tag,s.attrs,{},v):{},children:null!=s.children&&s.children.length>0?a($,s.tag,t,t,s.children,d.children,!0,0,s.attrs.contenteditable?$:h,v,g):s.children,nodes:[$]},d.children&&!d.children.nodes&&(d.children.nodes=[]),"select"==s.tag&&s.attrs.value&&i($,s.tag,{value:s.attrs.value},{},v),e.insertBefore($,e.childNodes[p]||null)):($=d.nodes[0],_.length&&i($,s.tag,s.attrs,d.attrs,v),d.children=a($,s.tag,t,t,s.children,d.children,!1,0,s.attrs.contenteditable?$:h,v,g),d.nodes.intact=!0,f===!0&&null!=$&&e.insertBefore($,e.childNodes[p]||null)),typeof s.attrs.config==L){var Y=d.configContext=d.configContext||{},Q=function(e,t){return function(){return e.attrs.config.apply(e,t)}};g.push(Q(s,[$,!V,Y,d]))}}else if(typeof b!=L){var x;0===d.nodes.length?(s.$trusted?x=l(e,p,s):(x=[N.createTextNode(s)],e.nodeName.match(I)||e.insertBefore(x[0],e.childNodes[p]||null)),d="string number boolean".indexOf(typeof s)>-1?new s.constructor(s):s,d.nodes=x):d.valueOf()!==s.valueOf()||f===!0?(x=d.nodes,h&&h===N.activeElement||(s.$trusted?(c(x,d),x=l(e,p,s)):"textarea"===n?e.value=s:h?h.innerHTML=s:((1==x[0].nodeType||x.length>1)&&(c(d.nodes,d),x=[N.createTextNode(s)]),e.insertBefore(x[0],e.childNodes[p]||null),x[0].nodeValue=s)),d=new s.constructor(s),d.nodes=x):d.nodes.intact=!0}return d}function i(e,t,n,r,o){for(var a in n){var i=n[a],c=r[a];if(a in r&&c===i)"value"===a&&"input"===t&&e.value!==i&&(e.value=i);else{r[a]=i;try{if("config"===a)continue;if(typeof i==L&&0==a.indexOf("on"))e[a]=d(i,e);else if("style"===a&&null!=i&&B.call(i)==S){for(var s in i)(null==c||c[s]!==i[s])&&(e.style[s]=i[s]);for(var s in c)s in i||(e.style[s]="")}else null!=o?"href"===a?e.setAttributeNS("http://www.w3.org/1999/xlink","href",i):"className"===a?e.setAttribute("class",i):e.setAttribute(a,i):a in e&&"list"!=a&&"style"!=a&&"form"!=a?e[a]=i:e.setAttribute(a,i)}catch(l){if(l.message.indexOf("Invalid argument")<0)throw l}}}return r}function c(e,t){for(var n=e.length-1;n>-1;n--)e[n]&&e[n].parentNode&&(e[n].parentNode.removeChild(e[n]),t=[].concat(t),t[n]&&s(t[n]));0!=e.length&&(e.length=0)}function s(e){if(e.configContext&&typeof e.configContext.onunload==L&&e.configContext.onunload(),e.children)if(B.call(e.children)==D)for(var t=0;t<e.children.length;t++)s(e.children[t]);else e.children.tag&&s(e.children)}function l(e,t,n){var r=e.childNodes[t];if(r){var o=1!=r.nodeType,a=N.createElement("span");o?(e.insertBefore(a,r||null),a.insertAdjacentHTML("beforebegin",n),e.removeChild(a)):r.insertAdjacentHTML("beforebegin",n)}else e.insertAdjacentHTML("beforeend",n);for(var i=[];e.childNodes[t]!==r;)i.push(e.childNodes[t]),t++;return i}function u(e){var t=0;e:for(;;){for(var n=t;n<e.length;n++){{e[n]}if(B.call(e[n])==D){t=n,e=e.concat.apply([],e);continue e}}break}return e}function d(e,t){return function(n){n=n||event,o.redraw.strategy("diff"),o.startComputation();try{return e.call(t,n)}finally{o.endComputation()}}}function f(e){var t=U.indexOf(e);return 0>t?U.push(e)-1:t}function p(e){var t=function(){return arguments.length&&(e=arguments[0]),e};return t.toJSON=function(){return e},t}function h(){for(var e=o.redraw.strategy(),t=0;t<J.length;t++)_[t]&&"none"!=e&&o.render(J[t],$[t].view(_[t]),"all"==e);Q&&(Q(),Q=null),V=null,Y=new Date,o.redraw.strategy("diff")}function v(e){return e.slice(tt[o.route.mode].length)}function g(e,t,n){rt={};var r=n.indexOf("?");-1!==r&&(rt=w(n.substr(r+1,n.length)),n=n.substr(0,r));for(var a in t){if(a==n)return o.module(e,t[a]),!0;var i=new RegExp("^"+a.replace(/:[^\/]+?\.{3}/g,"(.*?)").replace(/:[^\/]+/g,"([^\\/]+)")+"/?$");if(i.test(n))return n.replace(i,function(){for(var n=a.match(/:[^\/]+/g)||[],r=[].slice.call(arguments,1,-2),i=0;i<n.length;i++)rt[n[i].replace(/:|\./g,"")]=decodeURIComponent(r[i]);o.module(e,t[a])}),!0}}function m(e){if(e=e||event,!e.ctrlKey&&!e.metaKey&&2!=e.which){e.preventDefault?e.preventDefault():e.returnValue=!1;var t=e.currentTarget||this,n="pathname"==o.route.mode&&t.search?w(t.search.slice(1)):{};o.route(t[o.route.mode].slice(tt[o.route.mode].length),n)}}function b(){"hash"!=o.route.mode&&P.hash?P.hash=P.hash:e.scrollTo(0,0)}function y(e,t){var n=[];for(var r in e){var o=t?t+"["+r+"]":r,a=e[r];n.push(null!=a&&B.call(a)==S?y(a,o):encodeURIComponent(o)+"="+encodeURIComponent(a))}return n.join("&")}function w(e){for(var t=e.split("&"),n={},r=0;r<t.length;r++){var o=t[r].split("=");n[x(o[0])]=o[1]?x(o[1]):1===o.length?!0:""}return n}function x(e){return decodeURIComponent(e.replace(/\+/g," "))}function k(e){var n=f(e);c(e.childNodes,H[n]),H[n]=t}function C(e){var t=o.prop();return e.then(t),t.then=function(t,n){return C(e.then(t,n))},t}function E(e,t){function n(e){d=e||l,p.map(function(e){d==s&&e.resolve(f)||e.reject(f)})}function r(e,t,n,r){if((null!=f&&B.call(f)==S||typeof f==L)&&typeof e==L)try{var a=0;e.call(f,function(e){a++||(f=e,t())},function(e){a++||(f=e,n())})}catch(i){o.deferred.onerror(i),f=i,n()}else r()}function a(){var l;try{l=f&&f.then}catch(p){return o.deferred.onerror(p),f=p,d=c,a()}r(l,function(){d=i,a()},function(){d=c,a()},function(){try{d==i&&typeof e==L?f=e(f):d==c&&"function"==typeof t&&(f=t(f),d=i)}catch(a){return o.deferred.onerror(a),f=a,n()}f==u?(f=TypeError(),n()):r(l,function(){n(s)},n,function(){n(d==i&&s)})})}var i=1,c=2,s=3,l=4,u=this,d=0,f=0,p=[];u.promise={},u.resolve=function(e){return d||(f=e,d=i,a()),this},u.reject=function(e){return d||(f=e,d=c,a()),this},u.promise.then=function(e,t){var n=new E(e,t);return d==s?n.resolve(f):d==l?n.reject(f):p.push(n),n.promise}}function O(e){return e}function M(n){if(!n.dataType||"jsonp"!==n.dataType.toLowerCase()){var r=new e.XMLHttpRequest;if(r.open(n.method,n.url,!0,n.user,n.password),r.onreadystatechange=function(){4===r.readyState&&(r.status>=200&&r.status<300?n.onload({type:"load",target:r}):n.onerror({type:"error",target:r}))},n.serialize==JSON.stringify&&n.data&&"GET"!=n.method&&r.setRequestHeader("Content-Type","application/json; charset=utf-8"),n.deserialize==JSON.parse&&r.setRequestHeader("Accept","application/json, text/*"),typeof n.config==L){var o=n.config(r,n);null!=o&&(r=o)}var a="GET"!=n.method&&n.data?n.data:"";if(a&&B.call(a)!=R&&a.constructor!=e.FormData)throw"Request data should be either be a string or FormData. Check the `serialize` option in `m.request`";return r.send(a),r}var i="mithril_callback_"+(new Date).getTime()+"_"+Math.round(1e16*Math.random()).toString(36),c=N.createElement("script");e[i]=function(r){N.body.removeChild(c),n.onload({type:"load",target:{responseText:r}}),e[i]=t},c.onerror=function(){return N.body.removeChild(c),n.onerror({type:"error",target:{status:500,responseText:JSON.stringify({error:"Error making jsonp request"})}}),e[i]=t,!1},c.onload=function(){return!1},c.src=n.url+(n.url.indexOf("?")>0?"&":"?")+(n.callbackKey?n.callbackKey:"callback")+"="+i+"&"+y(n.data||{}),N.body.appendChild(c)}function T(e,t,n){if("GET"==e.method&&"jsonp"!=e.dataType){var r=e.url.indexOf("?")<0?"?":"&",o=y(t);e.url=e.url+(o?r+o:"")}else e.data=n(t);return e}function j(e,t){var n=e.match(/:[a-z]\w+/gi);if(n&&t)for(var r=0;r<n.length;r++){var o=n[r].slice(1);e=e.replace(n[r],t[o]),delete t[o]}return e}var N,P,A,q,S="[object Object]",D="[object Array]",R="[object String]",L="function",B={}.toString,F=/(?:(^|#|\.)([^#\.\[\]]+))|(\[.+?\])/g,K=/\[(.+?)(?:=("|'|)(.*?)\2)?\]/,I=/AREA|BASE|BR|COL|COMMAND|EMBED|HR|IMG|INPUT|KEYGEN|LINK|META|PARAM|SOURCE|TRACK|WBR/;n(e);var z,X={appendChild:function(e){z===t&&(z=N.createElement("html")),N.documentElement&&N.documentElement!==e?N.replaceChild(e,N.documentElement):N.appendChild(e),this.childNodes=N.childNodes},insertBefore:function(e){this.appendChild(e)},childNodes:[]},U=[],H={};o.render=function(e,n,r){var o=[];if(!e)throw new Error("Please ensure the DOM element exists before rendering a template into it.");var i=f(e),s=e==N,l=s||e==N.documentElement?X:e;s&&"html"!=n.tag&&(n={tag:"html",attrs:{},children:n}),H[i]===t&&c(l.childNodes),r===!0&&k(e),H[i]=a(l,null,t,t,n,H[i],!1,0,null,t,o);for(var u=0;u<o.length;u++)o[u]()},o.trust=function(e){return e=new String(e),e.$trusted=!0,e},o.prop=function(e){return(null!=e&&B.call(e)==S||typeof e==L)&&typeof e.then==L?C(e):p(e)};var G,J=[],$=[],_=[],V=null,Y=0,Q=null,W=16;o.module=function(e,t){var n=J.indexOf(e);0>n&&(n=J.length);var r=!1;if(_[n]&&typeof _[n].onunload==L){var a={preventDefault:function(){r=!0}};_[n].onunload(a)}if(!r){o.redraw.strategy("all"),o.startComputation(),J[n]=e;var i=G=t,c=new t.controller;return i==G&&(_[n]=c,$[n]=t),o.endComputation(),_[n]}},o.redraw=function(t){V&&t!==!0?(new Date-Y>W||A==e.requestAnimationFrame)&&(V>0&&q(V),V=A(h,W)):(h(),V=A(function(){V=null},W))},o.redraw.strategy=o.prop();var Z=0;o.startComputation=function(){Z++},o.endComputation=function(){Z=Math.max(Z-1,0),0==Z&&o.redraw()},o.withAttr=function(e,t){return function(n){n=n||event;var r=n.currentTarget||this;t(e in r?r[e]:r.getAttribute(e))}};var et,tt={pathname:"",hash:"#",search:"?"},nt=function(){},rt={};return o.route=function(){if(0===arguments.length)return et;if(3===arguments.length&&B.call(arguments[1])==R){var t=arguments[0],n=arguments[1],r=arguments[2];nt=function(e){var a=et=v(e);g(t,r,a)||o.route(n,!0)};var a="hash"==o.route.mode?"onhashchange":"onpopstate";e[a]=function(){et!=v(P[o.route.mode])&&nt(P[o.route.mode])},Q=b,e[a]()}else if(arguments[0].addEventListener){{var i=arguments[0];arguments[1],arguments[2]}i.href=("pathname"!==o.route.mode?P.pathname:"")+tt[o.route.mode]+this.attrs.href,i.removeEventListener("click",m),i.addEventListener("click",m)}else if(B.call(arguments[0])==R){et=arguments[0];var c=null!=arguments[1]&&B.call(arguments[1])==S?y(arguments[1]):null;c&&(et+=(-1===et.indexOf("?")?"?":"&")+c);var s=(3==arguments.length?arguments[2]:arguments[1])===!0;e.history.pushState?(Q=function(){e.history[s?"replaceState":"pushState"](null,N.title,tt[o.route.mode]+et),b()},nt(tt[o.route.mode]+et)):P[o.route.mode]=et}},o.route.param=function(e){return rt[e]},o.route.mode="search",o.deferred=function(){var e=new E;return e.promise=C(e.promise),e},o.deferred.onerror=function(e){if("[object Error]"==B.call(e)&&!e.constructor.toString().match(/ Error/))throw e},o.sync=function(e){function t(e,t){return function(o){return i[e]=o,t||(n="reject"),0==--a&&(r.promise(i),r[n](i)),o}}var n="resolve",r=o.deferred(),a=e.length,i=new Array(a);if(e.length>0)for(var c=0;c<e.length;c++)e[c].then(t(c,!0),t(c,!1));else r.resolve([]);return r.promise},o.request=function(e){e.background!==!0&&o.startComputation();var t=o.deferred(),n=e.dataType&&"jsonp"===e.dataType.toLowerCase(),r=e.serialize=n?O:e.serialize||JSON.stringify,a=e.deserialize=n?O:e.deserialize||JSON.parse,i=e.extract||function(e){return 0===e.responseText.length&&a===JSON.parse?null:e.responseText};return e.url=j(e.url,e.data),e=T(e,e.data,r),e.onload=e.onerror=function(n){try{n=n||event;var r=("load"==n.type?e.unwrapSuccess:e.unwrapError)||O,c=r(a(i(n.target,e)));if("load"==n.type)if(B.call(c)==D&&e.type)for(var s=0;s<c.length;s++)c[s]=new e.type(c[s]);else e.type&&(c=new e.type(c));t["load"==n.type?"resolve":"reject"](c)}catch(n){o.deferred.onerror(n),t.reject(n)}e.background!==!0&&o.endComputation()},M(e),t.promise(e.initialValue),t.promise},o.deps=function(t){return n(e=t||e),e},o.deps.factory=r,o}("undefined"!=typeof window?window:{}),"undefined"!=typeof n&&null!==n&&(n.exports=m),"function"==typeof e&&e.amd&&e(function(){return m})},{}],4:[function(e,t){function n(e,t,n){var r=n?l.invertKey(e):e;return{key:r,pos:l.key2pos(r),role:t.role,color:t.color}}function r(e,t){return e.role===t.role&&e.color===t.color}function o(e,t){return t.sort(function(t,n){return l.distance(e.pos,t.pos)-l.distance(e.pos,n.pos)})[0]}function a(e,t){var a=t.bounds(),i=a.width/8,c=a.height/8,s={},u=[],d=[],f=[],p=[],h=e.orientation!==t.orientation,v={},g="white"===t.orientation;for(var m in e.pieces){var b=n(m,e.pieces[m],h);v[b.key]=b}return l.allKeys.forEach(function(e){if(e!==t.movable.dropped[1]){var o=t.pieces[e],a=v[e];o?a?r(o,a)||(f.push(a),p.push(n(e,o,!1))):p.push(n(e,o,!1)):a&&f.push(a)}}),p.forEach(function(e){var t=o(e,f.filter(l.partial(r,e)));if(t){var n=g?t.pos:e.pos,a=g?e.pos:t.pos,d=[(n[0]-a[0])*i,(a[1]-n[1])*c];s[e.key]=[d,d],u.push(t.key)}}),f.forEach(function(e){e.key===t.movable.dropped[0]||l.containsX(u,e.key)||d.push({piece:{role:e.role,color:e.color},left:12.5*(g?e.pos[0]-1:8-e.pos[0])+"%",bottom:12.5*(g?e.pos[1]-1:8-e.pos[1])+"%",opacity:1})}),{anims:s,fadings:d}}function i(e,t){return Math.round(e*t)/t}function c(e){if(e.animation.current.start){var t=1-((new Date).getTime()-e.animation.current.start)/e.animation.current.duration;if(0>=t)e.animation.current={},e.render();else{var n=u.easeInOutCubic(t);for(var r in e.animation.current.anims){var o=e.animation.current.anims[r];o[1]=[i(o[0][0]*n,10),i(o[0][1]*n,10)]}for(var a in e.animation.current.fadings)e.animation.current.fadings[a].opacity=i(n,100);e.render(),requestAnimationFrame(function(){c(e)})}}}function s(e,t){var n={orientation:t.orientation,pieces:{}};for(var r in t.pieces)n.pieces[r]={role:t.pieces[r].role,color:t.pieces[r].color};var o=e(),i=a(n,t);if(Object.keys(i.anims).length>0||i.fadings.length>0){var s=t.animation.current.start;t.animation.current={start:(new Date).getTime(),duration:t.animation.duration,anims:i.anims,fadings:i.fadings},s||c(t)}else t.renderRAF();return o}var l=(e("mithril"),e("./util")),u={easeInOutCubic:function(e){return.5>e?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}};t.exports=function(e,t,n){return function(){var r=[t].concat(Array.prototype.slice.call(arguments,0));if(t.render){if(t.animation.enabled&&!n)return s(l.partialApply(e,r),t);var o=e.apply(null,r);return t.renderRAF(),o}return e.apply(null,r)}}},{"./util":14,mithril:3}],5:[function(e,t){var n=(e("mithril"),e("./board"));t.exports=function(e){return{set:e.set,toggleOrientation:e.toggleOrientation,getOrientation:function(){return e.data.orientation},getPieces:function(){return e.data.pieces},getMaterialDiff:function(){return n.getMaterialDiff(e.data)},getFen:e.getFen,dump:function(){return e.data},move:e.apiMove,setPieces:e.setPieces,setCheck:e.setCheck,playPremove:e.playPremove,cancelPremove:e.cancelPremove,cancelMove:e.cancelMove,stop:e.stop}}},{"./board":6,mithril:3}],6:[function(e,t){function n(e){setTimeout(e,1)}function r(e){e.orientation=O.opposite(e.orientation)}function o(e){e.lastMove=null,h(e,null),s(e)}function a(e,t){Object.keys(t).forEach(function(n){t[n]?e.pieces[n]=t[n]:delete e.pieces[n]}),e.movable.dropped=[]}function i(e,t){var n=t||e.turnColor;Object.keys(e.pieces).forEach(function(t){e.pieces[t].color===n&&"king"===e.pieces[t].role&&(e.check=t)})}function c(e,t,r){e.premovable.current=[t,r],n(O.partial(e.premovable.events.set,t,r))}function s(e){e.premovable.current&&(e.premovable.current=null,n(e.premovable.events.unset))}function l(e,t,r){var o=T(function(){return t!==r&&e.pieces[t]?(e.pieces[r]&&n(O.partial(e.events.capture,r,e.pieces[r])),e.pieces[r]=e.pieces[t],delete e.pieces[t],e.lastMove=[t,r],e.check=null,n(e.events.change),!0):!1},e)();return o&&(e.movable.dropped=[]),o}function u(e,t,n){var r=l(e,t,n);return r&&(e.movable.dests={},e.turnColor=O.opposite(e.turnColor)),r}function d(e,t,n){return l(e,t,n)}function f(e,t,r){r?g(e,t,r)?u(e,t,r)&&(h(e,null),n(O.partial(e.movable.events.after,t,r,{premove:!1,holdTime:j.stop()}))):b(e,t,r)?(c(e,t,r),h(e,null)):v(e,r)||m(e,r)?h(e,r):h(e,null):(h(e,null),"trash"===e.movable.dropOff&&(delete e.pieces[t],n(e.events.change)))}function p(e,t){e.selected?t?e.selected!==t&&f(e,e.selected,t):h(e,null):(v(e,t)||m(e,t))&&h(e,t),t&&n(O.partial(e.events.select,t))}function h(e,t){e.selected=t,e.premovable.dests=t&&m(e,t)?M(e.pieces,t):null}function v(e,t){var n=e.pieces[t];return n&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}function g(e,t,n){return t!==n&&v(e,t)&&(e.movable.free||O.containsX(e.movable.dests[t],n))}function m(e,t){var n=e.pieces[t];return n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function b(e,t,n){return t!==n&&m(e,t)&&O.containsX(M(e.pieces,t),n)}function y(e,t){var n=e.pieces[t];return n&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function w(e){var t=e.premovable.current;if(t){var r=t[0],o=t[1];g(e,r,o)&&u(e,r,o)&&n(O.partial(e.movable.events.after,r,o,{premove:!0})),s(e)}}function x(e){s(e),p(e,null)}function k(e){e.movable.color=null,e.movable.dests={},x(e)}function C(e,t,n){if(n||e.bounds){n=n||e.bounds();var r=Math.ceil(8*((t[0]-n.left)/n.width));r="white"===e.orientation?r:9-r;var o=Math.ceil(8-8*((t[1]-n.top)/n.height));return o="white"===e.orientation?o:9-o,r>0&&9>r&&o>0&&9>o?O.pos2key([r,o]):void 0}}function E(e){var t={king:0,queen:0,rook:0,bishop:0,knight:0,pawn:0};for(var n in e.pieces){var r=e.pieces[n];t[r.role]+="white"===r.color?1:-1}var o={white:{},black:{}};for(var a in t){var i=t[a];i>0?o.white[a]=i:0>i&&(o.black[a]=-i)}return o}var O=e("./util"),M=e("./premove"),T=e("./anim"),j=e("./hold");t.exports={reset:o,toggleOrientation:r,setPieces:a,setCheck:i,selectSquare:p,setSelected:h,isDraggable:y,canMove:g,userMove:f,apiMove:d,playPremove:w,unsetPremove:s,cancelMove:x,stop:k,getKeyAtDomPos:C,getMaterialDiff:E}},{"./anim":4,"./hold":12,"./premove":13,"./util":14}],7:[function(e,t){var n=e("merge"),r=e("./board"),o=e("./fen");t.exports=function(e,t){t&&(t.movable&&t.movable.dests&&delete e.movable.dests,n.recursive(e,t),e.fen&&(e.pieces=o.read(e.fen),e.check=t.check,delete e.fen),e.check===!0&&r.setCheck(e),e.movable.dropped=[],e.selected&&r.setSelected(e,e.selected),e.animation.duration<10&&(e.animation.enabled=!1))}},{"./board":6,"./fen":11,merge:2}],8:[function(e,t){var n=e("./board"),r=e("./data"),o=e("./fen"),a=e("./configure"),i=e("./anim"),c=e("./drag");t.exports=function(e){this.data=r(e),this.getFen=function(){return o.write(this.data.pieces)}.bind(this),this.set=i(a,this.data),this.toggleOrientation=i(n.toggleOrientation,this.data),this.setPieces=i(n.setPieces,this.data),this.selectSquare=i(n.selectSquare,this.data,!0),this.apiMove=i(n.apiMove,this.data),this.playPremove=i(n.playPremove,this.data),this.cancelPremove=i(n.unsetPremove,this.data,!0),this.setCheck=i(n.setCheck,this.data,!0),this.cancelMove=i(function(e){n.cancelMove(e),c.cancel(e)}.bind(this),this.data,!0),this.stop=i(function(e){n.stop(e),c.cancel(e)}.bind(this),this.data,!0)}},{"./anim":4,"./board":6,"./configure":7,"./data":9,"./drag":10,"./fen":11}],9:[function(e,t){var n=e("./fen"),r=e("./configure");t.exports=function(e){var t={pieces:n.read(n.initial),orientation:"white",turnColor:"white",check:null,lastMove:null,selected:null,coordinates:!0,render:null,renderRAF:null,element:null,bounds:null,viewOnly:!1,highlight:{lastMove:!0,check:!0,dragOver:!0},animation:{enabled:!0,duration:200,current:{}},movable:{free:!0,color:"both",dests:{},dropOff:"revert",dropped:[],showDests:!0,events:{after:function(){}}},premovable:{enabled:!0,showDests:!0,dests:[],current:null,events:{set:function(){},unset:function(){}}},draggable:{enabled:!0,distance:3,squareTarget:!1,centerPiece:!0,showGhost:!0,current:{}},events:{change:function(){},capture:function(){},select:function(){}}};return r(t,e||{}),t}},{"./configure":7,"./fen":11}],10:[function(e,t){function n(e){return e?e.color+" "+e.role:""}function r(e,t){if(!(void 0!==t.button&&0!==t.button||t.touches&&t.touches.length>1)){t.stopPropagation(),t.preventDefault(),s=t.target;var r=u.eventPosition(t),a=e.bounds(),i=l.getKeyAtDomPos(e,r,a),c=!!e.premovable.current;l.selectSquare(e,i);var f=e.selected===i;if(e.pieces[i]&&f&&l.isDraggable(e,i)){var p=e.element.querySelector("."+i).getBoundingClientRect();e.draggable.current={orig:i,piece:n(e.pieces[i]),rel:r,epos:r,pos:[0,0],dec:e.draggable.centerPiece?[r[0]-(p.left+p.width/2),r[1]-(p.top+p.height/2)]:[0,0],bounds:a,started:!1},d.start()}else c&&l.unsetPremove(e);o(e)}}function o(e){requestAnimationFrame(function(){var t=e.draggable.current;t.orig&&(e.animation.current.start&&-1!==Object.keys(e.animation.current.anims).indexOf(t.orig)&&(e.animation.current={}),n(e.pieces[t.orig])!=t.piece?c(e):(!t.started&&u.distance(t.epos,t.rel)>=e.draggable.distance&&(t.started=!0),t.started&&(t.pos=[t.epos[0]-t.rel[0],t.epos[1]-t.rel[1]],t.over=l.getKeyAtDomPos(e,t.epos,t.bounds)))),e.render(),t.orig&&o(e)})}function a(e,t){t.touches&&t.touches.length>1||e.draggable.current.orig&&(e.draggable.current.epos=u.eventPosition(t))}function i(e,t){var n=e.draggable,r=n.current?n.current.orig:null;r&&(t&&"touchend"===t.type&&s!==t.target||(l.unsetPremove(e),n.current.started&&(dest=n.current.over,r!==dest&&(e.movable.dropped=[r,dest]),l.userMove(e,r,dest)),n.current={}))}function c(e){e.draggable.current.orig&&(e.draggable.current={},l.selectSquare(e,null))}{var s,l=e("./board"),u=e("./util"),d=e("./hold");e("mithril")}t.exports={start:r,move:a,end:i,cancel:c,processDrag:o}},{"./board":6,"./hold":12,"./util":14,mithril:3}],11:[function(e,t){function n(e){"start"===e&&(e=a);var t={};return e.replace(/ .+$/,"").split("/").forEach(function(e,n){var r=0;e.split("").forEach(function(e){var a=parseInt(e);a?r+=a:(r++,t[o.pos2key([r,8-n])]={role:i[e.toLowerCase()],color:e===e.toLowerCase()?"black":"white"})})}),t}function r(e){return[8,7,6,5,4,3,2].reduce(function(e,t){return e.replace(new RegExp(Array(t+1).join("1"),"g"),t)},o.invRanks.map(function(t){return o.ranks.map(function(n){var r=e[o.pos2key([n,t])];if(r){var a=c[r.role];return"white"===r.color?a.toUpperCase():a}return"1"}).join("")}).join("/"))}var o=e("./util"),a="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",i={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},c={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};t.exports={initial:a,read:n,write:r}},{"./util":14}],12:[function(e,t){var n,r=function(){n=new Date},o=function(){n=null},a=function(){if(!n)return 0;var e=new Date-n;return n=null,e};t.exports={start:r,cancel:o,stop:a}},{}],13:[function(e,t){function n(e,t){return Math.abs(e-t)}function r(e,t,r,o,a){return n(t,o)<2&&("white"===e?a===r+1||2===r&&4===a&&t===o:a===r-1||7===r&&5===a&&t===o)}function o(e,t,r,o){var a=n(e,r),i=n(t,o);return 1===a&&2===i||2===a&&1===i}function a(e,t,r,o){return n(e,r)===n(t,o)}function i(e,t,n,r){return e===n||t===r}function c(e,t,n,r){return a(e,t,n,r)||i(e,t,n,r)}function s(e,t,r,o,a,i){return n(r,a)<2&&n(o,i)<2||o===i&&o===("white"===e?1:8)&&(5===r&&(3===a||7===a)||d.containsX(t,a))}function l(e,t){return Object.keys(e).filter(function(n){var r=e[n];return r&&r.color===t&&"rook"===r.role}).map(function(e){return d.key2pos(e)[0]})}function u(e,t){var n,u=e[t],f=d.key2pos(t);switch(u.role){case"pawn":n=r.bind(null,u.color);break;case"knight":n=o;break;case"bishop":n=a;break;case"rook":n=i;break;case"queen":n=c;break;case"king":n=s.bind(null,u.color,l(e,u.color))}return d.allPos.filter(function(e){return(f[0]!==e[0]||f[1]!==e[1])&&n(f[0],f[1],e[0],e[1])}).map(d.pos2key)}var d=e("./util");t.exports=u},{"./util":14}],14:[function(e,t){function n(e){return m[e[0]-1]+e[1]}function r(e){return[m.indexOf(e[0])+1,parseInt(e[1])]}function o(e){return m[7-m.indexOf(e[0])]+(9-parseInt(e[1]))}function a(e){var t=[];for(var n in e)e[n]&&t.push(n);return t.join(" ")}function i(e){return"white"===e?"black":"white"}function c(e,t){return e&&(e[0]===t||e[1]===t)}function s(e,t){return e&&-1!==e.indexOf(t)}function l(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function u(){return g||(g=d()),g}function d(){return"transform"in document.body.style?"transform":"webkitTransform"in document.body.style?"webkitTransform":"mozTransform"in document.body.style?"mozTransform":"oTransform"in document.body.style?"oTransform":"msTransform"}function f(e){return"translate3d("+e[0]+"px,"+e[1]+"px,0)"}function p(e){return e.touches?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:[e.clientX,e.clientY]}function h(e,t){return e.bind.apply(e,[null].concat(t))}function v(){return h(arguments[0],Array.prototype.slice.call(arguments,1))}var g,m="abcdefgh".split(""),b=[1,2,3,4,5,6,7,8],y=[8,7,6,5,4,3,2,1],w=function(){var e=[];return y.forEach(function(t){b.forEach(function(n){e.push([n,t])})}),e}(),x=w.slice().reverse(),k=w.map(n);t.exports={files:m,ranks:b,invRanks:y,allPos:w,invPos:x,allKeys:k,pos2key:n,key2pos:r,invertKey:o,classSet:a,opposite:i,translate:f,contains2:c,containsX:s,distance:l,eventPosition:p,partialApply:h,partial:v,transformProp:u}},{}],15:[function(e,t){function n(e){return["cg-piece",e.role,e.color].join(" ")}function r(e,t,r){var o={style:{},"class":n(r)},a=e.data.draggable.current;if(a.orig!==t||0===a.pos[0]&&0===a.pos[1]){if(e.data.animation.current.anims){var i=e.data.animation.current.anims[t];i&&(o.style[d.transformProp()]=d.translate(i[1]))}}else o.style[d.transformProp()]=d.translate([a.pos[0]+a.dec[0],a.pos[1]+a.dec[1]]),o.class+=" dragging";return{tag:"div",attrs:o}}function o(e){return{tag:"div",attrs:{"class":n(e)+" ghost"}}}function a(e,t,n){var a=d.files[t[0]-1],i=t[1],c=a+i,s=e.data.pieces[c],l=e.data.highlight.dragOver&&e.data.draggable.current.over===c,u={"class":"cg-square "+c+" "+d.classSet({selected:e.data.selected===c,check:e.data.highlight.check&&e.data.check===c,"last-move":e.data.highlight.lastMove&&d.contains2(e.data.lastMove,c),"move-dest":(l||e.data.movable.showDests)&&d.containsX(e.data.movable.dests[e.data.selected],c),"premove-dest":(l||e.data.premovable.showDests)&&d.containsX(e.data.premovable.dests,c),"current-premove":d.contains2(e.data.premovable.current,c),"drag-over":l,occupied:!!s}),style:{left:12.5*(n?t[0]-1:8-t[0])+"%",bottom:12.5*(n?t[1]-1:8-t[1])+"%"}};e.data.coordinates&&(t[1]===(n?1:8)&&(u["data-coord-x"]=a),t[0]===(n?8:1)&&(u["data-coord-y"]=i));var f=[];return s&&(f.push(r(e,c,s)),e.data.draggable.current.orig===c&&e.data.draggable.showGhost&&f.push(o(s))),{tag:"div",attrs:u,children:f}}function i(e,t){var n=d.key2pos(t.over),r="white"===e.data.orientation?n[0]:9-n[0],o="white"===e.data.orientation?n[1]:9-n[1];return{tag:"div",attrs:{id:"cg-square-target",style:{width:t.bounds.width/4+"px",height:t.bounds.height/4+"px",left:(r-1.5)*t.bounds.width/8+"px",top:(7.5-o)*t.bounds.height/8+"px"}}}}function c(e){return{tag:"div",attrs:{"class":"cg-square fading",style:{left:e.left,bottom:e.bottom,opacity:e.opacity}},children:[{tag:"div",attrs:{"class":n(e.piece)}}]}}function s(e){var t="white"==e.data.orientation,n=(t?d.allPos:d.invPos).map(function(n){return a(e,n,t)});return e.data.draggable.current.over&&e.data.draggable.squareTarget&&n.push(i(e,e.data.draggable.current)),e.data.animation.current.fadings&&e.data.animation.current.fadings.forEach(function(e){n.push(c(e))
}),n}function l(e,t,n){var r=d.partial(f.start,e.data),o=d.partial(f.move,e.data),a=d.partial(f.end,e.data),i=["touchstart","mousedown"],c=["touchmove","mousemove"],s=["touchend","mouseup"];i.forEach(function(e){t.addEventListener(e,r)}),c.forEach(function(e){document.addEventListener(e,o)}),s.forEach(function(e){document.addEventListener(e,a)}),n.onunload=function(){i.forEach(function(e){t.removeEventListener(e,r)}),c.forEach(function(e){document.removeEventListener(e,o)}),s.forEach(function(e){document.removeEventListener(e,a)})}}function u(e){return{tag:"div",attrs:{"class":"cg-board orientation-"+e.data.orientation,config:function(t,n,r){n||(e.data.viewOnly||l(e,t,r),e.data.render=function(){m.render(t,s(e))},e.data.renderRAF=function(){requestAnimationFrame(e.data.render)},e.data.bounds=t.getBoundingClientRect.bind(t),e.data.element=t,e.data.render())}},children:[]}}var d=e("./util"),f=(e("./board"),e("./drag")),d=e("./util");t.exports=function(e){return{tag:"div",attrs:{"class":"cg-board-wrap "+(e.data.viewOnly?"view-only":"manipulable")},children:[u(e)]}}},{"./board":6,"./drag":10,"./util":14}]},{},[1])(1)});