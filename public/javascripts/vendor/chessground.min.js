!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.Chessground=e()}}(function(){var e;return function t(e,n,r){function o(i,s){if(!n[i]){if(!e[i]){var l="function"==typeof require&&require;if(!s&&l)return l(i,!0);if(a)return a(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[i]={exports:{}};e[i][0].call(u.exports,function(t){var n=e[i][1][t];return o(n?n:t)},u,u.exports,t,e,n,r)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,t){function n(e,t){var n=new o(t);return r.render(e,a(n)),i(n)}var r=e("mithril"),o=e("./ctrl"),a=e("./view"),i=e("./api");t.exports=n,t.exports.controller=o,t.exports.view=a,t.exports.fen=e("./fen"),t.exports.util=e("./util"),t.exports.configure=e("./configure"),t.exports.anim=e("./anim"),t.exports.board=e("./board"),t.exports.drag=e("./drag")},{"./anim":4,"./api":5,"./board":6,"./configure":7,"./ctrl":8,"./drag":10,"./fen":12,"./util":16,"./view":17,mithril:3}],2:[function(e,t){!function(e){function n(e,t){if("object"!==o(e))return t;for(var r in t)e[r]="object"===o(e[r])&&"object"===o(t[r])?n(e[r],t[r]):t[r];return e}function r(e,t,r){var i=r[0],s=r.length;(e||"object"!==o(i))&&(i={});for(var l=0;s>l;++l){var c=r[l],u=o(c);if("object"===u)for(var d in c){var f=e?a.clone(c[d]):c[d];i[d]=t?n(i[d],f):f}}return i}function o(e){return{}.toString.call(e).slice(8,-1).toLowerCase()}var a=function(e){return r(e===!0,!1,arguments)},i="merge";a.recursive=function(e){return r(e===!0,!0,arguments)},a.clone=function(e){var t,n,r=e,i=o(e);if("array"===i)for(r=[],n=e.length,t=0;n>t;++t)r[t]=a.clone(e[t]);else if("object"===i){r={};for(t in e)r[t]=a.clone(e[t])}return r},e?t.exports=a:window[i]=a}("object"==typeof t&&t&&"object"==typeof t.exports&&t.exports)},{}],3:[function(t,n){var r=function o(e,t){function n(e){j=e.document,T=e.location,N=e.cancelAnimationFrame||e.clearTimeout,A=e.requestAnimationFrame||e.setTimeout}function r(){var e,t=[].slice.call(arguments),n=!(null==t[1]||L.call(t[1])!==D||"tag"in t[1]||"subtree"in t[1]),r=n?t[1]:{},o="class"in r?"class":"className",a={tag:"div",attrs:{}},i=[];if(L.call(t[0])!=S)throw new Error("selector in m(selector, attrs, children) should be a string");for(;e=F.exec(t[0]);)if(""===e[1]&&e[2])a.tag=e[2];else if("#"===e[1])a.attrs.id=e[2];else if("."===e[1])i.push(e[2]);else if("["===e[3][0]){var s=K.exec(e[3]);a.attrs[s[1]]=s[3]||(s[2]?"":!0)}i.length>0&&(a.attrs[o]=i.join(" "));var l=t.slice(n?2:1);a.children=1===l.length&&L.call(l[0])===q?l[0]:l;for(var c in r)if(c===o){var u=a.attrs[c];a.attrs[c]=(u&&r[c]?u+" ":u||"")+r[c]}else a.attrs[c]=r[c];return a}function a(e,n,o,c,d,f,p,h,v,g,m){try{(null==d||null==d.toString())&&(d="")}catch(b){d=""}if("retain"===d.subtree)return f;var y=L.call(f),w=L.call(d);if(null==f||y!==w){if(null!=f)if(o&&o.nodes){var x=h-c,k=x+(w===q?d:f.nodes).length;l(o.nodes.slice(x,k),o.slice(x,k))}else f.nodes&&l(f.nodes,f);f=new d.constructor,f.tag&&(f={}),f.nodes=[]}if(w===q){for(var C=0,E=d.length;E>C;C++)L.call(d[C])===q&&(d=d.concat.apply([],d),C--,E=d.length);for(var O=[],M=f.length===d.length,P=0,T=1,A=2,N=3,F={},K=[],I=!1,C=0;C<f.length;C++)f[C]&&f[C].attrs&&null!=f[C].attrs.key&&(I=!0,F[f[C].attrs.key]={action:T,index:C});for(var U=0,C=0,E=d.length;E>C;C++)d[C]&&d[C].attrs&&null==d[C].attrs.key&&(d[C].attrs.key="__mithril__"+U++);if(I){d.indexOf(null)>-1&&(d=d.filter(function(e){return null!=e}));var X=!1;if(d.length!=f.length)X=!0;else for(var z,H,C=0;z=f[C],H=d[C];C++)if(z.attrs&&H.attrs&&z.attrs.key!=H.attrs.key){X=!0;break}if(X){for(var C=0,E=d.length;E>C;C++)if(d[C]&&d[C].attrs)if(null!=d[C].attrs.key){var _=d[C].attrs.key;F[_]=F[_]?{action:N,index:C,from:F[_].index,element:f.nodes[F[_].index]||j.createElement("div")}:{action:A,index:C}}else K.push({index:C,element:e.childNodes[C]||j.createElement("div")});var G=[];for(var J in F)G.push(F[J]);var $=G.sort(i),Y=new Array(f.length);Y.nodes=f.nodes.slice();for(var V,C=0;V=$[C];C++){if(V.action===T&&(l(f[V.index].nodes,f[V.index]),Y.splice(V.index,1)),V.action===A){var Q=j.createElement("div");Q.key=d[V.index].attrs.key,e.insertBefore(Q,e.childNodes[V.index]||null),Y.splice(V.index,0,{attrs:{key:d[V.index].attrs.key},nodes:[Q]}),Y.nodes[V.index]=Q}V.action===N&&(e.childNodes[V.index]!==V.element&&null!==V.element&&e.insertBefore(V.element,e.childNodes[V.index]||null),Y[V.index]=f[V.from],Y.nodes[V.index]=V.element)}for(var C=0,E=K.length;E>C;C++){var V=K[C];e.insertBefore(V.element,e.childNodes[V.index]||null),Y[V.index]=f[V.index],Y.nodes[V.index]=V.element}f=Y}}for(var C=0,W=0,E=d.length;E>C;C++){var Z=a(e,n,f,h,d[C],f[W],p,h+P||P,v,g,m);Z!==t&&(Z.nodes.intact||(M=!1),P+=Z.$trusted?(Z.match(/<[^\/]|\>\s*[^<]/g)||[0]).length:L.call(Z)===q?Z.length:1,f[W++]=Z)}if(!M){for(var C=0,E=d.length;E>C;C++)null!=f[C]&&O.push.apply(O,f[C].nodes);for(var et,C=0;et=f.nodes[C];C++)null!=et.parentNode&&O.indexOf(et)<0&&l([et],[f[C]]);d.length<f.length&&(f.length=d.length),f.nodes=O}}else if(null!=d&&w===D){d.attrs||(d.attrs={}),f.attrs||(f.attrs={});var tt=Object.keys(d.attrs),nt=tt.length>("key"in d.attrs?1:0);if((d.tag!=f.tag||tt.join()!=Object.keys(f.attrs).join()||d.attrs.id!=f.attrs.id||"all"==r.redraw.strategy()&&f.configContext&&f.configContext.retain!==!0||"diff"==r.redraw.strategy()&&f.configContext&&f.configContext.retain===!1)&&(f.nodes.length&&l(f.nodes),f.configContext&&typeof f.configContext.onunload===R&&f.configContext.onunload()),L.call(d.tag)!=S)return;var et,rt=0===f.nodes.length;if(d.attrs.xmlns?g=d.attrs.xmlns:"svg"===d.tag?g="http://www.w3.org/2000/svg":"math"===d.tag&&(g="http://www.w3.org/1998/Math/MathML"),rt?(et=d.attrs.is?g===t?j.createElement(d.tag,d.attrs.is):j.createElementNS(g,d.tag,d.attrs.is):g===t?j.createElement(d.tag):j.createElementNS(g,d.tag),f={tag:d.tag,attrs:nt?s(et,d.tag,d.attrs,{},g):d.attrs,children:null!=d.children&&d.children.length>0?a(et,d.tag,t,t,d.children,f.children,!0,0,d.attrs.contenteditable?et:v,g,m):d.children,nodes:[et]},f.children&&!f.children.nodes&&(f.children.nodes=[]),"select"===d.tag&&d.attrs.value&&s(et,d.tag,{value:d.attrs.value},{},g),e.insertBefore(et,e.childNodes[h]||null)):(et=f.nodes[0],nt&&s(et,d.tag,d.attrs,f.attrs,g),f.children=a(et,d.tag,t,t,d.children,f.children,!1,0,d.attrs.contenteditable?et:v,g,m),f.nodes.intact=!0,p===!0&&null!=et&&e.insertBefore(et,e.childNodes[h]||null)),typeof d.attrs.config===R){var ot=f.configContext=f.configContext||{retain:"diff"==r.redraw.strategy()||t},at=function(e,t){return function(){return e.attrs.config.apply(e,t)}};m.push(at(d,[et,!rt,ot,f]))}}else if(typeof d!=R){var O;0===f.nodes.length?(d.$trusted?O=u(e,h,d):(O=[j.createTextNode(d)],e.nodeName.match(B)||e.insertBefore(O[0],e.childNodes[h]||null)),f="string number boolean".indexOf(typeof d)>-1?new d.constructor(d):d,f.nodes=O):f.valueOf()!==d.valueOf()||p===!0?(O=f.nodes,v&&v===j.activeElement||(d.$trusted?(l(O,f),O=u(e,h,d)):"textarea"===n?e.value=d:v?v.innerHTML=d:((1===O[0].nodeType||O.length>1)&&(l(f.nodes,f),O=[j.createTextNode(d)]),e.insertBefore(O[0],e.childNodes[h]||null),O[0].nodeValue=d)),f=new d.constructor(d),f.nodes=O):f.nodes.intact=!0}return f}function i(e,t){return e.action-t.action||e.index-t.index}function s(e,t,n,r,o){for(var a in n){var i=n[a],s=r[a];if(a in r&&s===i)"value"===a&&"input"===t&&e.value!=i&&(e.value=i);else{r[a]=i;try{if("config"===a||"key"==a)continue;if(typeof i===R&&0===a.indexOf("on"))e[a]=d(i,e);else if("style"===a&&null!=i&&L.call(i)===D){for(var l in i)(null==s||s[l]!==i[l])&&(e.style[l]=i[l]);for(var l in s)l in i||(e.style[l]="")}else null!=o?"href"===a?e.setAttributeNS("http://www.w3.org/1999/xlink","href",i):"className"===a?e.setAttribute("class",i):e.setAttribute(a,i):a in e&&"list"!==a&&"style"!==a&&"form"!==a&&"type"!==a&&"width"!==a&&"height"!==a?("input"!==t||e[a]!==i)&&(e[a]=i):e.setAttribute(a,i)}catch(c){if(c.message.indexOf("Invalid argument")<0)throw c}}}return r}function l(e,t){for(var n=e.length-1;n>-1;n--)if(e[n]&&e[n].parentNode){try{e[n].parentNode.removeChild(e[n])}catch(r){}t=[].concat(t),t[n]&&c(t[n])}0!=e.length&&(e.length=0)}function c(e){if(e.configContext&&typeof e.configContext.onunload===R&&(e.configContext.onunload(),e.configContext.onunload=null),e.children)if(L.call(e.children)===q)for(var t,n=0;t=e.children[n];n++)c(t);else e.children.tag&&c(e.children)}function u(e,t,n){var r=e.childNodes[t];if(r){var o=1!=r.nodeType,a=j.createElement("span");o?(e.insertBefore(a,r||null),a.insertAdjacentHTML("beforebegin",n),e.removeChild(a)):r.insertAdjacentHTML("beforebegin",n)}else e.insertAdjacentHTML("beforeend",n);for(var i=[];e.childNodes[t]!==r;)i.push(e.childNodes[t]),t++;return i}function d(e,t){return function(n){n=n||event,r.redraw.strategy("diff"),r.startComputation();try{return e.call(t,n)}finally{et()}}}function f(e){var t=X.indexOf(e);return 0>t?X.push(e)-1:t}function p(e){var t=function(){return arguments.length&&(e=arguments[0]),e};return t.toJSON=function(){return e},t}function h(){for(var e,t=0;e=_[t];t++)J[t]&&r.render(e,G[t].view?G[t].view(J[t]):W());V&&(V(),V=null),$=null,Y=new Date,r.redraw.strategy("diff")}function v(e){return e.slice(rt[r.route.mode].length)}function g(e,t,n){tt={};var o=n.indexOf("?");-1!==o&&(tt=w(n.substr(o+1,n.length)),n=n.substr(0,o));var a=Object.keys(t),i=a.indexOf(n);if(-1!==i)return r.module(e,t[a[i]]),!0;for(var s in t){if(s===n)return r.module(e,t[s]),!0;var l=new RegExp("^"+s.replace(/:[^\/]+?\.{3}/g,"(.*?)").replace(/:[^\/]+/g,"([^\\/]+)")+"/?$");if(l.test(n))return n.replace(l,function(){for(var n=s.match(/:[^\/]+/g)||[],o=[].slice.call(arguments,1,-2),a=0,i=n.length;i>a;a++)tt[n[a].replace(/:|\./g,"")]=decodeURIComponent(o[a]);r.module(e,t[s])}),!0}}function m(e){if(e=e||event,!e.ctrlKey&&!e.metaKey&&2!==e.which){e.preventDefault?e.preventDefault():e.returnValue=!1;for(var t=e.currentTarget||e.srcElement,n="pathname"===r.route.mode&&t.search?w(t.search.slice(1)):{};t&&"A"!=t.nodeName.toUpperCase();)t=t.parentNode;r.route(t[r.route.mode].slice(rt[r.route.mode].length),n)}}function b(){"hash"!=r.route.mode&&T.hash?T.hash=T.hash:e.scrollTo(0,0)}function y(e,n){var r={},o=[];for(var a in e){var i=n?n+"["+a+"]":a,s=e[a],l=L.call(s),c=null===s?encodeURIComponent(i):l===D?y(s,i):l===q?s.reduce(function(e,t){return r[i]||(r[i]={}),r[i][t]?e:(r[i][t]=!0,e.concat(encodeURIComponent(i)+"="+encodeURIComponent(t)))},[]).join("&"):encodeURIComponent(i)+"="+encodeURIComponent(s);s!==t&&o.push(c)}return o.join("&")}function w(e){for(var t=e.split("&"),n={},r=0,o=t.length;o>r;r++){var a=t[r].split("="),i=decodeURIComponent(a[0]),s=2==a.length?decodeURIComponent(a[1]):null;null!=n[i]?(L.call(n[i])!==q&&(n[i]=[n[i]]),n[i].push(s)):n[i]=s}return n}function x(e){var n=f(e);l(e.childNodes,z[n]),z[n]=t}function k(e,t){var n=r.prop(t);return e.then(n),n.then=function(n,r){return k(e.then(n,r),t)},n}function C(e,t){function n(e){d=e||c,p.map(function(e){d===l&&e.resolve(f)||e.reject(f)})}function o(e,t,n,o){if((null!=f&&L.call(f)===D||typeof f===R)&&typeof e===R)try{var a=0;e.call(f,function(e){a++||(f=e,t())},function(e){a++||(f=e,n())})}catch(i){r.deferred.onerror(i),f=i,n()}else o()}function a(){var c;try{c=f&&f.then}catch(p){return r.deferred.onerror(p),f=p,d=s,a()}o(c,function(){d=i,a()},function(){d=s,a()},function(){try{d===i&&typeof e===R?f=e(f):d===s&&"function"==typeof t&&(f=t(f),d=i)}catch(a){return r.deferred.onerror(a),f=a,n()}f===u?(f=TypeError(),n()):o(c,function(){n(l)},n,function(){n(d===i&&l)})})}var i=1,s=2,l=3,c=4,u=this,d=0,f=0,p=[];u.promise={},u.resolve=function(e){return d||(f=e,d=i,a()),this},u.reject=function(e){return d||(f=e,d=s,a()),this},u.promise.then=function(e,t){var n=new C(e,t);return d===l?n.resolve(f):d===c?n.reject(f):p.push(n),n.promise}}function E(e){return e}function O(n){if(!n.dataType||"jsonp"!==n.dataType.toLowerCase()){var r=new e.XMLHttpRequest;if(r.open(n.method,n.url,!0,n.user,n.password),r.onreadystatechange=function(){4===r.readyState&&(r.status>=200&&r.status<300?n.onload({type:"load",target:r}):n.onerror({type:"error",target:r}))},n.serialize===JSON.stringify&&n.data&&"GET"!==n.method&&r.setRequestHeader("Content-Type","application/json; charset=utf-8"),n.deserialize===JSON.parse&&r.setRequestHeader("Accept","application/json, text/*"),typeof n.config===R){var o=n.config(r,n);null!=o&&(r=o)}var a="GET"!==n.method&&n.data?n.data:"";if(a&&L.call(a)!=S&&a.constructor!=e.FormData)throw"Request data should be either be a string or FormData. Check the `serialize` option in `m.request`";return r.send(a),r}var i="mithril_callback_"+(new Date).getTime()+"_"+Math.round(1e16*Math.random()).toString(36),s=j.createElement("script");e[i]=function(r){s.parentNode.removeChild(s),n.onload({type:"load",target:{responseText:r}}),e[i]=t},s.onerror=function(){return s.parentNode.removeChild(s),n.onerror({type:"error",target:{status:500,responseText:JSON.stringify({error:"Error making jsonp request"})}}),e[i]=t,!1},s.onload=function(){return!1},s.src=n.url+(n.url.indexOf("?")>0?"&":"?")+(n.callbackKey?n.callbackKey:"callback")+"="+i+"&"+y(n.data||{}),j.body.appendChild(s)}function M(e,t,n){if("GET"===e.method&&"jsonp"!=e.dataType){var r=e.url.indexOf("?")<0?"?":"&",o=y(t);e.url=e.url+(o?r+o:"")}else e.data=n(t);return e}function P(e,t){var n=e.match(/:[a-z]\w+/gi);if(n&&t)for(var r=0;r<n.length;r++){var o=n[r].slice(1);e=e.replace(n[r],t[o]),delete t[o]}return e}var j,T,A,N,D="[object Object]",q="[object Array]",S="[object String]",R="function",L={}.toString,F=/(?:(^|#|\.)([^#\.\[\]]+))|(\[.+?\])/g,K=/\[(.+?)(?:=("|'|)(.*?)\2)?\]/,B=/^(AREA|BASE|BR|COL|COMMAND|EMBED|HR|IMG|INPUT|KEYGEN|LINK|META|PARAM|SOURCE|TRACK|WBR)$/;n(e);var I,U={appendChild:function(e){I===t&&(I=j.createElement("html")),j.documentElement&&j.documentElement!==e?j.replaceChild(e,j.documentElement):j.appendChild(e),this.childNodes=j.childNodes},insertBefore:function(e){this.appendChild(e)},childNodes:[]},X=[],z={};r.render=function(e,n,r){var o=[];if(!e)throw new Error("Please ensure the DOM element exists before rendering a template into it.");var i=f(e),s=e===j,c=s||e===j.documentElement?U:e;s&&"html"!=n.tag&&(n={tag:"html",attrs:{},children:n}),z[i]===t&&l(c.childNodes),r===!0&&x(e),z[i]=a(c,null,t,t,n,z[i],!1,0,null,t,o);for(var u=0,d=o.length;d>u;u++)o[u]()},r.trust=function(e){return e=new String(e),e.$trusted=!0,e},r.prop=function(e){return(null!=e&&L.call(e)===D||typeof e===R)&&typeof e.then===R?k(e):p(e)};var H,_=[],G=[],J=[],$=null,Y=0,V=null,Q=16;r.module=function(e,t){if(!e)throw new Error("Please ensure the DOM element exists before rendering a template into it.");var n=_.indexOf(e);0>n&&(n=_.length);var o=!1;if(J[n]&&typeof J[n].onunload===R){var a={preventDefault:function(){o=!0}};J[n].onunload(a)}if(!o){r.redraw.strategy("all"),r.startComputation(),_[n]=e;var i=H=t=t||{},s=new(t.controller||function(){});return i===H&&(J[n]=s,G[n]=t),et(),J[n]}},r.redraw=function(t){$&&t!==!0?(new Date-Y>Q||A===e.requestAnimationFrame)&&($>0&&N($),$=A(h,Q)):(h(),$=A(function(){$=null},Q))},r.redraw.strategy=r.prop();var W=function(){return""},Z=0;r.startComputation=function(){Z++},r.endComputation=function(){Z=Math.max(Z-1,0),0===Z&&r.redraw()};var et=function(){"none"==r.redraw.strategy()?(Z--,r.redraw.strategy("diff")):r.endComputation()};r.withAttr=function(e,t){return function(n){n=n||event;var r=n.currentTarget||this;t(e in r?r[e]:r.getAttribute(e))}};var tt,nt,rt={pathname:"",hash:"#",search:"?"},ot=function(){};return r.route=function(){if(0===arguments.length)return nt;if(3===arguments.length&&L.call(arguments[1])===S){var t=arguments[0],n=arguments[1],o=arguments[2];ot=function(e){var a=nt=v(e);g(t,o,a)||r.route(n,!0)};var a="hash"===r.route.mode?"onhashchange":"onpopstate";e[a]=function(){var e=T[r.route.mode];"pathname"===r.route.mode&&(e+=T.search),nt!=v(e)&&ot(e)},V=b,e[a]()}else if(arguments[0].addEventListener||arguments[0].attachEvent){{var i=arguments[0];arguments[1],arguments[2]}i.href=("pathname"!==r.route.mode?T.pathname:"")+rt[r.route.mode]+this.attrs.href,i.addEventListener?(i.removeEventListener("click",m),i.addEventListener("click",m)):(i.detachEvent("onclick",m),i.attachEvent("onclick",m))}else if(L.call(arguments[0])===S){var s=nt;nt=arguments[0];var l=arguments[1]||{},c=nt.indexOf("?"),u=c>-1?w(nt.slice(c+1)):{};for(var d in l)u[d]=l[d];var f=y(u),p=c>-1?nt.slice(0,c):nt;f&&(nt=p+(-1===p.indexOf("?")?"?":"&")+f);var h=(3===arguments.length?arguments[2]:arguments[1])===!0||s===arguments[0];e.history.pushState?(V=function(){e.history[h?"replaceState":"pushState"](null,j.title,rt[r.route.mode]+nt),b()},ot(rt[r.route.mode]+nt)):(T[r.route.mode]=nt,ot(rt[r.route.mode]+nt))}},r.route.param=function(e){if(!tt)throw new Error("You must call m.route(element, defaultRoute, routes) before calling m.route.param()");return tt[e]},r.route.mode="search",r.route.buildQueryString=y,r.route.parseQueryString=w,r.deferred=function(){var e=new C;return e.promise=k(e.promise),e},r.deferred.onerror=function(e){if("[object Error]"===L.call(e)&&!e.constructor.toString().match(/ Error/))throw e},r.sync=function(e){function t(e,t){return function(r){return i[e]=r,t||(n="reject"),0===--a&&(o.promise(i),o[n](i)),r}}var n="resolve",o=r.deferred(),a=e.length,i=new Array(a);if(e.length>0)for(var s=0;s<e.length;s++)e[s].then(t(s,!0),t(s,!1));else o.resolve([]);return o.promise},r.request=function(e){e.background!==!0&&r.startComputation();var t=new C,n=e.dataType&&"jsonp"===e.dataType.toLowerCase(),o=e.serialize=n?E:e.serialize||JSON.stringify,a=e.deserialize=n?E:e.deserialize||JSON.parse,i=e.extract||function(e){return 0===e.responseText.length&&a===JSON.parse?null:e.responseText};return e.url=P(e.url,e.data),e=M(e,e.data,o),e.onload=e.onerror=function(n){try{n=n||event;var o=("load"===n.type?e.unwrapSuccess:e.unwrapError)||E,s=o(a(i(n.target,e)),n.target);if("load"===n.type)if(L.call(s)===q&&e.type)for(var l=0;l<s.length;l++)s[l]=new e.type(s[l]);else e.type&&(s=new e.type(s));t["load"===n.type?"resolve":"reject"](s)}catch(n){r.deferred.onerror(n),t.reject(n)}e.background!==!0&&r.endComputation()},O(e),t.promise=k(t.promise,e.initialValue),t.promise},r.deps=function(t){return n(e=t||e),e},r.deps.factory=o,r}("undefined"!=typeof window?window:{});"undefined"!=typeof n&&null!==n&&n.exports?n.exports=r:"function"==typeof e&&e.amd&&e(function(){return r})},{}],4:[function(e,t){function n(e,t,n){var r=n?c.invertKey(e):e;return{key:r,pos:c.key2pos(r),role:t.role,color:t.color}}function r(e,t){return e.role===t.role&&e.color===t.color}function o(e,t){return t.sort(function(t,n){return c.distance(e.pos,t.pos)-c.distance(e.pos,n.pos)})[0]}function a(e,t){var a=t.bounds(),i=a.width/8,s=a.height/8,l={},u=[],d=[],f=[],p=[],h=e.orientation!==t.orientation,v={},g="white"===t.orientation;for(var m in e.pieces){var b=n(m,e.pieces[m],h);v[b.key]=b}for(var y=0;y<c.allKeys.length;y++){var w=c.allKeys[y];if(w!==t.movable.dropped[1]){var x=t.pieces[w],k=v[w];x?k?r(x,k)||(f.push(k),p.push(n(w,x,!1))):p.push(n(w,x,!1)):k&&f.push(k)}}return p.forEach(function(e){var t=o(e,f.filter(c.partial(r,e)));if(t){var n=g?t.pos:e.pos,a=g?e.pos:t.pos,d=[(n[0]-a[0])*i,(a[1]-n[1])*s];l[e.key]=[d,d],u.push(t.key)}}),f.forEach(function(e){e.key===t.movable.dropped[0]||c.containsX(u,e.key)||d.push({piece:{role:e.role,color:e.color},left:12.5*(g?e.pos[0]-1:8-e.pos[0])+"%",bottom:12.5*(g?e.pos[1]-1:8-e.pos[1])+"%",opacity:1})}),{anims:l,fadings:d}}function i(e,t){return Math.round(e*t)/t}function s(e){if(e.animation.current.start){var t=1-((new Date).getTime()-e.animation.current.start)/e.animation.current.duration;if(0>=t)e.animation.current={},e.render();else{var n=u.easeInOutCubic(t);for(var r in e.animation.current.anims){var o=e.animation.current.anims[r];o[1]=[i(o[0][0]*n,10),i(o[0][1]*n,10)]}for(var a in e.animation.current.fadings)e.animation.current.fadings[a].opacity=i(n,100);e.render(),c.requestAnimationFrame(function(){s(e)})}}}function l(e,t){var n={orientation:t.orientation,pieces:{}};for(var r in t.pieces)n.pieces[r]={role:t.pieces[r].role,color:t.pieces[r].color};var o=e(),i=a(n,t);if(Object.keys(i.anims).length>0||i.fadings.length>0){var l=t.animation.current.start;t.animation.current={start:(new Date).getTime(),duration:t.animation.duration,anims:i.anims,fadings:i.fadings},l||s(t)}else t.renderRAF();return o}var c=e("./util"),u={easeInOutCubic:function(e){return.5>e?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}};t.exports=function(e,t,n){return function(){var r=[t].concat(Array.prototype.slice.call(arguments,0));if(t.render){if(t.animation.enabled&&!n)return l(c.partialApply(e,r),t);var o=e.apply(null,r);return t.renderRAF(),o}return e.apply(null,r)}}},{"./util":16}],5:[function(e,t){var n=e("./board");t.exports=function(e){return{set:e.set,toggleOrientation:e.toggleOrientation,getOrientation:function(){return e.data.orientation},getPieces:function(){return e.data.pieces},getMaterialDiff:function(){return n.getMaterialDiff(e.data)},getFen:e.getFen,dump:function(){return e.data},move:e.apiMove,setPieces:e.setPieces,setCheck:e.setCheck,playPremove:e.playPremove,cancelPremove:e.cancelPremove,cancelMove:e.cancelMove,stop:e.stop,explode:e.explode}}},{"./board":6}],6:[function(e,t){function n(e){setTimeout(e,1)}function r(e){e.orientation=M.opposite(e.orientation)}function o(e){e.lastMove=null,v(e,null),l(e)}function a(e,t){Object.keys(t).forEach(function(n){t[n]?e.pieces[n]=t[n]:delete e.pieces[n]}),e.movable.dropped=[]}function i(e,t){var n=t||e.turnColor;Object.keys(e.pieces).forEach(function(t){e.pieces[t].color===n&&"king"===e.pieces[t].role&&(e.check=t)})}function s(e,t,r){e.premovable.current=[t,r],n(M.partial(e.premovable.events.set,t,r))}function l(e){e.premovable.current&&(e.premovable.current=null,n(e.premovable.events.unset))}function c(e,t,n){if(e.autoCastle){var r=e.pieces[n];if("king"===r.role){var o=M.key2pos(t);if(5===o[0]&&(1===o[1]||8===o[1])){var a,i,s,l=M.key2pos(n);if(7===l[0]||8===l[0])a=M.pos2key([8,o[1]]),i=M.pos2key([6,o[1]]),s=M.pos2key([7,o[1]]);else{if(3!==l[0]&&1!==l[0])return;a=M.pos2key([1,o[1]]),i=M.pos2key([4,o[1]]),s=M.pos2key([3,o[1]])}delete e.pieces[t],delete e.pieces[n],delete e.pieces[a],e.pieces[s]={role:"king",color:r.color},e.pieces[i]={role:"rook",color:r.color}}}}}function u(e,t,r){var o=j(function(){if(t===r||!e.pieces[t])return!1;var o=e.pieces[r]&&e.pieces[r].color!==e.pieces[t].color?e.pieces[r]:null;return n(M.partial(e.events.move,t,r,o)),e.pieces[r]=e.pieces[t],delete e.pieces[t],e.lastMove=[t,r],e.check=null,c(e,t,r),n(e.events.change),!0},e)();return o&&(e.movable.dropped=[]),o}function d(e,t,n){var r=u(e,t,n);return r&&(e.movable.dests={},e.turnColor=M.opposite(e.turnColor)),r}function f(e,t,n){return u(e,t,n)}function p(e,t,r){r?m(e,t,r)?d(e,t,r)&&(v(e,null),n(M.partial(e.movable.events.after,t,r,{premove:!1,holdTime:T.stop()}))):y(e,t,r)?(s(e,t,r),v(e,null)):g(e,r)||b(e,r)?v(e,r):v(e,null):(v(e,null),"trash"===e.movable.dropOff&&(delete e.pieces[t],n(e.events.change)))}function h(e,t){e.selected?t?e.selected!==t&&p(e,e.selected,t):v(e,null):(g(e,t)||b(e,t))&&v(e,t),t&&n(M.partial(e.events.select,t))}function v(e,t){e.selected=t,e.premovable.dests=t&&b(e,t)?P(e.pieces,t,e.premovable.castle):null}function g(e,t){var n=e.pieces[t];return n&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}function m(e,t,n){return t!==n&&g(e,t)&&(e.movable.free||M.containsX(e.movable.dests[t],n))}function b(e,t){var n=e.pieces[t];return n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function y(e,t,n){return t!==n&&b(e,t)&&M.containsX(P(e.pieces,t,e.premovable.castle),n)}function w(e,t){var n=e.pieces[t];return n&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function x(e){var t=e.premovable.current;if(t){var r=t[0],o=t[1];m(e,r,o)&&d(e,r,o)&&n(M.partial(e.movable.events.after,r,o,{premove:!0})),l(e)}}function k(e){l(e),h(e,null)}function C(e){e.movable.color=null,e.movable.dests={},k(e)}function E(e,t,n){if(n||e.bounds){n=n||e.bounds();var r=Math.ceil(8*((t[0]-n.left)/n.width));r="white"===e.orientation?r:9-r;var o=Math.ceil(8-8*((t[1]-n.top)/n.height));return o="white"===e.orientation?o:9-o,r>0&&9>r&&o>0&&9>o?M.pos2key([r,o]):void 0}}function O(e){var t={king:0,queen:0,rook:0,bishop:0,knight:0,pawn:0};for(var n in e.pieces){var r=e.pieces[n];t[r.role]+="white"===r.color?1:-1}var o={white:{},black:{}};for(var a in t){var i=t[a];i>0?o.white[a]=i:0>i&&(o.black[a]=-i)}return o}var M=e("./util"),P=e("./premove"),j=e("./anim"),T=e("./hold");t.exports={reset:o,toggleOrientation:r,setPieces:a,setCheck:i,selectSquare:h,setSelected:v,isDraggable:w,canMove:m,userMove:p,apiMove:f,playPremove:x,unsetPremove:l,cancelMove:k,stop:C,getKeyAtDomPos:E,getMaterialDiff:O}},{"./anim":4,"./hold":13,"./premove":14,"./util":16}],7:[function(e,t){var n=e("merge"),r=e("./board"),o=e("./fen");t.exports=function(e,t){t&&(t.movable&&t.movable.dests&&delete e.movable.dests,n.recursive(e,t),e.fen&&(e.pieces=o.read(e.fen),e.check=t.check,e.drawable.shapes=[],delete e.fen),e.check===!0&&r.setCheck(e),e.movable.dropped=[],e.selected&&r.setSelected(e,e.selected),(!e.animation.duration||e.animation.duration<10)&&(e.animation.enabled=!1))}},{"./board":6,"./fen":12,merge:2}],8:[function(e,t){var n=e("./board"),r=e("./data"),o=e("./fen"),a=e("./configure"),i=e("./anim"),s=e("./drag");t.exports=function(e){this.data=r(e),this.vm={exploding:!1},this.getFen=function(){return o.write(this.data.pieces)}.bind(this),this.set=i(a,this.data),this.toggleOrientation=i(n.toggleOrientation,this.data),this.setPieces=i(n.setPieces,this.data),this.selectSquare=i(n.selectSquare,this.data,!0),this.apiMove=i(n.apiMove,this.data),this.playPremove=i(n.playPremove,this.data),this.cancelPremove=i(n.unsetPremove,this.data,!0),this.setCheck=i(n.setCheck,this.data,!0),this.cancelMove=i(function(e){n.cancelMove(e),s.cancel(e)}.bind(this),this.data,!0),this.stop=i(function(e){n.stop(e),s.cancel(e)}.bind(this),this.data,!0),this.explode=function(e){this.data.render&&(this.vm.exploding=e,this.data.renderRAF(),setTimeout(function(){this.vm.exploding=!1,this.data.renderRAF()}.bind(this),200))}.bind(this)}},{"./anim":4,"./board":6,"./configure":7,"./data":9,"./drag":10,"./fen":12}],9:[function(e,t){var n=e("./fen"),r=e("./configure");t.exports=function(e){var t={pieces:n.read(n.initial),orientation:"white",turnColor:"white",check:null,lastMove:null,selected:null,coordinates:!0,render:null,renderRAF:null,element:null,bounds:null,autoCastle:!1,viewOnly:!1,minimalDom:!1,disableContextMenu:!1,highlight:{lastMove:!0,check:!0,dragOver:!0},animation:{enabled:!0,duration:200,current:{}},movable:{free:!0,color:"both",dests:{},dropOff:"revert",dropped:[],showDests:!0,events:{after:function(){}}},premovable:{enabled:!0,showDests:!0,castle:!0,dests:[],current:null,events:{set:function(){},unset:function(){}}},draggable:{enabled:!0,distance:3,squareTarget:!1,centerPiece:!0,showGhost:!0,current:{}},events:{change:function(){},move:function(){},capture:function(){},select:function(){}},drawable:{enabled:!1,shapes:[],current:{}}};return r(t,e||{}),t}},{"./configure":7,"./fen":12}],10:[function(e,t){function n(e){return e?e.color+" "+e.role:""}function r(e,t){if(!(void 0!==t.button&&0!==t.button||t.touches&&t.touches.length>1)){t.stopPropagation(),t.preventDefault(),l=t.target;var r=e.selected,a=u.eventPosition(t),i=e.bounds(),s=c.getKeyAtDomPos(e,a,i),f=!!e.premovable.current;c.selectSquare(e,s);var p=e.selected===s;if(e.pieces[s]&&p&&c.isDraggable(e,s)){var h=e.element.querySelector("."+s).getBoundingClientRect();e.draggable.current={previouslySelected:r,orig:s,piece:n(e.pieces[s]),rel:a,epos:a,pos:[0,0],dec:e.draggable.centerPiece?[a[0]-(h.left+h.width/2),a[1]-(h.top+h.height/2)]:[0,0],bounds:i,started:!1},d.start()}else f&&c.unsetPremove(e);o(e)}}function o(e){u.requestAnimationFrame(function(){var t=e.draggable.current;t.orig&&(e.animation.current.start&&-1!==Object.keys(e.animation.current.anims).indexOf(t.orig)&&(e.animation.current={}),n(e.pieces[t.orig])!==t.piece?s(e):(!t.started&&u.distance(t.epos,t.rel)>=e.draggable.distance&&(t.started=!0),t.started&&(t.pos=[t.epos[0]-t.rel[0],t.epos[1]-t.rel[1]],t.over=c.getKeyAtDomPos(e,t.epos,t.bounds)))),e.render(),t.orig&&o(e)})}function a(e,t){t.touches&&t.touches.length>1||e.draggable.current.orig&&(e.draggable.current.epos=u.eventPosition(t))}function i(e,t){var n,r=e.draggable,o=r.current?r.current.orig:null;o&&(t&&"touchend"===t.type&&l!==t.target||(c.unsetPremove(e),r.current.started?(n=r.current.over,o!==n&&(e.movable.dropped=[o,n]),c.userMove(e,o,n)):r.current.previouslySelected===o&&c.setSelected(e,null),r.current={}))}function s(e){e.draggable.current.orig&&(e.draggable.current={},c.selectSquare(e,null))}var l,c=e("./board"),u=e("./util"),d=e("./hold");t.exports={start:r,move:a,end:i,cancel:s,processDrag:o}},{"./board":6,"./hold":13,"./util":16}],11:[function(e,t){function n(e,t){if(!(t.touches&&t.touches.length>1)){t.stopPropagation(),t.preventDefault(),d.cancelMove(e);var n=f.eventPosition(t),o=e.bounds(),a=d.getKeyAtDomPos(e,n,o);e.drawable.current={orig:a,over:a,epos:n,bounds:o},r(e)}}function r(e){f.requestAnimationFrame(function(){var t=e.drawable.current;t.orig&&(t.over=d.getKeyAtDomPos(e,t.epos,t.bounds)),e.render(),t.orig&&r(e)})}function o(e,t){e.drawable.current.orig&&(e.drawable.current.epos=f.eventPosition(t))}function a(e){var t=e.drawable,n=t.current.orig,r=t.current.over;n&&r&&(n===r?c(t,n):u(t,n,r),t.current={},e.render())}function i(e){e.drawable.current.orig&&(e.drawable.current={})}function s(e,t){0!==t.button||t.shiftKey||(e.drawable.shapes=[],e.render())}function l(e){return function(t){return!e(t)}}function c(e,t){var n=function(e){return 1===e.length&&e[0]===t},r=e.shapes.filter(n).length>0;r?e.shapes=e.shapes.filter(l(n)):e.shapes.push([t])}function u(e,t,n){var r=function(e){return 2===e.length&&(e[0]===t&&e[1]===n||e[1]===t&&e[0]===n)},o=e.shapes.filter(r).length>0;o?e.shapes=e.shapes.filter(l(r)):e.shapes.push([t,n])}var d=e("./board"),f=e("./util");t.exports={start:n,move:o,end:a,cancel:i,clear:s,processDraw:r}},{"./board":6,"./util":16}],12:[function(e,t){function n(e){"start"===e&&(e=a);var t={};return e.replace(/ .+$/,"").split("/").forEach(function(e,n){var r=0;e.split("").forEach(function(e){var a=parseInt(e);a?r+=a:(r++,t[o.pos2key([r,8-n])]={role:i[e.toLowerCase()],color:e===e.toLowerCase()?"black":"white"})})}),t}function r(e){return[8,7,6,5,4,3,2].reduce(function(e,t){return e.replace(new RegExp(Array(t+1).join("1"),"g"),t)},o.invRanks.map(function(t){return o.ranks.map(function(n){var r=e[o.pos2key([n,t])];if(r){var a=s[r.role];return"white"===r.color?a.toUpperCase():a}return"1"}).join("")}).join("/"))}var o=e("./util"),a="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",i={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},s={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};t.exports={initial:a,read:n,write:r}},{"./util":16}],13:[function(e,t){var n,r=function(){n=new Date},o=function(){n=null},a=function(){if(!n)return 0;var e=new Date-n;return n=null,e};t.exports={start:r,cancel:o,stop:a}},{}],14:[function(e,t){function n(e,t){return Math.abs(e-t)}function r(e,t,r,o,a){return n(t,o)<2&&("white"===e?a===r+1||2===r&&4===a&&t===o:a===r-1||7===r&&5===a&&t===o)}function o(e,t,r,o){var a=n(e,r),i=n(t,o);return 1===a&&2===i||2===a&&1===i}function a(e,t,r,o){return n(e,r)===n(t,o)}function i(e,t,n,r){return e===n||t===r}function s(e,t,n,r){return a(e,t,n,r)||i(e,t,n,r)}function l(e,t,r,o,a,i,s){return n(o,i)<2&&n(a,s)<2||r&&a===s&&a===("white"===e?1:8)&&(5===o&&(3===i||7===i)||d.containsX(t,i))}function c(e,t){return Object.keys(e).filter(function(n){var r=e[n];
return r&&r.color===t&&"rook"===r.role}).map(function(e){return d.key2pos(e)[0]})}function u(e,t,n){var u,f=e[t],p=d.key2pos(t);switch(f.role){case"pawn":u=r.bind(null,f.color);break;case"knight":u=o;break;case"bishop":u=a;break;case"rook":u=i;break;case"queen":u=s;break;case"king":u=l.bind(null,f.color,c(e,f.color),n)}return d.allPos.filter(function(e){return(p[0]!==e[0]||p[1]!==e[1])&&u(p[0],p[1],e[0],e[1])}).map(d.pos2key)}var d=e("./util");t.exports=u},{"./util":16}],15:[function(e,t){function n(e){return(e?2:4)/512*f.width}function r(e){return(e?7:10)/512*f.width}function o(e){return e?.5:1}function a(){return 24/512*f.width}function i(e){var t=f.width/8;return[(e[0]-.5)*t,(8.5-e[1])*t]}function s(e,t){var r=i(e),a=n(t),s=f.width/16;return{tag:"circle",attrs:{stroke:v,"stroke-width":a,fill:"none",opacity:o(t),cx:r[0],cy:r[1],r:s-a/2}}}function l(e,t,n){var s=a(),l=i(e),c=i(t),u=c[0]-l[0],d=c[1]-l[1],f=Math.atan2(d,u),p=Math.cos(f)*s,h=Math.sin(f)*s;return{tag:"line",attrs:{stroke:v,"stroke-width":r(n),"stroke-linecap":"round","marker-end":"url(#arrowhead)",opacity:o(n),x1:l[0],y1:l[1],x2:c[0]-p,y2:c[1]-h}}}function c(e,t){return"white"===t?e:[9-e[0],9-e[1]]}function u(e){return function(t){return t.map(function(t){return c(h(t),e)})}}function d(e){var t=e.drawable.current;if(t.orig&&t.over){var n=u(e.orientation)(t.orig===t.over?[t.orig]:[t.orig,t.over]);return 1===n.length?s(n[0],!0):l(n[0],n[1],!0)}}var f,p=e("mithril"),h=e("./util").key2pos,v="#008800",g=p("defs",p("marker",{id:"arrowhead",orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01},p("path",{d:"M0,0 V4 L3,2 Z",fill:v})));t.exports=function(e){if(e.data.bounds){var t=e.data.drawable.shapes.map(u(e.data.orientation));if((t.length||e.data.drawable.current.orig)&&(f||(f=e.data.bounds()),f.width===f.height))return{tag:"svg",children:[g,t.map(function(e){return 1===e.length?s(e[0],!1):2===e.length?l(e[0],e[1],!1):void 0}),d(e.data)]}}}},{"./util":16,mithril:3}],16:[function(e,t){function n(e){return b[e[0]-1]+e[1]}function r(e){return[b.indexOf(e[0])+1,parseInt(e[1])]}function o(e){return b[7-b.indexOf(e[0])]+(9-parseInt(e[1]))}function a(e){var t=[];for(var n in e)e[n]&&t.push(n);return t.join(" ")}function i(e){return"white"===e?"black":"white"}function s(e,t){return e&&(e[0]===t||e[1]===t)}function l(e,t){return e&&-1!==e.indexOf(t)}function c(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function u(){return"transform"in document.body.style?"transform":"webkitTransform"in document.body.style?"webkitTransform":"mozTransform"in document.body.style?"mozTransform":"oTransform"in document.body.style?"oTransform":"msTransform"}function d(){return m||(m=u()),m}function f(e){return"translate3d("+e[0]+"px,"+e[1]+"px,0)"}function p(e){return e.touches?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:[e.clientX,e.clientY]}function h(e,t){return e.bind.apply(e,[null].concat(t))}function v(){return h(arguments[0],Array.prototype.slice.call(arguments,1))}function g(e){return 2===e.buttons||2===e.button}var m,b="abcdefgh".split(""),y=[1,2,3,4,5,6,7,8],w=[8,7,6,5,4,3,2,1],x=function(){var e=[];return w.forEach(function(t){y.forEach(function(n){e.push([n,t])})}),e}(),k=x.slice().reverse(),C=x.map(n);t.exports={files:b,ranks:y,invRanks:w,allPos:x,invPos:k,allKeys:C,pos2key:n,key2pos:r,invertKey:o,classSet:a,opposite:i,translate:f,contains2:s,containsX:l,distance:c,eventPosition:p,partialApply:h,partial:v,transformProp:d,requestAnimationFrame:(window.requestAnimationFrame||window.setTimeout).bind(window),isRightButton:g}},{}],17:[function(e,t){function n(e){return["cg-piece",e.role,e.color].join(" ")}function r(e,t,r){var o={style:{},"class":n(r)},a=e.data.draggable.current;if(a.orig!==t||0===a.pos[0]&&0===a.pos[1]){if(e.data.animation.current.anims){var i=e.data.animation.current.anims[t];i&&(o.style[v.transformProp()]=v.translate(i[1]))}}else o.style[v.transformProp()]=v.translate([a.pos[0]+a.dec[0],a.pos[1]+a.dec[1]]),o["class"]+=" dragging";return{tag:"div",attrs:o}}function o(e){return{tag:"div",attrs:{"class":n(e)+" ghost"}}}function a(e,t,n){var a=v.files[t[0]-1],i=t[1],s=a+i,l=e.data.pieces[s],c=e.data.highlight.dragOver&&e.data.draggable.current.over===s,u={"class":"cg-square "+s+" "+v.classSet({selected:e.data.selected===s,check:e.data.highlight.check&&e.data.check===s,"last-move":e.data.highlight.lastMove&&v.contains2(e.data.lastMove,s),"move-dest":(c||e.data.movable.showDests)&&v.containsX(e.data.movable.dests[e.data.selected],s),"premove-dest":(c||e.data.premovable.showDests)&&v.containsX(e.data.premovable.dests,s),"current-premove":v.contains2(e.data.premovable.current,s),"drag-over":c,occupied:!!l,exploding:e.vm.exploding&&-1!==e.vm.exploding.indexOf(s)}),style:{left:12.5*(n?t[0]-1:8-t[0])+"%",bottom:12.5*(n?t[1]-1:8-t[1])+"%"}};e.data.coordinates&&(t[1]===(n?1:8)&&(u["data-coord-x"]=a),t[0]===(n?8:1)&&(u["data-coord-y"]=i));var d=[];return l&&(d.push(r(e,s,l)),e.data.draggable.current.orig===s&&e.data.draggable.showGhost&&d.push(o(l))),{tag:"div",attrs:u,children:d}}function i(e,t){var n=v.key2pos(t.over),r="white"===e.data.orientation?n[0]:9-n[0],o="white"===e.data.orientation?n[1]:9-n[1];return{tag:"div",attrs:{id:"cg-square-target",style:{width:t.bounds.width/4+"px",height:t.bounds.height/4+"px",left:(r-1.5)*t.bounds.width/8+"px",top:(7.5-o)*t.bounds.height/8+"px"}}}}function s(e){return{tag:"div",attrs:{"class":"cg-square fading",style:{left:e.left,bottom:e.bottom,opacity:e.opacity}},children:[{tag:"div",attrs:{"class":n(e.piece)}}]}}function l(e,t){var r=[];e.data.lastMove&&e.data.lastMove.forEach(function(e){var n=v.key2pos(e);r.push({tag:"div",attrs:{"class":"cg-square last-move",style:{left:12.5*(t?n[0]-1:8-n[0])+"%",bottom:12.5*(t?n[1]-1:8-n[1])+"%"}}})});for(var o=Object.keys(e.data.pieces),a=0,i=o.length;i>a;a++){var s=o[a],l=v.key2pos(s),c={style:{left:12.5*(t?l[0]-1:8-l[0])+"%",bottom:12.5*(t?l[1]-1:8-l[1])+"%"},"class":n(e.data.pieces[s])};if(e.data.animation.current.anims){var u=e.data.animation.current.anims[s];u&&(c.style[v.transformProp()]=v.translate(u[1]))}r.push({tag:"div",attrs:c})}return r}function c(e){var t="white"===e.data.orientation;if(e.data.minimalDom)return l(e,t);for(var n=t?v.allPos:v.invPos,r=[],o=0,c=n.length;c>o;o++)r.push(a(e,n[o],t));return e.data.draggable.current.over&&e.data.draggable.squareTarget&&r.push(i(e,e.data.draggable.current)),e.data.animation.current.fadings&&e.data.animation.current.fadings.forEach(function(e){r.push(s(e))}),e.data.drawable.enabled&&r.push(g(e)),r}function u(e,t,n){return function(r){e.drawable.enabled&&r.shiftKey?n(e,r):e.drawable.enabled&&v.isRightButton(r)?n(e,r):e.viewOnly||t(e,r)}}function d(e,t,n){var r=e.data,o=u(r,p.start,h.start),a=u(r,p.move,h.move),i=u(r,p.end,h.end),s=v.partial(h.clear,r),l=["touchstart","mousedown"],c=["touchmove","mousemove"],d=["touchend","mouseup"];l.forEach(function(e){t.addEventListener(e,o)}),c.forEach(function(e){document.addEventListener(e,a)}),d.forEach(function(e){document.addEventListener(e,i)}),t.addEventListener("mousedown",s),n.onunload=function(){l.forEach(function(e){t.removeEventListener(e,o)}),c.forEach(function(e){document.removeEventListener(e,a)}),d.forEach(function(e){document.removeEventListener(e,i)}),t.removeEventListener("mousedown",s)}}function f(e){return{tag:"div",attrs:{"class":"cg-board orientation-"+e.data.orientation,config:function(t,n,r){n||((!e.data.viewOnly||e.data.drawable.enabled)&&d(e,t,r),e.data.render=function(){m.render(t,c(e))},e.data.renderRAF=function(){v.requestAnimationFrame(e.data.render)},e.data.bounds=t.getBoundingClientRect.bind(t),e.data.element=t,e.data.render())}},children:[]}}var p=e("./drag"),h=e("./draw"),v=e("./util"),g=e("./svg"),m=e("mithril");t.exports=function(e){return{tag:"div",attrs:{config:function(t,n){n||t.addEventListener("contextmenu",function(t){return e.data.disableContextMenu||e.data.drawable.enabled?(t.preventDefault(),!1):void 0})},"class":["cg-board-wrap",e.data.viewOnly?"view-only":"manipulable",e.data.minimalDom?"minimal-dom":"full-dom"].join(" ")},children:[f(e)]}}},{"./drag":10,"./draw":11,"./svg":15,"./util":16,mithril:3}]},{},[1])(1)});