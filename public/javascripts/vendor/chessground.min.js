!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Chessground=e()}}(function(){return function i(a,s,c){function u(t,e){if(!s[t]){if(!a[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(l)return l(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var o=s[t]={exports:{}};a[t][0].call(o.exports,function(e){return u(a[t][1][e]||e)},o,o.exports,i,a,s,c)}return s[t].exports}for(var l="function"==typeof require&&require,e=0;e<c.length;e++)u(c[e]);return u}({1:[function(e,t,r){"use strict";var a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(r,"__esModule",{value:!0});var h=e("./util");function n(e,t){var r=e(t);return t.dom.redraw(),r}function g(e,t){return{key:e,pos:h.key2pos(e),piece:t}}function s(e){for(var t in e)return!1;return!0}r.anim=function(e,t){return t.animation.enabled?function(e,t){var r=a({},t.pieces),n=e(t),o=function(e,t){var r,n,o,i,a={},s=[],c={},u=[],l=[],d={};for(o in e)d[o]=g(o,e[o]);for(var f=0,p=h.allKeys;f<p.length;f++){var v=p[f];r=t.pieces[v],n=d[v],r?n?h.samePiece(r,n.piece)||(u.push(n),l.push(g(v,r))):l.push(g(v,r)):n&&u.push(n)}return l.forEach(function(t){(n=function(r,e){return e.sort(function(e,t){return h.distanceSq(r.pos,e.pos)-h.distanceSq(r.pos,t.pos)})[0]}(t,u.filter(function(e){return h.samePiece(t.piece,e.piece)})))&&(i=[n.pos[0]-t.pos[0],n.pos[1]-t.pos[1]],a[t.key]=i.concat(i),s.push(n.key))}),u.forEach(function(e){h.containsX(s,e.key)||(c[e.key]=e.piece)}),{anims:a,fadings:c}}(r,t);if(s(o.anims)&&s(o.fadings))t.dom.redraw();else{var i=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:o},i||function t(r,e){var n=r.animation.current;if(void 0===n)return void(r.dom.destroyed||r.dom.redrawNow());var o=1-(e-n.start)*n.frequency;if(o<=0)r.animation.current=void 0,r.dom.redrawNow();else{var i=(c=o)<.5?4*c*c*c:(c-1)*(2*c-2)*(2*c-2)+1;for(var a in n.plan.anims){var s=n.plan.anims[a];s[2]=s[0]*i,s[3]=s[1]*i}r.dom.redrawNow(!0),requestAnimationFrame(function(e){return void 0===e&&(e=performance.now()),t(r,e)})}var c}(t,performance.now())}return n}(e,t):n(e,t)},r.render=n},{"./util":18}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=e("./board"),i=e("./fen"),a=e("./config"),s=e("./anim"),c=e("./drag"),u=e("./explosion");r.start=function(n,e){function r(){o.toggleOrientation(n),e()}return{set:function(t){t.orientation&&t.orientation!==n.orientation&&r(),(t.fen?s.anim:s.render)(function(e){return a.configure(e,t)},n)},state:n,getFen:function(){return i.write(n.pieces)},toggleOrientation:r,setPieces:function(t){s.anim(function(e){return o.setPieces(e,t)},n)},selectSquare:function(t,r){t?s.anim(function(e){return o.selectSquare(e,t,r)},n):n.selected&&(o.unselect(n),n.dom.redraw())},move:function(t,r){s.anim(function(e){return o.baseMove(e,t,r)},n)},newPiece:function(t,r){s.anim(function(e){return o.baseNewPiece(e,t,r)},n)},playPremove:function(){if(n.premovable.current){if(s.anim(o.playPremove,n))return!0;n.dom.redraw()}return!1},playPredrop:function(e){if(n.predroppable.current){var t=o.playPredrop(n,e);return n.dom.redraw(),t}return!1},cancelPremove:function(){s.render(o.unsetPremove,n)},cancelPredrop:function(){s.render(o.unsetPredrop,n)},cancelMove:function(){s.render(function(e){o.cancelMove(e),c.cancel(e)},n)},stop:function(){s.render(function(e){o.stop(e),c.cancel(e)},n)},explode:function(e){u.default(n,e)},setAutoShapes:function(t){s.render(function(e){return e.drawable.autoShapes=t},n)},setShapes:function(t){s.render(function(e){return e.drawable.shapes=t},n)},getKeyAtDomPos:function(e){return o.getKeyAtDomPos(e,"white"===n.orientation,n.dom.bounds())},redrawAll:e,dragNewPiece:function(e,t,r){c.dragNewPiece(n,e,t,r)},destroy:function(){o.stop(n),n.dom.unbind&&n.dom.unbind(),n.dom.destroyed=!0}}}},{"./anim":1,"./board":3,"./config":5,"./drag":6,"./explosion":10,"./fen":11}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var l=e("./util"),a=e("./premove");function s(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];e&&setTimeout(function(){return e.apply(void 0,t)},1)}function c(e){e.premovable.current&&(e.premovable.current=void 0,s(e.premovable.events.unset))}function u(e){var t=e.predroppable;t.current&&(t.current=void 0,s(t.events.unset))}function o(e,t,r){var n=e.pieces[t],o=e.pieces[r];if(t===r||!n)return!1;var i=o&&o.color!==n.color?o:void 0;return r==e.selected&&p(e),s(e.events.move,t,r,i),function(e,t,r){if(!e.autoCastle)return!1;var n=e.pieces[t];if(!n||"king"!==n.role)return!1;var o=l.key2pos(t);if(5!==o[0])return!1;if(1!==o[1]&&8!==o[1])return!1;var i,a,s,c=l.key2pos(r);if(7===c[0]||8===c[0])i=l.pos2key([8,o[1]]),a=l.pos2key([6,o[1]]),s=l.pos2key([7,o[1]]);else{if(3!==c[0]&&1!==c[0])return!1;i=l.pos2key([1,o[1]]),a=l.pos2key([4,o[1]]),s=l.pos2key([3,o[1]])}var u=e.pieces[i];return!(!u||"rook"!==u.role)&&(delete e.pieces[t],delete e.pieces[i],e.pieces[s]=n,e.pieces[a]=u,!0)}(e,t,r)||(e.pieces[r]=n,delete e.pieces[t]),e.lastMove=[t,r],e.check=void 0,s(e.events.change),i||!0}function i(e,t,r,n){if(e.pieces[r]){if(!n)return!1;delete e.pieces[r]}return s(e.events.dropNewPiece,t,r),e.pieces[r]=t,e.lastMove=[r],e.check=void 0,s(e.events.change),e.movable.dests=void 0,e.turnColor=l.opposite(e.turnColor),!0}function d(e,t,r){var n=o(e,t,r);return n&&(e.movable.dests=void 0,e.turnColor=l.opposite(e.turnColor),e.animation.current=void 0),n}function n(e,t,r){if(h(e,t,r)){var n=d(e,t,r);if(n){var o=e.hold.stop();p(e);var i={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:o};return!0!==n&&(i.captured=n),s(e.movable.events.after,t,r,i),!0}}else!function(e,t,r){return t!==r&&g(e,t)&&l.containsX(a.default(e.pieces,t,e.premovable.castle),r)}(e,t,r)?v(e,r)||g(e,r)?(f(e,r),e.hold.start()):p(e):(function(e,t,r,n){u(e),e.premovable.current=[t,r],s(e.premovable.events.set,t,r,n)}(e,t,r,{ctrlKey:e.stats.ctrlKey}),p(e));return!1}function f(e,t){e.selected=t,g(e,t)?e.premovable.dests=a.default(e.pieces,t,e.premovable.castle):e.premovable.dests=void 0}function p(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function v(e,t){var r=e.pieces[t];return!!r&&("both"===e.movable.color||e.movable.color===r.color&&e.turnColor===r.color)}function h(e,t,r){return t!==r&&v(e,t)&&(e.movable.free||!!e.movable.dests&&l.containsX(e.movable.dests[t],r))}function g(e,t){var r=e.pieces[t];return!!r&&e.premovable.enabled&&e.movable.color===r.color&&e.turnColor!==r.color}function b(e){c(e),u(e),p(e)}r.callUserFunction=s,r.toggleOrientation=function(e){e.orientation=l.opposite(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0},r.reset=function(e){e.lastMove=void 0,p(e),c(e),u(e)},r.setPieces=function(e,t){for(var r in t){var n=t[r];n?e.pieces[r]=n:delete e.pieces[r]}},r.setCheck=function(e,t){if(!(e.check=void 0)===t&&(t=e.turnColor),t)for(var r in e.pieces)"king"===e.pieces[r].role&&e.pieces[r].color===t&&(e.check=r)},r.unsetPremove=c,r.unsetPredrop=u,r.baseMove=o,r.baseNewPiece=i,r.userMove=n,r.dropNewPiece=function(e,t,r,n){if(function(e,t,r){var n=e.pieces[t];return!!n&&r&&(t===r||!e.pieces[r])&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}(e,t,r)||n){var o=e.pieces[t];delete e.pieces[t],i(e,o,r,n),s(e.movable.events.afterNewPiece,o.role,r,{predrop:!1})}else!function(e,t,r){var n=e.pieces[t],o=e.pieces[r];return!!n&&r&&(!o||o.color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==n.role||"1"!==r[1]&&"8"!==r[1])&&e.movable.color===n.color&&e.turnColor!==n.color}(e,t,r)?(c(e),u(e)):function(e,t,r){c(e),e.predroppable.current={role:t,key:r},s(e.predroppable.events.set,t,r)}(e,e.pieces[t].role,r);delete e.pieces[t],p(e)},r.selectSquare=function(e,t,r){e.selected?e.selected!==t||e.draggable.enabled?(e.selectable.enabled||r)&&e.selected!==t?n(e,e.selected,t)&&(e.stats.dragged=!1):e.hold.start():(p(e),e.hold.cancel()):(v(e,t)||g(e,t))&&(f(e,t),e.hold.start()),s(e.events.select,t)},r.setSelected=f,r.unselect=p,r.canMove=h,r.isDraggable=function(e,t){var r=e.pieces[t];return!!r&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===r.color&&(e.turnColor===r.color||e.premovable.enabled))},r.playPremove=function(e){var t=e.premovable.current;if(!t)return!1;var r=t[0],n=t[1],o=!1;if(h(e,r,n)){var i=d(e,r,n);if(i){var a={premove:!0};!0!==i&&(a.captured=i),s(e.movable.events.after,r,n,a),o=!0}}return c(e),o},r.playPredrop=function(e,t){var r=e.predroppable.current,n=!1;return!!r&&(t(r)&&i(e,{role:r.role,color:e.movable.color},r.key)&&(s(e.movable.events.afterNewPiece,r.role,r.key,{predrop:!0}),n=!0),u(e),n)},r.cancelMove=b,r.stop=function(e){e.movable.color=e.movable.dests=e.animation.current=void 0,b(e)},r.getKeyAtDomPos=function(e,t,r){var n=Math.ceil((e[0]-r.left)/r.width*8);t||(n=9-n);var o=Math.ceil(8-(e[1]-r.top)/r.height*8);return t||(o=9-o),0<n&&n<9&&0<o&&o<9?l.pos2key([n,o]):void 0}},{"./premove":13,"./util":18}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./api"),o=e("./config"),c=e("./state"),u=e("./wrap"),l=e("./events"),d=e("./render"),f=e("./svg"),p=e("./util");r.Chessground=function(i,e){var a=c.defaults();function s(){var e=a.dom&&a.dom.unbind;i.classList.add("cg-wrap");function t(e){d.default(a),!e&&n.svg&&f.renderSvg(a,n.svg)}var r=a.viewOnly&&!a.drawable.visible,n=u.default(i,a,r),o=p.memo(function(){return n.board.getBoundingClientRect()});a.dom={elements:n,bounds:o,redraw:function(e){var t=!1;return function(){t||(t=!0,requestAnimationFrame(function(){e(),t=!1}))}}(t),redrawNow:t,unbind:e,relative:r},a.drawable.prevSvgHash="",t(!1),l.bindBoard(a),e||(a.dom.unbind=l.bindDocument(a,s)),a.events.insert&&a.events.insert(n)}return o.configure(a,e||{}),s(),n.start(a,s)}},{"./api":2,"./config":5,"./events":9,"./render":14,"./state":15,"./svg":16,"./util":18,"./wrap":19}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a=e("./board"),s=e("./fen");function c(e){return"object"==typeof e}r.configure=function(e,t){if(t.movable&&t.movable.dests&&(e.movable.dests=void 0),function e(t,r){for(var n in r)c(t[n])&&c(r[n])?e(t[n],r[n]):t[n]=r[n]}(e,t),t.fen&&(e.pieces=s.read(t.fen),e.drawable.shapes=[]),t.hasOwnProperty("check")&&a.setCheck(e,t.check||!1),t.hasOwnProperty("lastMove")&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&a.setSelected(e,e.selected),(!e.animation.duration||e.animation.duration<100)&&(e.animation.enabled=!1),!e.movable.rookCastle&&e.movable.dests){var r="white"===e.movable.color?1:8,n="e"+r,o=e.movable.dests[n],i=e.pieces[n];if(!o||!i||"king"!==i.role)return;e.movable.dests[n]=o.filter(function(e){return!(e==="a"+r&&-1!==o.indexOf("c"+r)||e==="h"+r&&-1!==o.indexOf("g"+r))})}}},{"./board":3,"./fen":11}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var v=e("./board"),h=e("./util"),g=e("./draw"),b=e("./anim");function m(e,t){var r="white"===e.orientation,n=e.dom.bounds(),o=Math.pow(n.width/8,2);for(var i in e.pieces){var a=w(i,r,n),s=[a.left+a.width/2,a.top+a.height/2];if(h.distanceSq(s,t)<=o)return!0}return!1}function y(a){requestAnimationFrame(function(){var e=a.draggable.current;if(e){a.animation.current&&a.animation.current.plan.anims[e.orig]&&(a.animation.current=void 0);var t=a.pieces[e.orig];if(t&&h.samePiece(t,e.piece)){if(!e.started&&h.distanceSq(e.epos,e.rel)>=Math.pow(a.draggable.distance,2)&&(e.started=!0),e.started){if("function"==typeof e.element){var r=e.element();if(!r)return;e.element=r,e.element.cgDragging=!0,e.element.classList.add("dragging")}var n="white"===a.orientation,o=a.dom.bounds();e.pos=[e.epos[0]-e.rel[0],e.epos[1]-e.rel[1]];var i=h.posToTranslateAbs(o)(e.origPos,n);i[0]+=e.pos[0]+e.dec[0],i[1]+=e.pos[1]+e.dec[1],h.translateAbs(e.element,i)}}else s(a);y(a)}})}function s(e){var t=e.draggable.current;t&&(t.newPiece&&delete e.pieces[t.orig],e.draggable.current=void 0,v.unselect(e),i(e),e.dom.redraw())}function i(e){var t=e.dom.elements;t.ghost&&h.setVisible(t.ghost,!1)}function w(e,t,r){var n=h.key2pos(e);return t||(n[0]=9-n[0],n[1]=9-n[1]),{left:r.left+r.width*(n[0]-1)/8,top:r.top+r.height*(8-n[1])/8,width:r.width/8,height:r.height/8}}function k(e,t){for(var r=e.dom.elements.board.firstChild;r;){if(r.cgKey===t&&"PIECE"===r.tagName)return r;r=r.nextSibling}}r.start=function(e,t){if(!(void 0!==t.button&&0!==t.button||t.touches&&1<t.touches.length)){var r="white"===e.orientation,n=e.dom.bounds(),o=h.eventPosition(t),i=v.getKeyAtDomPos(o,r,n);if(i){var a=e.pieces[i],s=e.selected;s||!e.drawable.enabled||!e.drawable.eraseOnClick&&a&&a.color===e.turnColor||g.clear(e),"touchstart"!==t.type||!1===t.cancelable||t.touches&&e.movable.color&&!a&&!s&&!m(e,o)||t.preventDefault();var c=!!e.premovable.current,u=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&v.canMove(e,e.selected,i)?b.anim(function(e){return v.selectSquare(e,i)},e):v.selectSquare(e,i);var l=e.selected===i,d=k(e,i);if(a&&d&&l&&v.isDraggable(e,i)){var f=w(i,r,n);e.draggable.current={orig:i,origPos:h.key2pos(i),piece:a,rel:o,epos:o,pos:[0,0],dec:e.draggable.centerPiece?[o[0]-(f.left+f.width/2),o[1]-(f.top+f.height/2)]:[0,0],started:e.draggable.autoDistance&&e.stats.dragged,element:d,previouslySelected:s,originTarget:t.target},d.cgDragging=!0,d.classList.add("dragging");var p=e.dom.elements.ghost;p&&(p.className="ghost "+a.color+" "+a.role,h.translateAbs(p,h.posToTranslateAbs(n)(h.key2pos(i),r)),h.setVisible(p,!0)),y(e)}else c&&v.unsetPremove(e),u&&v.unsetPredrop(e);e.dom.redraw()}}},r.pieceCloseTo=m,r.dragNewPiece=function(e,t,r,n){var o="a0";e.pieces.a0=t,e.dom.redraw();var i=h.eventPosition(r),a="white"===e.orientation,s=e.dom.bounds(),c=w(o,a,s),u=[(a?0:7)*c.width+s.left,(a?8:-1)*c.height+s.top];e.draggable.current={orig:o,origPos:h.key2pos(o),piece:t,rel:u,epos:i,pos:[i[0]-u[0],i[1]-u[1]],dec:[-c.width/2,-c.height/2],started:!0,element:function(){return k(e,o)},originTarget:r.target,newPiece:!0,force:n||!1},y(e)},r.move=function(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.epos=h.eventPosition(t))},r.end=function(e,t){var r=e.draggable.current;if(r)if("touchend"===t.type&&!1!==t.cancelable&&t.preventDefault(),"touchend"!==t.type||!r||r.originTarget===t.target||r.newPiece){v.unsetPremove(e),v.unsetPredrop(e);var n=h.eventPosition(t)||r.epos,o=v.getKeyAtDomPos(n,"white"===e.orientation,e.dom.bounds());o&&r.started?r.newPiece?v.dropNewPiece(e,r.orig,o,r.force):(e.stats.ctrlKey=t.ctrlKey,v.userMove(e,r.orig,o)&&(e.stats.dragged=!0)):r.newPiece?delete e.pieces[r.orig]:e.draggable.deleteOnDropOff&&(delete e.pieces[r.orig],v.callUserFunction(e.events.change)),(!r||r.orig!==r.previouslySelected||r.orig!==o&&o)&&e.selectable.enabled||v.unselect(e),i(e),e.draggable.current=void 0,e.dom.redraw()}else e.draggable.current=void 0},r.cancel=s},{"./anim":1,"./board":3,"./draw":7,"./util":18}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=e("./board"),i=e("./util"),a=["green","red","blue","yellow"];function s(r){requestAnimationFrame(function(){var e=r.drawable.current;if(e){var t=o.getKeyAtDomPos(e.pos,"white"===r.orientation,r.dom.bounds());t!==e.mouseSq&&(e.mouseSq=t,e.dest=t!==e.orig?t:void 0,r.dom.redrawNow()),s(r)}})}function n(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function c(e){e.onChange&&e.onChange(e.shapes)}r.start=function(e,t){if(!(t.touches&&1<t.touches.length)){"touchstart"===t.type&&(t.stopPropagation(),t.preventDefault()),t.ctrlKey?o.unselect(e):o.cancelMove(e);var r=i.eventPosition(t),n=o.getKeyAtDomPos(r,"white"===e.orientation,e.dom.bounds());n&&(e.drawable.current={orig:n,pos:r,brush:function(e){var t=e.shiftKey&&i.isRightButton(e)?1:0,r=e.altKey?2:0;return a[t+r]}(t)},s(e))}},r.processDraw=s,r.move=function(e,t){e.drawable.current&&(e.drawable.current.pos=i.eventPosition(t))},r.end=function(e){var t=e.drawable.current;t&&(t.mouseSq&&function(e,t){function r(e){return e.orig===t.orig&&e.dest===t.dest}var n=e.shapes.filter(r)[0];n&&(e.shapes=e.shapes.filter(function(t){return function(e){return!t(e)}}(r)));n&&n.brush===t.brush||e.shapes.push(t);c(e)}(e.drawable,t),n(e))},r.cancel=n,r.clear=function(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),c(e.drawable))}},{"./board":3,"./util":18}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("./board"),a=e("./util"),n=e("./drag");r.setDropMode=function(e,t){e.dropmode={active:!0,piece:t},n.cancel(e)},r.cancelDropMode=function(e){e.dropmode={active:!1}},r.drop=function(e,t){if(e.dropmode.active){i.unsetPremove(e),i.unsetPredrop(e);var r=e.dropmode.piece;if(r){e.pieces.a0=r;var n=a.eventPosition(t),o=n&&i.getKeyAtDomPos(n,"white"===e.orientation,e.dom.bounds());o&&i.dropNewPiece(e,"a0",o)}e.dom.redraw()}}},{"./board":3,"./drag":6,"./util":18}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a=e("./drag"),s=e("./draw"),n=e("./drop"),o=e("./util");function c(e,t,r,n){return e.addEventListener(t,r,n),function(){return e.removeEventListener(t,r)}}function u(t,r,n){return function(e){e.shiftKey||o.isRightButton(e)?t.drawable.enabled&&n(t,e):t.viewOnly||r(t,e)}}r.bindBoard=function(e){if(!e.viewOnly){var t=e.dom.elements.board,r=function(t){return function(e){t.draggable.current?a.cancel(t):t.drawable.current?s.cancel(t):e.shiftKey||o.isRightButton(e)?t.drawable.enabled&&s.start(t,e):t.viewOnly||(t.dropmode.active?n.drop(t,e):a.start(t,e))}}(e);t.addEventListener("touchstart",r,{passive:!1}),t.addEventListener("mousedown",r,{passive:!0}),(e.disableContextMenu||e.drawable.enabled)&&t.addEventListener("contextmenu",function(e){return e.preventDefault()})}},r.bindDocument=function(e,t){var r=[];if(!e.dom.relative&&e.resizable){r.push(c(document.body,"chessground.resize",function(){e.dom.bounds.clear(),requestAnimationFrame(t)}))}if(!e.viewOnly){var n=u(e,a.move,s.move),o=u(e,a.end,s.end);["touchmove","mousemove"].forEach(function(e){return r.push(c(document,e,n))}),["touchend","mouseup"].forEach(function(e){return r.push(c(document,e,o))});var i=function(){return e.dom.bounds.clear()};r.push(c(window,"scroll",i,{passive:!0})),r.push(c(window,"resize",i,{passive:!0}))}return function(){return r.forEach(function(e){return e()})}}},{"./drag":6,"./draw":7,"./drop":8,"./util":18}],10:[function(e,t,r){"use strict";function n(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(function(){n(e,2),setTimeout(function(){return n(e,void 0)},120)},120)}},{}],11:[function(e,t,l){"use strict";Object.defineProperty(l,"__esModule",{value:!0});var d=e("./util"),r=e("./types");l.initial="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR";var f={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},i={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};l.read=function(e){"start"===e&&(e=l.initial);for(var t={},r=8,n=0,o=0,i=e;o<i.length;o++){var a=i[o];switch(a){case" ":return t;case"/":if(0===--r)return t;n=0;break;case"~":var s=t[d.pos2key([n,r])];s&&(s.promoted=!0);break;default:var c=a.charCodeAt(0);if(c<57)n+=c-48;else{++n;var u=a.toLowerCase();t[d.pos2key([n,r])]={role:f[u],color:a===u?"black":"white"}}}}return t},l.write=function(o){return d.invRanks.map(function(n){return r.ranks.map(function(e){var t=o[d.pos2key([e,n])];if(t){var r=i[t.role];return"white"===t.color?r.toUpperCase():r}return"1"}).join("")}).join("/").replace(/1{2,}/g,function(e){return e.length.toString()})}},{"./types":17,"./util":18}],12:[function(e,t,r){t.exports=e("./chessground").Chessground},{"./chessground":4}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=e("./util");function c(e,t){return Math.abs(e-t)}function a(e,t,r,n){var o=c(e,r),i=c(t,n);return 1===o&&2===i||2===o&&1===i}function u(e,t,r,n){return c(e,r)===c(t,n)}function l(e,t,r,n){return e===r||t===n}function d(e,t,r,n){return u(e,t,r,n)||l(e,t,r,n)}r.default=function(e,t,r){var n,o=e[t],i=s.key2pos(t);switch(o.role){case"pawn":n=function(o){return function(e,t,r,n){return c(e,r)<2&&("white"===o?n===t+1||t<=2&&n===t+2&&e===r:n===t-1||7<=t&&n===t-2&&e===r)}}(o.color);break;case"knight":n=a;break;case"bishop":n=u;break;case"rook":n=l;break;case"queen":n=d;break;case"king":n=function(o,i,a){return function(e,t,r,n){return c(e,r)<2&&c(t,n)<2||a&&t===n&&t===("white"===o?1:8)&&(5===e&&(3===r||7===r)||s.containsX(i,r))}}(o.color,function(r,n){return Object.keys(r).filter(function(e){var t=r[e];return t&&t.color===n&&"rook"===t.role}).map(function(e){return s.key2pos(e)[0]})}(e,o.color),r)}return s.allKeys.map(s.key2pos).filter(function(e){return(i[0]!==e[0]||i[1]!==e[1])&&n(i[0],i[1],e[0],e[1])}).map(s.pos2key)}},{"./util":18}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var T=e("./util"),L=e("./util");function F(e,t){for(var r in t)e.dom.elements.board.removeChild(t[r])}function R(e,t){var r=2+8*(e[1]-1)+(8-e[0]);return t&&(r=67-r),r+""}function W(e){return e.color+" "+e.role}function B(e,t,r){e[t]?e[t]+=" "+r:e[t]=r}r.default=function(e){var t,r,n,o,i,a,s,c,u,l,d,f="white"===e.orientation,p=e.dom.relative?L.posToTranslateRel:L.posToTranslateAbs(e.dom.bounds()),v=e.dom.relative?L.translateRel:L.translateAbs,h=e.dom.elements.board,g=e.pieces,b=e.animation.current,m=b?b.plan.anims:{},y=b?b.plan.fadings:{},w=e.draggable.current,k=function(e){var t,r,n={};if(e.lastMove&&e.highlight.lastMove)for(t in e.lastMove)B(n,e.lastMove[t],"last-move");e.check&&e.highlight.check&&B(n,e.check,"check");if(e.selected&&(B(n,e.selected,"selected"),e.movable.showDests)){var o=e.movable.dests&&e.movable.dests[e.selected];if(o)for(t in o)r=o[t],B(n,r,"move-dest"+(e.pieces[r]?" oc":""));var i=e.premovable.dests;if(i)for(t in i)r=i[t],B(n,r,"premove-dest"+(e.pieces[r]?" oc":""))}var a=e.premovable.current;if(a)for(t in a)B(n,a[t],"current-premove");else e.predroppable.current&&B(n,e.predroppable.current.key,"current-premove");var s=e.exploding;if(s)for(t in s.keys)B(n,s.keys[t],"exploding"+s.stage);return n}(e),P={},M={},C={},O={},x=Object.keys(g);for(n=h.firstChild;n;){if(t=n.cgKey,"PIECE"===n.tagName)if(o=g[t],a=m[t],s=y[t],i=n.cgPiece,!n.cgDragging||w&&w.orig===t||(n.classList.remove("dragging"),v(n,p(T.key2pos(t),f)),n.cgDragging=!1),!s&&n.cgFading&&(n.cgFading=!1,n.classList.remove("fading")),o){if(a&&n.cgAnimating&&i===W(o))(D=T.key2pos(t))[0]+=a[2],D[1]+=a[3],n.classList.add("anim"),v(n,p(D,f));else n.cgAnimating&&(n.cgAnimating=!1,n.classList.remove("anim"),v(n,p(T.key2pos(t),f)),e.addPieceZIndex&&(n.style.zIndex=R(T.key2pos(t),f)));i!==W(o)||s&&n.cgFading?s&&i===W(s)?(n.classList.add("fading"),n.cgFading=!0):C[i]?C[i].push(n):C[i]=[n]:P[t]=!0}else C[i]?C[i].push(n):C[i]=[n];else if("SQUARE"===n.tagName){var _=n.className;k[t]===_?M[t]=!0:O[_]?O[_].push(n):O[_]=[n]}n=n.nextSibling}for(var A in k)if(!M[A]){d=(l=O[k[A]])&&l.pop();var S=p(T.key2pos(A),f);if(d)d.cgKey=A,v(d,S);else{var E=T.createEl("square",k[A]);E.cgKey=A,v(E,S),h.insertBefore(E,h.firstChild)}}for(var K in x)if(r=g[t=x[K]],a=m[t],!P[t])if(u=(c=C[W(r)])&&c.pop()){u.cgKey=t,u.cgFading&&(u.classList.remove("fading"),u.cgFading=!1);var D=T.key2pos(t);e.addPieceZIndex&&(u.style.zIndex=R(D,f)),a&&(u.cgAnimating=!0,u.classList.add("anim"),D[0]+=a[2],D[1]+=a[3]),v(u,p(D,f))}else{var q=W(r),j=T.createEl("piece",q);D=T.key2pos(t);j.cgPiece=q,j.cgKey=t,a&&(j.cgAnimating=!0,D[0]+=a[2],D[1]+=a[3]),v(j,p(D,f)),e.addPieceZIndex&&(j.style.zIndex=R(D,f)),h.appendChild(j)}for(var N in C)F(e,C[N]);for(var N in O)F(e,O[N])}},{"./util":18}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./fen"),o=e("./util");r.defaults=function(){return{pieces:n.read(n.initial),orientation:"white",turnColor:"white",coordinates:!0,autoCastle:!0,viewOnly:!1,disableContextMenu:!1,resizable:!0,addPieceZIndex:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,centerPiece:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"https://lichess1.org/assets/piece/cburnett/"},prevSvgHash:""},hold:o.timer()}}},{"./fen":11,"./util":18}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var d=e("./util");function v(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function u(e,t,r){var n=e.orig,o=e.dest,i=e.brush,a=e.piece,s=e.modifiers;return[r,n,o,i,o&&1<t[o],a&&function(e){return[e.color,e.role,e.scale].filter(function(e){return e}).join("")}(a),s&&function(e){return""+(e.lineWidth||"")}(s)].filter(function(e){return e}).join("")}function l(e){var t=h(v("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return t.appendChild(h(v("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function h(e,t){for(var r in t)e.setAttribute(r,t[r]);return e}function f(e,t){return"white"===t?e:[9-e[0],9-e[1]]}function p(e,t){var r={color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth)};return r.key=[e.key,t.lineWidth].filter(function(e){return e}).join(""),r}function g(e,t){return(e.opacity||1)*(t?.9:1)}function b(e,t){return[(e[0]-.5)*t.width/8,(8.5-e[1])*t.height/8]}r.createElement=v,r.renderSvg=function(e,t){var r=e.drawable,n=r.current,o=n&&n.mouseSq?n:void 0,i={};r.shapes.concat(r.autoShapes).concat(o?[o]:[]).forEach(function(e){e.dest&&(i[e.dest]=(i[e.dest]||0)+1)});var a=r.shapes.concat(r.autoShapes).map(function(e){return{shape:e,current:!1,hash:u(e,i,!1)}});o&&a.push({shape:o,current:!0,hash:u(o,i,!0)});var s=a.map(function(e){return e.hash}).join("");if(s!==e.drawable.prevSvgHash){e.drawable.prevSvgHash=s;var c=t.firstChild;!function(t,e,r){var n,o={};e.forEach(function(e){e.shape.dest&&(n=t.brushes[e.shape.brush],e.shape.modifiers&&(n=p(n,e.shape.modifiers)),o[n.key]=n)});var i={},a=r.firstChild;for(;a;)i[a.getAttribute("cgKey")]=!0,a=a.nextSibling;for(var s in o)i[s]||r.appendChild(l(o[s]))}(r,a,c),function(t,e,r,n,o,i){var a=t.dom.bounds(),s={},c=[];e.forEach(function(e){s[e.hash]=!1});var u,l=i.nextSibling;for(;l;)u=l.getAttribute("cgHash"),s.hasOwnProperty(u)?s[u]=!0:c.push(l),l=l.nextSibling;c.forEach(function(e){return o.removeChild(e)}),e.forEach(function(e){s[e.hash]||o.appendChild(function(e,t,r,n,o){var i,a=t.shape,s=t.current,c=t.hash;if(a.piece)i=function(e,t,r,n){var o=b(t,n),i=n.width/8*(r.scale||1),a=r.color[0]+("knight"===r.role?"n":r.role[0]).toUpperCase();return h(v("image"),{className:r.role+" "+r.color,x:o[0]-i/2,y:o[1]-i/2,width:i,height:i,href:e+a+".svg"})}(e.drawable.pieces.baseUrl,f(d.key2pos(a.orig),e.orientation),a.piece,o);else{var u=f(d.key2pos(a.orig),e.orientation);if(a.orig&&a.dest){var l=r[a.brush];a.modifiers&&(l=p(l,a.modifiers)),i=function(e,t,r,n,o,i){var a=function(e,t){return(t?20:10)/512*e.width}(i,o&&!n),s=b(t,i),c=b(r,i),u=c[0]-s[0],l=c[1]-s[1],d=Math.atan2(l,u),f=Math.cos(d)*a,p=Math.sin(d)*a;return h(v("line"),{stroke:e.color,"stroke-width":function(e,t,r){return(e.lineWidth||10)*(t?.85:1)/512*r.width}(e,n,i),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:g(e,n),x1:s[0],y1:s[1],x2:c[0]-f,y2:c[1]-p})}(l,u,f(d.key2pos(a.dest),e.orientation),s,1<n[a.dest],o)}else i=function(e,t,r,n){var o=b(t,n),i=function(e){var t=e.width/512;return[3*t,4*t]}(n),a=(n.width+n.height)/32;return h(v("circle"),{stroke:e.color,"stroke-width":i[r?0:1],fill:"none",opacity:g(e,r),cx:o[0],cy:o[1],r:a-i[1]/2})}(r[a.brush],u,s,o)}return i.setAttribute("cgHash",c),i}(t,e,r,n,a))})}(e,a,r.brushes,i,t,c)}}},{"./util":18}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.files=["a","b","c","d","e","f","g","h"],r.ranks=[1,2,3,4,5,6,7,8]},{}],18:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0});var o=e("./types");r.colors=["white","black"],r.invRanks=[8,7,6,5,4,3,2,1],r.allKeys=(n=Array.prototype).concat.apply(n,o.files.map(function(t){return o.ranks.map(function(e){return t+e})})),r.pos2key=function(e){return r.allKeys[8*e[0]+e[1]-9]},r.key2pos=function(e){return[e.charCodeAt(0)-96,e.charCodeAt(1)-48]},r.memo=function(e){function t(){return void 0===r&&(r=e()),r}var r;return t.clear=function(){r=void 0},t},r.timer=function(){var t;return{start:function(){t=Date.now()},cancel:function(){t=void 0},stop:function(){if(!t)return 0;var e=Date.now()-t;return t=void 0,e}}},r.opposite=function(e){return"white"===e?"black":"white"},r.containsX=function(e,t){return void 0!==e&&-1!==e.indexOf(t)},r.distanceSq=function(e,t){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)},r.samePiece=function(e,t){return e.role===t.role&&e.color===t.color};function i(e,t,r,n){return[(t?e[0]-1:8-e[0])*r,(t?8-e[1]:e[1]-1)*n]}r.posToTranslateAbs=function(e){var r=e.width/8,n=e.height/8;return function(e,t){return i(e,t,r,n)}},r.posToTranslateRel=function(e,t){return i(e,t,12.5,12.5)},r.translateAbs=function(e,t){e.style.transform="translate("+t[0]+"px,"+t[1]+"px)"},r.translateRel=function(e,t){e.style.left=t[0]+"%",e.style.top=t[1]+"%"},r.setVisible=function(e,t){e.style.visibility=t?"visible":"hidden"},r.eventPosition=function(e){return e.clientX||0===e.clientX?[e.clientX,e.clientY]:e.touches&&e.targetTouches[0]?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0},r.isRightButton=function(e){return 2===e.buttons||2===e.button},r.createEl=function(e,t){var r=document.createElement(e);return t&&(r.className=t),r}},{"./types":17}],19:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var u=e("./util"),l=e("./types"),d=e("./svg");function f(e,t){var r,n=u.createEl("coords",t);for(var o in e)(r=u.createEl("coord")).textContent=e[o],n.appendChild(r);return n}r.default=function(t,r,e){t.innerHTML="",t.classList.add("cg-wrap"),u.colors.forEach(function(e){t.classList.toggle("orientation-"+e,r.orientation===e)}),t.classList.toggle("manipulable",!r.viewOnly);var n=u.createEl("cg-helper");t.appendChild(n);var o=u.createEl("cg-container");n.appendChild(o);var i,a,s=u.createEl("cg-board");if(o.appendChild(s),r.drawable.visible&&!e&&((i=d.createElement("svg")).appendChild(d.createElement("defs")),o.appendChild(i)),r.coordinates){var c="black"===r.orientation?" black":"";o.appendChild(f(l.ranks,"ranks"+c)),o.appendChild(f(l.files,"files"+c))}return r.draggable.showGhost&&!e&&(a=u.createEl("piece","ghost"),u.setVisible(a,!1),o.appendChild(a)),{board:s,container:o,ghost:a,svg:i}}},{"./svg":16,"./types":17,"./util":18}]},{},[12])(12)});