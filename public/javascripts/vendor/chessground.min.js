!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r;r="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,r.Chessground=e()}}(function(){return function e(r,t,n){function o(a,s){if(!t[a]){if(!r[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=t[a]={exports:{}};r[a][0].call(l.exports,function(e){var t=r[a][1][e];return o(t?t:e)},l,l.exports,e,r,t,n)}return t[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,r,t){"use strict";function n(e,r){return r.animation.enabled?u(e,r):o(e,r)}function o(e,r){var t=e(r);return r.dom.redraw(),t}function i(e,r,t){var n=t?p.invertKey(e):e;return{key:n,pos:p.key2pos(n),piece:r}}function a(e,r){return r.sort(function(r,t){return p.distance(e.pos,r.pos)-p.distance(e.pos,t.pos)})[0]}function s(e,r){var t,n,o,s,c,u,l,d=r.dom.bounds(),f=d.width/8,v=d.height/8,h={},g=[],m={},b=[],w=[],y=e.orientation!==r.orientation,k={},P="white"===r.orientation;for(o in e.pieces)k[o]=i(o,e.pieces[o],y);for(o in p.allKeys)s=p.allKeys[o],t=r.pieces[s],n=k[s],t?n?p.samePiece(t,n.piece)||(b.push(n),w.push(i(s,t,!1))):w.push(i(s,t,!1)):n&&b.push(n);return w.forEach(function(e){n=a(e,b.filter(function(r){return p.samePiece(e.piece,r.piece)})),n&&(c=P?n.pos:e.pos,u=P?e.pos:n.pos,l=[(c[0]-u[0])*f,(u[1]-c[1])*v],h[e.key]=[l,l],g.push(n.key))}),b.forEach(function(e){p.containsX(g,e.key)||r.items&&r.items(e.pos,e.key)||(m[e.key]=e.piece)}),{anims:h,fadings:m}}function c(e){var r=e.animation.current;if(!r)return void e.dom.redraw();var t=1-((new Date).getTime()-r.start)/r.duration;if(t<=0)e.animation.current=void 0,e.dom.redraw();else{var n=d(t);for(var o in r.plan.anims){var i=r.plan.anims[o];i[1]=[f(i[0][0]*n,10),f(i[0][1]*n,10)]}e.dom.redraw(!1),p.raf(function(){return c(e)})}}function u(e,r){var t={orientation:r.orientation,pieces:{}};for(var n in r.pieces)t.pieces[n]={role:r.pieces[n].role,color:r.pieces[n].color};var o=e(r);if(r.animation.enabled){var i=s(t,r);if(l(i.anims)&&l(i.fadings))r.dom.redraw();else{var a=r.animation.current&&r.animation.current.start;r.animation.current={start:(new Date).getTime(),duration:r.animation.duration,plan:i},a||c(r)}}else r.dom.redraw();return o}function l(e){for(var r in e)return!1;return!0}function d(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}function f(e,r){return Math.round(e*r)/r}Object.defineProperty(t,"__esModule",{value:!0});var p=e("./util");t.anim=n,t.render=o},{"./util":17}],2:[function(e,r,t){"use strict";function n(e,r){function t(){o.toggleOrientation(e),r()}return{set:function(r){r.orientation&&r.orientation!==e.orientation&&t(),c.anim(function(e){return s.configure(e,r)},e)},state:e,getFen:function(){return a.write(e.pieces)},getMaterialDiff:function(){return o.getMaterialDiff(e)},toggleOrientation:t,setPieces:function(r){c.anim(function(e){return o.setPieces(e,r)},e)},selectSquare:function(r){(r||e.selected)&&c.render(function(e){return o.selectSquare(e,r)},e)},move:function(r,t){c.anim(function(e){return o.baseMove(e,r,t)},e)},newPiece:function(r,t){c.anim(function(e){return o.baseNewPiece(e,r,t)},e)},playPremove:function(){e.premovable.current&&!c.anim(o.playPremove,e)&&i.raf(e.dom.redraw)},playPredrop:function(r){c.anim(function(e){return o.playPredrop(e,r)},e)},cancelPremove:function(){c.render(o.unsetPremove,e)},cancelPredrop:function(){c.render(o.unsetPredrop,e)},cancelMove:function(){c.render(function(e){o.cancelMove(e),u.cancel(e)},e)},stop:function(){c.render(function(e){o.stop(e),u.cancel(e)},e)},explode:function(r){l.default(e,r)},setAutoShapes:function(r){c.anim(function(e){return e.drawable.autoShapes=r},e)},setShapes:function(r){c.anim(function(e){return e.drawable.shapes=r},e)},getKeyAtDomPos:function(r){return o.getKeyAtDomPos(r,"white"===e.orientation,e.dom.bounds())},redrawAll:r,destroy:function(){e.dom.unbind&&e.dom.unbind()}}}Object.defineProperty(t,"__esModule",{value:!0});var o=e("./board"),i=e("./util"),a=e("./fen"),s=e("./config"),c=e("./anim"),u=e("./drag"),l=e("./explosion");t.start=n},{"./anim":1,"./board":3,"./config":5,"./drag":6,"./explosion":9,"./fen":10,"./util":17}],3:[function(e,r,t){"use strict";function n(e){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];e&&setTimeout(function(){return e.apply(void 0,r)},1)}function o(e){e.orientation=S.opposite(e.orientation),e.animation.current=void 0,e.draggable.current=void 0,e.selected=void 0}function i(e){e.lastMove=void 0,y(e),u(e),d(e)}function a(e,r){for(var t in r)r[t]?e.pieces[t]=r[t]:delete e.pieces[t]}function s(e,r){if(r===!0&&(r=e.turnColor),r)for(var t in e.pieces)"king"===e.pieces[t].role&&e.pieces[t].color===r&&(e.check=t);else e.check=void 0}function c(e,r,t,o){d(e),e.premovable.current=[r,t],n(e.premovable.events.set,r,t,o)}function u(e){e.premovable.current&&(e.premovable.current=void 0,n(e.premovable.events.unset))}function l(e,r,t){u(e),e.predroppable.current={role:r,key:t},n(e.predroppable.events.set,r,t)}function d(e){var r=e.predroppable;r.current&&(r.current=void 0,n(r.events.unset))}function f(e,r,t){if(e.autoCastle){var n=e.pieces[t];if("king"===n.role){var o=S.key2pos(r);if(5===o[0]&&(1===o[1]||8===o[1])){var i,a,s,c=S.key2pos(t);if(7===c[0]||8===c[0])i=S.pos2key([8,o[1]]),a=S.pos2key([6,o[1]]),s=S.pos2key([7,o[1]]);else{if(3!==c[0]&&1!==c[0])return;i=S.pos2key([1,o[1]]),a=S.pos2key([4,o[1]]),s=S.pos2key([3,o[1]])}delete e.pieces[r],delete e.pieces[t],delete e.pieces[i],e.pieces[s]={role:"king",color:n.color},e.pieces[a]={role:"rook",color:n.color}}}}}function p(e,r,t){if(r===t||!e.pieces[r])return!1;var o=e.pieces[t]&&e.pieces[t].color!==e.pieces[r].color?e.pieces[t]:void 0;return t==e.selected&&y(e),n(e.events.move,r,t,o),e.pieces[t]=e.pieces[r],delete e.pieces[r],e.lastMove=[r,t],e.check=void 0,f(e,r,t),n(e.events.change),!0}function v(e,r,t,o){if(e.pieces[t]){if(!o)return!1;delete e.pieces[t]}return n(e.events.dropNewPiece,r,t),e.pieces[t]=r,e.lastMove=[t,t],e.check=void 0,n(e.events.change),e.movable.dests=void 0,e.turnColor=S.opposite(e.turnColor),!0}function h(e,r,t){var n=p(e,r,t);return n&&(e.movable.dests=void 0,e.turnColor=S.opposite(e.turnColor),e.animation.current=void 0),n}function g(e,r,t){if(P(e,r,t)){if(h(e,r,t)){var o=e.hold.stop();y(e);var i={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:o};return n(e.movable.events.after,r,t,i),!0}}else T(e,r,t)?(c(e,r,t,{ctrlKey:e.stats.ctrlKey}),y(e)):k(e,t)||M(e,t)?(w(e,t),e.hold.start()):y(e);return!1}function m(e,r,t,o){if(C(e,r,t)||o){var i=e.pieces[r];delete e.pieces[r],v(e,i,t,o),n(e.movable.events.afterNewPiece,i.role,t,{predrop:!1})}else x(e,r,t)?l(e,e.pieces[r].role,t):(u(e),d(e));delete e.pieces[r],y(e)}function b(e,r,t){e.selected?e.selected!==r||e.draggable.enabled?(e.selectable.enabled||t)&&e.selected!==r?g(e,e.selected,r)&&(e.stats.dragged=!1):e.hold.start():(y(e),e.hold.cancel()):(k(e,r)||M(e,r))&&(w(e,r),e.hold.start()),r&&n(e.events.select,r)}function w(e,r){e.selected=r,M(e,r)?e.premovable.dests=L.default(e.pieces,r,e.premovable.castle):e.premovable.dests=void 0}function y(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function k(e,r){var t=e.pieces[r];return t&&("both"===e.movable.color||e.movable.color===t.color&&e.turnColor===t.color)}function P(e,r,t){return r!==t&&k(e,r)&&(e.movable.free||!!e.movable.dests&&S.containsX(e.movable.dests[r],t))}function C(e,r,t){var n=e.pieces[r];return n&&t&&(r===t||!e.pieces[t])&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}function M(e,r){var t=e.pieces[r];return t&&e.premovable.enabled&&e.movable.color===t.color&&e.turnColor!==t.color}function T(e,r,t){return r!==t&&M(e,r)&&S.containsX(L.default(e.pieces,r,e.premovable.castle),t)}function x(e,r,t){var n=e.pieces[r];return n&&t&&(!e.pieces[t]||e.pieces[t].color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==n.role||"1"!==t[1]&&"8"!==t[1])&&e.movable.color===n.color&&e.turnColor!==n.color}function O(e,r){var t=e.pieces[r];return t&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===t.color&&(e.turnColor===t.color||e.premovable.enabled))}function E(e){var r=e.premovable.current;if(!r)return!1;var t=r[0],o=r[1],i=!1;if(P(e,t,o)&&h(e,t,o)){var a={premove:!0};n(e.movable.events.after,t,o,a),i=!0}return u(e),i}function K(e,r){var t=e.predroppable.current,o=!1;if(!t)return!1;if(r(t)){var i={role:t.role,color:e.movable.color};v(e,i,t.key)&&(n(e.movable.events.afterNewPiece,t.role,t.key,{predrop:!0}),o=!0)}return d(e),o}function D(e){u(e),d(e),y(e)}function _(e){e.movable.color=void 0,e.movable.dests=void 0,D(e)}function A(e,r,t){var n=Math.ceil(8*((e[0]-t.left)/t.width));r||(n=9-n);var o=Math.ceil(8-8*((e[1]-t.top)/t.height));return r||(o=9-o),n>0&&n<9&&o>0&&o<9?S.pos2key([n,o]):void 0}function j(e){var r,t,n,o={king:0,queen:0,rook:0,bishop:0,knight:0,pawn:0};for(var i in e.pieces)r=e.pieces[i],o[r.role]+="white"===r.color?1:-1;var a={white:{},black:{}};for(t in o)n=o[t],n>0?a.white[t]=n:n<0&&(a.black[t]=-n);return a}function N(e){var r=0;for(var t in e.pieces)r+=q[e.pieces[t].role]*("white"===e.pieces[t].color?1:-1);return r}Object.defineProperty(t,"__esModule",{value:!0});var S=e("./util"),L=e("./premove");t.toggleOrientation=o,t.reset=i,t.setPieces=a,t.setCheck=s,t.unsetPremove=u,t.unsetPredrop=d,t.baseMove=p,t.baseNewPiece=v,t.userMove=g,t.dropNewPiece=m,t.selectSquare=b,t.setSelected=w,t.unselect=y,t.isDraggable=O,t.playPremove=E,t.playPredrop=K,t.cancelMove=D,t.stop=_,t.getKeyAtDomPos=A,t.getMaterialDiff=j;var q={pawn:1,knight:3,bishop:3,rook:5,queen:9,king:0};t.getScore=N},{"./premove":12,"./util":17}],4:[function(e,r,t){"use strict";function n(e,r){function t(){var r=n.dom&&n.dom.unbind;e.classList.add("cg-board-wrap");var o=d.memo(function(){return(n.dom?n.dom.elements.board:e).getBoundingClientRect()}),i=s.default(e,n,o());n.dom={elements:i,bounds:o,redraw:function(e){void 0===e&&(e=!0),u.default(n),e&&i.svg&&l.renderSvg(n,i.svg)},unbind:r},l.clearCache(),n.dom.redraw(),c.bindBoard(n),r||(n.dom.unbind=c.bindDocument(n,t))}var n=a.defaults();i.configure(n,r||{}),n.browser={transform:d.transformFunction()},t();var f=o.start(n,t);return f}Object.defineProperty(t,"__esModule",{value:!0});var o=e("./api"),i=e("./config"),a=e("./state"),s=e("./wrap"),c=e("./events"),u=e("./render"),l=e("./svg"),d=e("./util");t.Chessground=n},{"./api":2,"./config":5,"./events":8,"./render":13,"./state":14,"./svg":15,"./util":17,"./wrap":18}],5:[function(e,r,t){"use strict";function n(e,r){r.movable&&r.movable.dests&&(e.movable.dests=void 0);var t=r.check;if(delete r.check,o(e,r),r.fen&&(e.pieces=s.read(r.fen),e.drawable.shapes=[]),void 0!==t&&a.setCheck(e,t),e.selected&&a.setSelected(e,e.selected),(!e.animation.duration||e.animation.duration<40)&&(e.animation.enabled=!1),!e.movable.rookCastle&&e.movable.dests){var n="white"===e.movable.color?1:8,i="e"+n,c=e.movable.dests[i];if(!c||"king"!==e.pieces[i].role)return;e.movable.dests[i]=c.filter(function(e){return(e!=="a"+n||c.indexOf("c"+n)===-1)&&(e!=="h"+n||c.indexOf("g"+n)===-1)})}}function o(e,r){for(var t in r)i(e[t])&&i(r[t])?o(e[t],r[t]):e[t]=r[t]}function i(e){return"object"==typeof e}Object.defineProperty(t,"__esModule",{value:!0});var a=e("./board"),s=e("./fen");t.configure=n},{"./board":3,"./fen":10}],6:[function(e,r,t){"use strict";function n(e,r){if(!(void 0!==r.button&&0!==r.button||r.touches&&r.touches.length>1)){r.preventDefault();var t="white"===e.orientation,n=e.dom.bounds(),o=p.eventPosition(r),a=f.getKeyAtDomPos(o,t,n);if(a){var s=e.pieces[a],c=e.selected;if(c||!e.drawable.eraseOnClick&&s&&s.color===e.turnColor||v.clear(e),!e.viewOnly){var u=!!e.premovable.current,h=!!e.predroppable.current;e.stats.ctrlKey=r.ctrlKey,f.selectSquare(e,a);var g=e.selected===a,m=d(e,a);if(s&&m&&g&&f.isDraggable(e,a)){var b=l(a,t,n);e.draggable.current={orig:a,origPos:p.key2pos(a),piece:s,rel:o,epos:o,pos:[0,0],dec:e.draggable.centerPiece?[o[0]-(b.left+b.width/2),o[1]-(b.top+b.height/2)]:[0,0],started:e.draggable.autoDistance&&e.stats.dragged,element:m,previouslySelected:c,originTarget:r.target},m.cgDragging=!0,m.classList.add("dragging");var w=e.dom.elements.ghost;if(w){w.className="ghost "+s.color+" "+s.role;var y=p.posToTranslate(p.key2pos(a),t,n);e.browser.transform(w,p.translate(y))}}else u&&f.unsetPremove(e),h&&f.unsetPredrop(e);p.raf(e.dom.redraw),i(e)}}}}function o(e,r,t){var n="a0";e.pieces[n]=r,p.raf(e.dom.redraw);var o=p.eventPosition(t),a="white"===e.orientation,s=e.dom.bounds(),c=l(n,a,s),u=p.key2pos(a?n:p.invertKey(n)),f=[(u[0]-1)*c.width+s.left,(8-u[1])*c.height+s.top];e.draggable.current={orig:n,origPos:p.key2pos(n),piece:r,rel:f,epos:o,pos:[o[0]-f[0],o[1]-f[1]],dec:[-c.width/2,-c.height/2],started:!0,element:function(){return d(e,n)},originTarget:t.target,newPiece:!0},i(e)}function i(e){p.raf(function(){var r=e.draggable.current;if(r){e.animation.current&&e.animation.current.plan.anims[r.orig]&&(e.animation.current=void 0);var t=e.pieces[r.orig];if(t&&p.samePiece(t,r.piece)){if(!r.started&&p.distance(r.epos,r.rel)>=e.draggable.distance&&(r.started=!0),r.started){if("function"==typeof r.element){var n=r.element();if(!n)return;r.element=n,r.element.cgDragging=!0,r.element.classList.add("dragging")}var o="white"===e.orientation,a=e.dom.bounds();r.pos=[r.epos[0]-r.rel[0],r.epos[1]-r.rel[1]],r.over=f.getKeyAtDomPos(r.epos,o,a);var s=p.posToTranslate(r.origPos,o,a);s[0]+=r.pos[0]+r.dec[0],s[1]+=r.pos[1]+r.dec[1],e.browser.transform(r.element,p.translate(s));var u=e.dom.elements.over;if(u&&r.over&&r.over!==r.overPrev){var l=e.movable.dests;if(e.movable.free||p.containsX(l&&l[r.orig],r.over)||p.containsX(e.premovable.dests,r.over)){var d=a.width/8,v=p.key2pos(r.over),h=[(o?v[0]-1:8-v[0])*d,(o?8-v[1]:v[1]-1)*d];e.browser.transform(u,p.translate(h))}else e.browser.transform(u,p.translateAway);r.overPrev=r.over}}}else c(e);i(e)}})}function a(e,r){e.draggable.current&&(!r.touches||r.touches.length<2)&&(e.draggable.current.epos=p.eventPosition(r))}function s(e,r){var t=e.draggable.current;if(t){if("touchend"===r.type&&t&&t.originTarget!==r.target&&!t.newPiece)return void(e.draggable.current=void 0);f.unsetPremove(e),f.unsetPredrop(e);var n=p.eventPosition(r),o=f.getKeyAtDomPos(n,"white"===e.orientation,e.dom.bounds());o&&t.started?t.newPiece?f.dropNewPiece(e,t.orig,o):(e.stats.ctrlKey=r.ctrlKey,f.userMove(e,t.orig,o)&&(e.stats.dragged=!0)):t.newPiece&&delete e.pieces[t.orig],!t||t.orig!==t.previouslySelected||t.orig!==o&&o?e.selectable.enabled||f.unselect(e):f.unselect(e),u(e),e.draggable.current=void 0,p.raf(e.dom.redraw)}}function c(e){e.draggable.current&&(e.draggable.current=void 0,f.unselect(e),u(e))}function u(e){var r=e.dom.elements;r.over&&e.browser.transform(r.over,p.translateAway),r.ghost&&e.browser.transform(r.ghost,p.translateAway)}function l(e,r,t){var n=p.key2pos(e);return r||(n[0]=9-n[0],n[1]=9-n[1]),{left:t.left+t.width*(n[0]-1)/8,top:t.top+t.height*(8-n[1])/8,width:t.width/8,height:t.height/8}}function d(e,r){for(var t=e.dom.elements.board.firstChild;t;){if(t.cgKey===r&&"PIECE"===t.tagName)return t;t=t.nextSibling}}Object.defineProperty(t,"__esModule",{value:!0});var f=e("./board"),p=e("./util"),v=e("./draw");t.start=n,t.dragNewPiece=o,t.move=a,t.end=s,t.cancel=c},{"./board":3,"./draw":7,"./util":17}],7:[function(e,r,t){"use strict";function n(e,r){if(!(r.touches&&r.touches.length>1)){r.stopPropagation(),r.preventDefault(),v.cancelMove(e);var t=h.eventPosition(r),n=v.getKeyAtDomPos(t,"white"===e.orientation,e.dom.bounds());n&&(e.drawable.current={orig:n,dest:n,pos:t,brush:u(r)},o(e))}}function o(e){h.raf(function(){var r=e.drawable.current;if(r){var t=v.getKeyAtDomPos(r.pos,"white"===e.orientation,e.dom.bounds()),n=r.orig===t?void 0:t;n!==r.dest&&(r.dest=n,e.dom.redraw())}r&&o(e)})}function i(e,r){e.drawable.current&&(e.drawable.current.pos=h.eventPosition(r))}function a(e){var r=e.drawable.current;r&&(r.dest?f(e.drawable,r,r.dest):d(e.drawable,r),e.drawable.current=void 0,e.dom.redraw())}function s(e){e.drawable.current&&(e.drawable.current=void 0)}function c(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),p(e.drawable))}function u(e){var r=e.shiftKey&&h.isRightButton(e)?1:0,t=e.altKey?2:0;return g[r+t]}function l(e){return function(r){return!e(r)}}function d(e,r){var t=r.orig,n=function(e){return e.orig===t&&!e.dest},o=e.shapes.filter(n)[0];o&&(e.shapes=e.shapes.filter(l(n))),o&&o.brush===r.brush||e.shapes.push({brush:r.brush,orig:t}),p(e)}function f(e,r,t){var n=r.orig,o=function(e){return!!e.dest&&(e.orig===n&&e.dest===t||e.dest===n&&e.orig===t)},i=e.shapes.filter(o).length>0;i?e.shapes=e.shapes.filter(l(o)):e.shapes.push({brush:r.brush,orig:n,dest:t}),p(e)}function p(e){e.onChange&&e.onChange(e.shapes)}Object.defineProperty(t,"__esModule",{value:!0});var v=e("./board"),h=e("./util"),g=["green","red","blue","yellow"];t.start=n,t.processDraw=o,t.move=i,t.end=a,t.cancel=s,t.clear=c},{"./board":3,"./util":17}],8:[function(e,r,t){"use strict";function n(e){var r=e.dom.elements.board;e.viewOnly||["touchstart","mousedown"].forEach(function(t){return r.addEventListener(t,a(e))}),(e.disableContextMenu||e.drawable.enabled)&&r.addEventListener("contextmenu",function(e){return e.preventDefault(),!1})}function o(e,r){var t=s(e,c.move,u.move),n=s(e,c.end,u.end),o=[];e.viewOnly||(["touchmove","mousemove"].forEach(function(e){return o.push(i(document,e,t))}),["touchend","mouseup"].forEach(function(e){return o.push(i(document,e,n))}));var a=function(){e.dom.bounds.clear(),l.raf(r)};e.resizable&&o.push(i(document.body,"chessground.resize",a));var d=function(){return e.dom.bounds.clear()};return o.push(i(window,"scroll",d,{passive:!0})),o.push(i(window,"resize",d,{passive:!0})),function(){return o.forEach(function(e){return e()})}}function i(e,r,t,n){return e.addEventListener(r,t,n),function(){return e.removeEventListener(r,t)}}function a(e){return function(r){l.isRightButton(r)&&e.draggable.current?(e.draggable.current.newPiece&&delete e.pieces[e.draggable.current.orig],e.draggable.current=void 0,e.selected=void 0):(r.shiftKey||l.isRightButton(r))&&e.drawable.enabled?u.start(e,r):c.start(e,r)}}function s(e,r,t){return function(n){(n.shiftKey||l.isRightButton(n))&&e.drawable.enabled?t(e,n):e.viewOnly||r(e,n)}}Object.defineProperty(t,"__esModule",{value:!0});var c=e("./drag"),u=e("./draw"),l=e("./util");t.bindBoard=n,t.bindDocument=o},{"./drag":6,"./draw":7,"./util":17}],9:[function(e,r,t){"use strict";function n(e,r){e.exploding={stage:1,keys:r},e.dom.redraw(),setTimeout(function(){o(e,2),setTimeout(function(){return o(e,void 0)},120)},120)}function o(e,r){e.exploding&&(r?e.exploding.stage=r:e.exploding=void 0,e.dom.redraw())}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},{}],10:[function(e,r,t){"use strict";function n(e){"start"===e&&(e=t.initial);var r,n,o,a={};return e.replace(u,"").replace(l,"").split("/").forEach(function(e,t){t>7||(r=0,e.split("").forEach(function(e){n=parseInt(e),n?r+=n:(++r,o=e.toLowerCase(),a[i.pos2key([r,8-t])]={role:s[o],color:e===o?"black":"white"})}))}),a}function o(e){var r,t;return[8,7,6,5,4,3,2].reduce(function(e,r){return e.replace(new RegExp(Array(r+1).join("1"),"g"),r)},i.invRanks.map(function(n){return a.ranks.map(function(o){return r=e[i.pos2key([o,n])],r?(t=c[r.role],"white"===r.color?t.toUpperCase():t):"1"}).join("")}).join("/"))}Object.defineProperty(t,"__esModule",{value:!0});var i=e("./util"),a=e("./types");t.initial="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR";var s={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},c={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"},u=/ .+$/,l=/~/g;t.read=n,t.write=o},{"./types":16,"./util":17}],11:[function(e,r,t){r.exports=e("./chessground").Chessground},{"./chessground":4}],12:[function(e,r,t){"use strict";function n(e,r){return Math.abs(e-r)}function o(e){return function(r,t,o,i){return n(r,o)<2&&("white"===e?i===t+1||t<=2&&i===t+2&&r===o:i===t-1||t>=7&&i===t-2&&r===o)}}function i(e,r,t){return function(o,i,a,s){return n(o,a)<2&&n(i,s)<2||t&&i===s&&i===("white"===e?1:8)&&(5===o&&(3===a||7===a)||c.containsX(r,a))}}function a(e,r){var t;return Object.keys(e).filter(function(n){return t=e[n],t&&t.color===r&&"rook"===t.role}).map(function(e){return c.key2pos(e)[0]})}function s(e,r,t){var n,s=e[r],p=c.key2pos(r);switch(s.role){case"pawn":n=o(s.color);break;case"knight":n=u;break;case"bishop":n=l;break;case"rook":n=d;break;case"queen":n=f;break;case"king":n=i(s.color,a(e,s.color),t)}return c.allPos.filter(function(e){return(p[0]!==e[0]||p[1]!==e[1])&&n(p[0],p[1],e[0],e[1])}).map(c.pos2key)}Object.defineProperty(t,"__esModule",{value:!0});var c=e("./util"),u=function(e,r,t,o){var i=n(e,t),a=n(r,o);return 1===i&&2===a||2===i&&1===a},l=function(e,r,t,o){return n(e,t)===n(r,o)},d=function(e,r,t,n){return e===t||r===n},f=function(e,r,t,n){return l(e,r,t,n)||d(e,r,t,n)};t.default=s},{"./util":17}],13:[function(e,r,t){"use strict";function n(e){var r,t,n,f,v,h,g,m,b,w,y,k,P,C="white"===e.orientation,M=e.dom.bounds(),T=e.dom.elements.board,x=e.pieces,O=e.animation.current,E=O?O.plan.anims:{},K=O?O.plan.fadings:{},D=e.draggable.current,_=d(e),A={},j={},N={},S={},L=Object.keys(x),q=e.browser.transform;for(n=T.firstChild;n;){if(r=n.cgKey,f=_[r],v=x[r],m=E[r],b=K[r],o(n))h=n.cgPiece,!n.cgDragging||D&&D.orig===r||(n.classList.remove("dragging"),q(n,p.translate(p.posToTranslate(p.key2pos(r),C,M))),n.cgDragging=!1),!b&&n.cgFading&&(n.cgFading=!1,n.classList.remove("fading")),v?(m&&n.cgAnimating&&h===l(v)?(g=p.posToTranslate(p.key2pos(r),C,M),g[0]+=m[1][0],g[1]+=m[1][1],q(n,p.translate(g)),n.classList.add("anim")):n.cgAnimating&&(g=p.posToTranslate(p.key2pos(r),C,M),q(n,p.translate(g)),n.cgAnimating=!1,n.classList.remove("anim")),h===l(v)?A[r]=!0:b&&h===l(b)?(n.classList.add("fading"),n.cgFading=!0):N[h]?N[h].push(n):N[h]=[n]):N[h]?N[h].push(n):N[h]=[n];else if(i(n)){var B=n.className;f===B?j[r]=!0:S[B]?S[B].push(n):S[B]=[n]}n=n.nextSibling}for(var W in _)j[W]||(k=S[_[W]],P=k&&k.pop(),g=p.posToTranslate(p.key2pos(W),C,M),P?(P.cgKey=W,q(P,p.translate(g))):T.insertBefore(s(W,_[W],g,q),T.firstChild));for(var R in L)if(r=L[R],t=x[r],m=E[r],!A[r])if(w=N[l(t)],y=w&&w.pop()){y.cgKey=r;var I=p.key2pos(r);e.addPieceZIndex&&(y.style.zIndex=u(I,C)),g=p.posToTranslate(I,C,M),m&&(y.cgAnimating=!0,y.classList.add("anim"),g[0]+=m[1][0],g[1]+=m[1][1]),q(y,p.translate(g))}else T.appendChild(c(e,t,r,C,m,M));for(var X in N)a(e,N[X]);for(var X in S)a(e,S[X])}function o(e){return"PIECE"===e.tagName}function i(e){return"SQUARE"===e.tagName}function a(e,r){for(var t in r)e.dom.elements.board.removeChild(r[t])}function s(e,r,t,n){var o=p.createEl("square",r);return o.cgKey=e,n(o,p.translate(t)),o}function c(e,r,t,n,o,i){var a=l(r),s=p.createEl("piece",a),c=p.key2pos(t);s.cgPiece=a,s.cgKey=t;var d=p.posToTranslate(c,n,i);return o&&(s.cgAnimating=!0,d[0]+=o[1][0],d[1]+=o[1][1]),e.browser.transform(s,p.translate(d)),e.addPieceZIndex&&(s.style.zIndex=u(c,n)),s}function u(e,r){var t=2+8*(e[1]-1)+(8-e[0]);return r&&(t=67-t),t+""}function l(e){return e.color+" "+e.role}function d(e){var r,t,n={};if(e.lastMove&&e.highlight.lastMove)for(r in e.lastMove)f(n,e.lastMove[r],"last-move");if(e.check&&e.highlight.check&&f(n,e.check,"check"),e.selected&&(f(n,e.selected,"selected"),e.movable.showDests)){var o=e.movable.dests&&e.movable.dests[e.selected];if(o)for(r in o)t=o[r],f(n,t,"move-dest"+(e.pieces[t]?" oc":""));var i=e.premovable.dests;if(i)for(r in i)t=i[r],f(n,t,"premove-dest"+(e.pieces[t]?" oc":""))}var a=e.premovable.current;if(a)for(r in a)f(n,a[r],"current-premove");else e.predroppable.current&&f(n,e.predroppable.current.key,"current-premove");var s=e.exploding;if(s)for(r in s.keys)f(n,s.keys[r],"exploding"+s.stage);return n}function f(e,r,t){e[r]?e[r]+=" "+t:e[r]=t}Object.defineProperty(t,"__esModule",{value:!0});var p=e("./util");t.default=n},{"./util":17}],14:[function(e,r,t){"use strict";function n(){return{pieces:o.read(o.initial),orientation:"white",turnColor:"white",coordinates:!0,autoCastle:!0,viewOnly:!1,disableContextMenu:!1,resizable:!0,addPieceZIndex:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",dropOff:"revert",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,centerPiece:!0,showGhost:!0},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"https://lichess1.org/assets/piece/cburnett/"}},hold:i.timer()}}Object.defineProperty(t,"__esModule",{value:!0});var o=e("./fen"),i=e("./util");t.defaults=n},{"./fen":10,"./util":17}],15:[function(e,r,t){"use strict";function n(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function o(){x=""}function i(e,r){var t=e.drawable,n=r.firstChild,o=t.shapes.concat(t.autoShapes).map(function(e){return{shape:e,current:!1,hash:c(e,!1)}});t.current&&o.push({shape:t.current,current:!0,hash:c(t.current,!0)});var i=o.map(function(e){return e.hash}).join("");i!==x&&(x=i,a(t,o,n),s(e,o,t.brushes,r,n))}function a(e,r,t){var n,o={};r.forEach(function(r){r.shape.dest&&(n=e.brushes[r.shape.brush],r.shape.modifiers&&(n=b(n,r.shape.modifiers)),o[n.key]=n)});for(var i={},a=t.firstChild;a;)i[a.getAttribute("cgKey")]=!0,a=a.nextSibling;for(var s in o)i[s]||t.appendChild(h(o[s]))}function s(e,r,t,n,o){void 0===T&&(T=M.computeIsTrident());var i=e.dom.bounds(),a={},s=[];if(r.forEach(function(e){a[e.hash]=!1}),i.width===i.height){for(var c,u=o.nextSibling;u;)c=u.getAttribute("cgHash"),a.hasOwnProperty(c)?a[c]=!0:s.push(u),u=u.nextSibling;s.forEach(function(e){return n.removeChild(e)}),r.forEach(function(r){a[r.hash]||n.appendChild(d(e,r,t,i))})}}function c(e,r){var t=e.orig,n=e.dest,o=e.brush,i=e.piece,a=e.modifiers;return[r,t,n,o,i&&u(i),a&&l(a)].filter(function(e){return e}).join("")}function u(e){return[e.color,e.role,e.scale].filter(function(e){return e}).join("")}function l(e){return""+(e.lineWidth||"")}function d(e,r,t,n){var o,i=r.shape,a=r.current,s=r.hash;if(i.piece)o=v(e.drawable.pieces.baseUrl,m(M.key2pos(i.orig),e.orientation),i.piece,n);else{var c=m(M.key2pos(i.orig),e.orientation);if(i.orig&&i.dest){var u=t[i.brush];i.modifiers&&(u=b(u,i.modifiers)),o=p(u,c,m(M.key2pos(i.dest),e.orientation),a,n)}else o=f(t[i.brush],c,a,n)}return o.setAttribute("cgHash",s),o}function f(e,r,t,o){var i=C(r,o),a=w(t,o),s=o.width/16;return g(n("circle"),{stroke:e.color,"stroke-width":a,fill:"none",opacity:k(e,t),cx:i[0],cy:i[1],r:s-a/2})}function p(e,r,t,o,i){var a=P(i,o),s=C(r,i),c=C(t,i),u=c[0]-s[0],l=c[1]-s[1],d=Math.atan2(l,u),f=Math.cos(d)*a,p=Math.sin(d)*a;return g(n("line"),{stroke:e.color,"stroke-width":y(e,o,i),"stroke-linecap":"round","marker-end":T?void 0:"url(#arrowhead-"+e.key+")",opacity:k(e,o),x1:s[0],y1:s[1],x2:c[0]-f,y2:c[1]-p})}function v(e,r,t,o){var i=C(r,o),a=o.width/8*(t.scale||1),s=t.color[0]+("knight"===t.role?"n":t.role[0]).toUpperCase();return g(n("image"),{className:t.role+" "+t.color,x:i[0]-a/2,y:i[1]-a/2,width:a,height:a,href:e+s+".svg"})}function h(e){var r=g(n("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return r.appendChild(g(n("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),r.setAttribute("cgKey",e.key),r}function g(e,r){for(var t in r)e.setAttribute(t,r[t]);return e}function m(e,r){return"white"===r?e:[9-e[0],9-e[1]]}function b(e,r){var t={color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(r.lineWidth||e.lineWidth)};return t.key=[e.key,r.lineWidth].filter(function(e){return e}).join(""),t}function w(e,r){return(e?3:4)/512*r.width}function y(e,r,t){return(e.lineWidth||10)*(r?.85:1)/512*t.width}function k(e,r){return(e.opacity||1)*(r?.9:1)}function P(e,r){return T?0:(r?10:20)/512*e.width}function C(e,r){var t=r.width/8;return[(e[0]-.5)*t,(8.5-e[1])*t]}Object.defineProperty(t,"__esModule",{value:!0});var M=e("./util");t.createElement=n;var T,x="";t.clearCache=o,t.renderSvg=i},{"./util":17}],16:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.files=["a","b","c","d","e","f","g","h"],t.ranks=[1,2,3,4,5,6,7,8]},{}],17:[function(e,r,t){"use strict";function n(e){var r,t=function(){return void 0===r&&(r=e()),r};return t.clear=function(){r=void 0},t}function o(e,r){return!!e&&e.indexOf(r)!==-1}Object.defineProperty(t,"__esModule",{value:!0});var i=e("./types");t.colors=["white","black"],t.invRanks=[8,7,6,5,4,3,2,1],t.fileNumbers={a:1,b:2,c:3,d:4,e:5,f:6,g:7,h:8},t.pos2key=function(e){return i.files[e[0]-1]+e[1]},t.key2pos=function(e){return[t.fileNumbers[e[0]],parseInt(e[1])]},t.invertKey=function(e){return i.files[8-t.fileNumbers[e[0]]]+(9-parseInt(e[1]))},t.allPos=[],t.allKeys=[];var a,s,c,u;for(u=8;u>0;--u)for(c=1;c<9;++c)a=[c,u],s=t.pos2key(a),t.allPos.push(a),t.allKeys.push(s);t.memo=n,t.timer=function(){var e;return{start:function(){e=new Date},cancel:function(){e=void 0},stop:function(){if(!e)return 0;var r=(new Date).getTime()-e.getTime();return e=void 0,r}}},t.opposite=function(e){return"white"===e?"black":"white"},t.containsX=o,t.distance=function(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))},t.samePiece=function(e,r){return e.role===r.role&&e.color===r.color},t.transformFunction=function(){var e=document.body.style,r="transform"in e?"transform":"webkitTransform"in e?"webkitTransform":"mozTransform"in e?"mozTransform":"oTransform"in e?"oTransform":"msTransform";return function(e,t){return e.style.setProperty(r,t)}},t.computeIsTrident=function(){return window.navigator.userAgent.indexOf("Trident/")>-1},t.posToTranslate=function(e,r,t){return[(r?e[0]-1:8-e[0])*t.width/8,(r?8-e[1]:e[1]-1)*t.height/8]},t.translate=function(e){return"translate("+e[0]+"px,"+e[1]+"px)"},t.translateAway=t.translate([-99999,-99999]),t.eventPosition=function(e){if(e.clientX||0===e.clientX)return[e.clientX,e.clientY];if(e.touches&&e.targetTouches[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY];throw"Cannot find position of event "+e},t.isLeftButton=function(e){return 1===e.buttons||1===e.button},t.isRightButton=function(e){return 2===e.buttons||2===e.button},t.createEl=function(e,r){var t=document.createElement(e);return r&&(t.className=r),t},t.raf=(window.requestAnimationFrame||window.setTimeout).bind(window)},{"./types":16}],18:[function(e,r,t){"use strict";function n(e,r,t){e.innerHTML="",e.classList.add("cg-board-wrap"),a.colors.forEach(function(t){e.classList.toggle("orientation-"+t,r.orientation===t)}),e.classList.toggle("manipulable",!r.viewOnly);var n=a.createEl("div","cg-board");e.appendChild(n);var u;if(r.drawable.enabled&&(u=c.createElement("svg"),u.appendChild(c.createElement("defs")),e.appendChild(u)),r.coordinates){var l="black"===r.orientation?" black":"";e.appendChild(i(s.ranks,"ranks"+l)),e.appendChild(i(s.files,"files"+l))}var d;r.viewOnly||!r.movable.showDests&&!r.premovable.showDests||(d=o(r.browser,t,"div","over"),e.appendChild(d));var f;return!r.viewOnly&&r.draggable.showGhost&&(f=o(r.browser,t,"piece","ghost"),e.appendChild(f)),{board:n,over:d,ghost:f,svg:u}}function o(e,r,t,n){var o=r.width/8,i=a.createEl(t,n);return i.style.width=o+"px",i.style.height=o+"px",e.transform(i,a.translateAway),
i}function i(e,r){var t,n=a.createEl("coords",r);for(var o in e)t=a.createEl("coord"),t.textContent=e[o],n.appendChild(t);return n}Object.defineProperty(t,"__esModule",{value:!0});var a=e("./util"),s=e("./types"),c=e("./svg");t.default=n},{"./svg":15,"./types":16,"./util":17}]},{},[11])(11)});