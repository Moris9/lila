!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Chessground=e()}}(function(){return function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return o(n?n:e)},c,c.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){function r(e,t){var n=new i(t);return o.render(e,a(n)),s(n)}var o=e("mithril"),i=e("./ctrl"),a=e("./view"),s=e("./api");t.exports=r,t.exports.controller=i,t.exports.view=a,t.exports.fen=e("./fen"),t.exports.util=e("./util"),t.exports.configure=e("./configure"),t.exports.anim=e("./anim"),t.exports.board=e("./board"),t.exports.drag=e("./drag")},{"./anim":26,"./api":27,"./board":28,"./configure":29,"./ctrl":31,"./drag":33,"./fen":35,"./util":39,"./view":40,mithril:9}],2:[function(e,t,n){!function(e){function n(e,t){if("object"!==o(e))return t;for(var r in t)e[r]="object"===o(e[r])&&"object"===o(t[r])?n(e[r],t[r]):t[r];return e}function r(e,t,r){var a=r[0],s=r.length;(e||"object"!==o(a))&&(a={});for(var l=0;s>l;++l){var u=r[l],c=o(u);if("object"===c)for(var d in u){var f=e?i.clone(u[d]):u[d];a[d]=t?n(a[d],f):f}}return a}function o(e){return{}.toString.call(e).slice(8,-1).toLowerCase()}var i=function(e){return r(e===!0,!1,arguments)},a="merge";i.recursive=function(e){return r(e===!0,!0,arguments)},i.clone=function(e){var t,n,r=e,a=o(e);if("array"===a)for(r=[],n=e.length,t=0;n>t;++t)r[t]=i.clone(e[t]);else if("object"===a){r={};for(t in e)r[t]=i.clone(e[t])}return r},e?t.exports=i:window[a]=i}("object"==typeof t&&t&&"object"==typeof t.exports&&t.exports)},{}],3:[function(e,t,n){"use strict";var r=e("../api/throttle");t.exports=function(e,t,n,o){var i=r(o);return null!=t&&t.setEventCallback(function(e){e.redraw!==!1&&n.publish()}),null!=n&&(e.redraw&&n.unsubscribe(e.redraw),n.subscribe(i)),e.redraw=i}},{"../api/throttle":7}],4:[function(e,t,n){"use strict";var r=e("../render/vnode"),o=e("../api/autoredraw");t.exports=function(e,t){return function(n,i){if(null===i)return e.render(n,[]),t.unsubscribe(n.redraw),void delete n.redraw;if(null==i.view)throw new Error("m.mount(element, component) expects a component, not a vnode");var a=o(n,e,t,function(){e.render(n,r(i,void 0,void 0,void 0,void 0,void 0))});a()}}},{"../api/autoredraw":3,"../render/vnode":20}],5:[function(e,t,n){"use strict";t.exports=function(){function e(e){var t=n.indexOf(e);t>-1&&n.splice(t,1)}function t(){for(var e=0;e<n.length;e++)n[e].apply(this,arguments)}var n=[];return{subscribe:n.push.bind(n),unsubscribe:e,publish:t}}},{}],6:[function(e,t,n){"use strict";var r=e("../render/vnode"),o=e("../router/router");t.exports=function(e,t){function n(e){return e}var i,a,s,l,u,c=o(e),d={view:function(){return[s(r(a,null,l,void 0,void 0,void 0))]}},f=function(e,r,o){a="div",s=n,l=null,t(e,d),c.defineRoutes(o,function(t,r,o){var c="function"!=typeof t.view,d=n,f=i=function(n){f===i&&(i=null,a=null!=n?n:c?"div":t,s=d,l=r,u=o,e.redraw(!0))},p=function(){f()};c&&("function"==typeof t.render&&(d=t.render.bind(t)),"function"==typeof t.onmatch&&(p=t.onmatch)),p.call(t,f,r,o)},function(){c.setPath(r,null,{replace:!0})})};return f.link=c.link,f.prefix=c.setPrefix,f.set=c.setPath,f.get=function(){return u},f}},{"../render/vnode":20,"../router/router":24}],7:[function(e,t,n){"use strict";t.exports=function(e){var t=16,n=0,r=null,o="function"==typeof requestAnimationFrame?requestAnimationFrame:setTimeout;return function(i){var a=Date.now();i===!0||0===n||a-n>=t?(n=a,e()):null===r&&(r=o(function(){r=null,e(),n=Date.now()},t-(a-n)))}}},{}],8:[function(e,t,n){var r=e("./render/hyperscript");r.trust=e("./render/trust"),r.fragment=e("./render/fragment"),t.exports=r},{"./render/fragment":16,"./render/hyperscript":17,"./render/trust":19}],9:[function(e,t,n){"use strict";var r=e("./hyperscript"),o=e("./request"),i=e("./redraw");o.setCompletionCallback(i.publish),r.Promise=e("./promise/promise"),r.mount=e("./mount"),r.route=e("./route"),r.withAttr=e("./util/withAttr"),r.render=e("./render").render,r.redraw=i.publish,r.request=o.request,r.jsonp=o.jsonp,r.parseQueryString=e("./querystring/parse"),r.buildQueryString=e("./querystring/build"),r.version="bleeding-edge",t.exports=r},{"./hyperscript":8,"./mount":10,"./promise/promise":11,"./querystring/build":12,"./querystring/parse":13,"./redraw":14,"./render":15,"./request":21,"./route":23,"./util/withAttr":25}],10:[function(e,t,n){var r=e("./render"),o=e("./redraw");t.exports=e("./api/mount")(r,o)},{"./api/mount":4,"./redraw":14,"./render":15}],11:[function(e,t,n){"use strict";var r=function(e){function t(e,t){return function r(s){var d;try{if(!t||null==s||"object"!=typeof s&&"function"!=typeof s||"function"!=typeof(d=s.then))c(function(){t||0!==e.length||console.error("Possible unhandled promise rejection:",s);for(var n=0;n<e.length;n++)e[n](s);i.length=0,a.length=0,u.state=t,u.retry=function(){r(s)}});else{if(s===o)throw new TypeError("Promise can't be resolved w/ itself");n(d.bind(s))}}catch(f){l(f)}}}function n(e){function t(e){return function(t){n++>0||e(t)}}var n=0,r=t(l);try{e(t(s),r)}catch(o){r(o)}}if(!(this instanceof r))throw new Error("Promise must be called with `new`");if("function"!=typeof e)throw new TypeError("executor must be a function");var o=this,i=[],a=[],s=t(i,!0),l=t(a,!1),u=o._instance={resolvers:i,rejectors:a},c="function"==typeof setImmediate?setImmediate:setTimeout;n(e)};r.prototype.then=function(e,t){function n(e,t,n,r){t.push(function(t){if("function"!=typeof e)n(t);else try{o(e(t))}catch(r){i&&i(r)}}),"function"==typeof s.retry&&r===s.state&&s.retry()}var o,i,a=this,s=a._instance,l=new r(function(e,t){o=e,i=t});return n(e,s.resolvers,o,!0),n(t,s.rejectors,i,!1),l},r.prototype["catch"]=function(e){return this.then(null,e)},r.resolve=function(e){return e instanceof r?e:new r(function(t){t(e)})},r.reject=function(e){return new r(function(t,n){n(e)})},r.all=function(e){return new r(function(t,n){var r=e.length,o=0,i=[];if(0===e.length)t([]);else for(var a=0;a<e.length;a++)!function(a){function s(e){o++,i[a]=e,o===r&&t(i)}null==e[a]||"object"!=typeof e[a]&&"function"!=typeof e[a]||"function"!=typeof e[a].then?s(e[a]):e[a].then(s,n)}(a)})},r.race=function(e){return new r(function(t,n){for(var r=0;r<e.length;r++)e[r].then(t,n)})},t.exports="undefined"!=typeof Promise?Promise:r},{}],12:[function(e,t,n){"use strict";t.exports=function(e){function t(e,r){if(r instanceof Array)for(var o=0;o<r.length;o++)t(e+"["+o+"]",r[o]);else if("[object Object]"===Object.prototype.toString.call(r))for(var o in r)t(e+"["+o+"]",r[o]);else n.push(encodeURIComponent(e)+(null!=r&&""!==r?"="+encodeURIComponent(r):""))}if("[object Object]"!==Object.prototype.toString.call(e))return"";var n=[];for(var r in e)t(r,e[r]);return n.join("&")}},{}],13:[function(e,t,n){"use strict";t.exports=function(e){if(""===e||null==e)return{};"?"===e.charAt(0)&&(e=e.slice(1));for(var t=e.split("&"),n={},r={},o=0;o<t.length;o++){var i=t[o].split("="),a=decodeURIComponent(i[0]),s=2===i.length?decodeURIComponent(i[1]):"";"true"===s?s=!0:"false"===s&&(s=!1);var l=a.split(/\]\[?|\[/),u=n;a.indexOf("[")>-1&&l.pop();for(var c=0;c<l.length;c++){var d=l[c],f=l[c+1],p=""==f||!isNaN(parseInt(f,10)),v=c===l.length-1;if(""===d){var a=l.slice(0,c).join();null==r[a]&&(r[a]=0),d=r[a]++}null==u[d]&&(u[d]=v?s:p?[]:{}),u=u[d]}}return n}},{}],14:[function(e,t,n){t.exports=e("./api/pubsub")()},{"./api/pubsub":5}],15:[function(e,t,n){t.exports=e("./render/render")(window)},{"./render/render":18}],16:[function(e,t,n){"use strict";var r=e("../render/vnode");t.exports=function(e,t){return r("[",e.key,e,r.normalizeChildren(t),void 0,void 0)}},{"../render/vnode":20}],17:[function(e,t,n){"use strict";function r(e){if(null==e||"string"!=typeof e&&null==e.view)throw Error("The selector must be either a string or a component.");if("string"==typeof e&&void 0===a[e]){for(var t,n,r=[],s={};t=i.exec(e);){var l=t[1],u=t[2];if(""===l&&""!==u)n=u;else if("#"===l)s.id=u;else if("."===l)r.push(u);else if("["===t[3][0]){var c=t[6];c&&(c=c.replace(/\\(["'])/g,"$1").replace(/\\\\/g,"\\")),s[t[4]]=c||!0}}r.length>0&&(s.className=r.join(" ")),a[e]=function(e,t){var r,i,a=!1,l=e.className||e["class"];for(var u in s)e[u]=s[u];void 0!==l&&(void 0!==e["class"]&&(e["class"]=void 0,e.className=l),void 0!==s.className&&(e.className=s.className+" "+l));for(var u in e)if("key"!==u){a=!0;break}return t instanceof Array&&1==t.length&&null!=t[0]&&"#"===t[0].tag?i=t[0].children:r=t,o(n||"div",e.key,a?e:void 0,r,i,void 0)}}var d,f,p;if(null!=arguments[1]&&("object"!=typeof arguments[1]||void 0!==arguments[1].tag||arguments[1]instanceof Array)?p=1:(d=arguments[1],p=2),arguments.length===p+1)f=arguments[p]instanceof Array?arguments[p]:[arguments[p]];else{f=[];for(var v=p;v<arguments.length;v++)f.push(arguments[v])}return"string"==typeof e?a[e](d||{},o.normalizeChildren(f)):o(e,d&&d.key,d||{},o.normalizeChildren(f),void 0,void 0)}var o=e("../render/vnode"),i=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g,a={};t.exports=r},{"../render/vnode":20}],18:[function(e,t,n){"use strict";var r=e("../render/vnode");t.exports=function(e){function t(e){return U=e}function n(e,t,n,r,i,a,s){for(var l=n;r>l;l++){var u=t[l];null!=u&&k(e,o(u,i,s),a)}}function o(e,t,n){var r=e.tag;if(null!=e.attrs&&K(e.attrs,e,t),"string"!=typeof r)return u(e,t,n);switch(r){case"#":return i(e);case"<":return a(e);case"[":return s(e,t,n);default:return l(e,t,n)}}function i(e){return e.dom=X.createTextNode(e.children)}function a(e){var t=e.children.match(/^\s*?<(\w+)/im)||[],n={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"}[t[1]]||"div",r=X.createElement(n);r.innerHTML=e.children,e.dom=r.firstChild,e.domSize=r.childNodes.length;for(var o,i=X.createDocumentFragment();o=r.firstChild;)i.appendChild(o);return i}function s(e,t,r){var o=X.createDocumentFragment();if(null!=e.children){var i=e.children;n(o,i,0,i.length,t,null,r)}return e.dom=o.firstChild,e.domSize=o.childNodes.length,o}function l(e,t,o){var i=e.tag;switch(e.tag){case"svg":o="http://www.w3.org/2000/svg";break;case"math":o="http://www.w3.org/1998/Math/MathML"}var a=e.attrs,s=a&&a.is,l=o?s?X.createElementNS(o,i,{is:s}):X.createElementNS(o,i):s?X.createElement(i,{is:s}):X.createElement(i);if(e.dom=l,null!=a&&M(e,a,o),null!=e.attrs&&null!=e.attrs.contenteditable)x(e);else if(null!=e.text&&(""!==e.text?l.textContent=e.text:e.children=[r("#",void 0,void 0,e.text,void 0,void 0)]),null!=e.children){var u=e.children;n(l,u,0,u.length,t,null,o),O(e)}return l}function u(e,t,n){e.state||(e.state={}),W(e.state,e.tag);var i=e.tag.view;if(null!=i.reentrantLock)return H;if(i.reentrantLock=!0,K(e.tag,e,t),e.instance=r.normalize(i.call(e.state,e)),i.reentrantLock=null,null!=e.instance){if(e.instance===e)throw Error("A view cannot return the vnode it received as arguments");var a=o(e.instance,t,n);return e.dom=e.instance.dom,e.domSize=null!=e.dom?e.instance.domSize:0,a}return e.domSize=0,H}function c(e,t,r,i,a,s){if(t!==r&&(null!=t||null!=r))if(null==t)n(e,r,0,r.length,i,a,void 0);else if(null==r)P(t,0,t.length,r);else{var l=g(t,r);if(l&&(t=t.concat(t.pool)),t.length===r.length&&null!=r[0]&&null==r[0].key)for(var u=0;u<t.length;u++)t[u]===r[u]||null==t[u]&&null==r[u]||(null==t[u]?k(e,o(r[u],i,s),w(t,u+1,a)):null==r[u]?P(t,u,u+1,r):d(e,t[u],r[u],i,w(t,u+1,a),l,s),l&&t[u].tag===r[u].tag&&k(e,y(t[u]),w(t,u+1,a)));else{for(var c,f=0,p=0,v=t.length-1,h=r.length-1;v>=f&&h>=p;){var m=t[f],x=r[p];if(m!==x||l)if(null!=m&&null!=x&&m.key===x.key)f++,p++,d(e,m,x,i,w(t,f,a),l,s),l&&m.tag===x.tag&&k(e,y(m),a);else{var m=t[v];if(m!==x||l){if(null==m||null==x||m.key!==x.key)break;d(e,m,x,i,w(t,v+1,a),l,s),(l||h>p)&&k(e,y(m),w(t,f,a)),v--,p++}else v--,p++}else f++,p++}for(;v>=f&&h>=p;){var m=t[v],x=r[h];if(m!==x||l)if(null!=m&&null!=x&&m.key===x.key)d(e,m,x,i,w(t,v+1,a),l,s),l&&m.tag===x.tag&&k(e,y(m),a),null!=m.dom&&(a=m.dom),v--,h--;else{if(c||(c=b(t,v)),null!=x){var C=c[x.key];if(null!=C){var E=t[C];d(e,E,x,i,w(t,v+1,a),l,s),k(e,y(E),a),t[C].skip=!0,null!=E.dom&&(a=E.dom)}else{var S=o(x,i,void 0);k(e,S,a),a=S}}h--}else v--,h--;if(p>h)break}n(e,r,p,h+1,i,a,s),P(t,f,v+1,r)}}}function d(e,t,n,r,i,a,s){var l=t.tag,u=n.tag;if(l===u){if(n.state=t.state,n.events=t.events,I(n,t))return;if(null!=n.attrs&&L(n.attrs,n,r,a),"string"==typeof l)switch(l){case"#":f(t,n);break;case"<":p(e,t,n,i);break;case"[":v(e,t,n,r,i,s);break;default:h(t,n,r,s)}else m(e,t,n,r,i,a,s)}else E(t,null),k(e,o(n,r,s),i)}function f(e,t){e.children.toString()!==t.children.toString()&&(e.dom.nodeValue=t.children),t.dom=e.dom}function p(e,t,n,r){t.children!==n.children?(y(t),k(e,a(n),r)):(n.dom=t.dom,n.domSize=t.domSize)}function v(e,t,n,r,o,i){c(e,t.children,n.children,r,o,i);var a=0,s=n.children;if(n.dom=null,null!=s){for(var l=0;l<s.length;l++){var u=s[l];null!=u&&null!=u.dom&&(null==n.dom&&(n.dom=u.dom),a+=u.domSize||1)}1!==a&&(n.domSize=a)}}function h(e,t,n,o){var i=t.dom=e.dom;switch(t.tag){case"svg":o="http://www.w3.org/2000/svg";break;case"math":o="http://www.w3.org/1998/Math/MathML"}"textarea"===t.tag&&(null==t.attrs&&(t.attrs={}),null!=t.text&&(t.attrs.value=t.text,t.text=void 0)),z(t,e.attrs,t.attrs,o),null!=t.attrs&&null!=t.attrs.contenteditable?x(t):null!=e.text&&null!=t.text&&""!==t.text?e.text.toString()!==t.text.toString()&&(e.dom.firstChild.nodeValue=t.text):(null!=e.text&&(e.children=[r("#",void 0,void 0,e.text,void 0,e.dom.firstChild)]),null!=t.text&&(t.children=[r("#",void 0,void 0,t.text,void 0,void 0)]),c(i,e.children,t.children,n,null,o))}function m(e,t,n,i,a,s,l){n.instance=r.normalize(n.tag.view.call(n.state,n)),L(n.tag,n,i,s),null!=n.instance?(null==t.instance?k(e,o(n.instance,i,l),a):d(e,t.instance,n.instance,i,a,s,l),n.dom=n.instance.dom,n.domSize=n.instance.domSize):null!=t.instance?(E(t.instance,null),n.dom=void 0,n.domSize=0):(n.dom=t.dom,n.domSize=t.domSize)}function g(e,t){if(null!=e.pool&&Math.abs(e.pool.length-t.length)<=Math.abs(e.length-t.length)){var n=e[0]&&e[0].children&&e[0].children.length||0,r=e.pool[0]&&e.pool[0].children&&e.pool[0].children.length||0,o=t[0]&&t[0].children&&t[0].children.length||0;if(Math.abs(r-o)<=Math.abs(n-o))return!0}return!1}function b(e,t){for(var n={},r=0,r=0;t>r;r++){var o=e[r];if(null!=o){var i=o.key;null!=i&&(n[i]=r)}}return n}function y(e){var t=e.domSize;if(null!=t||null==e.dom){var n=X.createDocumentFragment();if(t>0){for(var r=e.dom;--t;)n.appendChild(r.nextSibling);n.insertBefore(r,n.firstChild)}return n}return e.dom}function w(e,t,n){for(;t<e.length;t++)if(null!=e[t]&&null!=e[t].dom)return e[t].dom;return n}function k(e,t,n){console.log(e,t),n&&n.parentNode?e.insertBefore(t,n):e.appendChild(t)}function x(e){var t=e.children;if(null!=t&&1===t.length&&"<"===t[0].tag){var n=t[0].children;e.dom.innerHTML!==n&&(e.dom.innerHTML=n)}else if(null!=t||null!=e.text)throw new Error("Child node of a contenteditable must be trusted")}function P(e,t,n,r){for(var o=t;n>o;o++){var i=e[o];null!=i&&(i.skip?i.skip=!1:E(i,r))}}function C(e){var t=!1;return function(){t||(t=!0,e())}}function E(e,t){function n(){if(++o===r&&(A(e),e.dom)){var n=e.domSize||1;if(n>1)for(var i=e.dom;--n;)S(i.nextSibling);S(e.dom),null==t||null!=e.domSize||D(e.attrs)||"string"!=typeof e.tag||(t.pool?t.pool.push(e):t.pool=[e])}}var r=1,o=0;e.attrs&&e.attrs.onbeforeremove&&(r++,e.attrs.onbeforeremove.call(e.state,e,C(n))),"string"!=typeof e.tag&&e.tag.onbeforeremove&&(r++,e.tag.onbeforeremove.call(e.state,e,C(n))),n()}function S(e){var t=e.parentNode;null!=t&&t.removeChild(e)}function A(e){if(e.attrs&&e.attrs.onremove&&e.attrs.onremove.call(e.state,e),"string"!=typeof e.tag&&e.tag.onremove&&e.tag.onremove.call(e.state,e),null!=e.instance)A(e.instance);else{var t=e.children;if(t instanceof Array)for(var n=0;n<t.length;n++){var r=t[n];null!=r&&A(r)}}}function M(e,t,n){for(var r in t)q(e,r,null,t[r],n)}function q(e,t,n,r,o){var i=e.dom;if("key"!==t&&(n!==r||T(e,t)||"object"==typeof r)&&"undefined"!=typeof r&&!j(t)){var a=t.indexOf(":");if(a>-1&&"xlink"===t.substr(0,a))i.setAttributeNS("http://www.w3.org/1999/xlink",t.slice(a+1),r);else if("o"===t[0]&&"n"===t[1]&&"function"==typeof r)F(e,t,r);else if("style"===t)R(i,n,r);else if(t in i&&!N(t)&&void 0===o){if("input"===e.tag&&"value"===t&&e.dom.value===r&&e.dom===X.activeElement)return;i[t]=r}else"boolean"==typeof r?r?i.setAttribute(t,""):i.removeAttribute(t):i.setAttribute("className"===t?"class":t,r)}}function O(e){var t=e.attrs;"select"===e.tag&&null!=t&&("value"in t&&q(e,"value",null,t.value,void 0),"selectedIndex"in t&&q(e,"selectedIndex",null,t.selectedIndex,void 0))}function z(e,t,n,r){if(null!=n)for(var o in n)q(e,o,t&&t[o],n[o],r);if(null!=t)for(var o in t)null!=n&&o in n||("className"===o&&(o="class"),"o"!==o[0]||"n"!==o[1]||j(o)?"key"!==o&&e.dom.removeAttribute(o):F(e,o,void 0))}function T(e,t){return"value"===t||"checked"===t||"selectedIndex"===t||"selected"===t&&e.dom===X.activeElement}function j(e){return"oninit"===e||"oncreate"===e||"onupdate"===e||"onremove"===e||"onbeforeremove"===e||"onbeforeupdate"===e}function N(e){return"href"===e||"list"===e||"form"===e||"width"===e||"height"===e}function D(e){return null!=e&&(e.oncreate||e.onupdate||e.onbeforeremove||e.onremove)}function R(e,t,n){if(t===n&&(e.style.cssText="",t=null),null==n)e.style.cssText="";else if("string"==typeof n)e.style.cssText=n;else{"string"==typeof t&&(e.style.cssText="");for(var r in n)e.style[r]=n[r];if(null!=t&&"string"!=typeof t)for(var r in t)r in n||(e.style[r]="")}}function F(e,t,n){var r=e.dom,o=function(e){var t=n.call(r,e);return"function"==typeof U&&U.call(r,e),t};if(t in r)r[t]="function"==typeof n?o:null;else{var i=t.slice(2);void 0===e.events&&(e.events={}),null!=e.events[t]&&r.removeEventListener(i,e.events[t],!1),"function"==typeof n&&(e.events[t]=o,r.addEventListener(i,e.events[t],!1))}}function K(e,t,n){"function"==typeof e.oninit&&e.oninit.call(t.state,t),"function"==typeof e.oncreate&&n.push(e.oncreate.bind(t.state,t))}function L(e,t,n,r){r?K(e,t,n):"function"==typeof e.onupdate&&n.push(e.onupdate.bind(t.state,t))}function I(e,t){var n,r;return null!=e.attrs&&"function"==typeof e.attrs.onbeforeupdate&&(n=e.attrs.onbeforeupdate.call(e.state,e,t)),"string"!=typeof e.tag&&"function"==typeof e.tag.onbeforeupdate&&(r=e.tag.onbeforeupdate.call(e.state,e,t)),void 0===n&&void 0===r||n||r?!1:(e.dom=t.dom,e.domSize=t.domSize,e.instance=t.instance,!0)}function W(e,t){Object.keys(t).forEach(function(n){e[n]=t[n]})}function B(e,t){if(!e)throw new Error("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var n=[],o=X.activeElement;null==e.vnodes&&(e.textContent=""),t instanceof Array||(t=[t]),c(e,e.vnodes,r.normalizeChildren(t),n,null,void 0),e.vnodes=t;for(var i=0;i<n.length;i++)n[i]();X.activeElement!==o&&o.focus()}var U,X=e.document,H=X.createDocumentFragment();return{render:B,setEventCallback:t}}},{"../render/vnode":20}],19:[function(e,t,n){"use strict";var r=e("../render/vnode");t.exports=function(e){return null==e&&(e=""),r("<",void 0,void 0,e,void 0,void 0)}},{"../render/vnode":20}],20:[function(e,t,n){function r(e,t,n,r,o,i){return{tag:e,key:t,attrs:n,children:r,text:o,dom:i,domSize:void 0,state:{},events:void 0,instance:void 0,skip:!1}}r.normalize=function(e){return e instanceof Array?r("[",void 0,void 0,r.normalizeChildren(e),void 0,void 0):null!=e&&"object"!=typeof e?r("#",void 0,void 0,e,void 0,void 0):e},r.normalizeChildren=function(e){for(var t=0;t<e.length;t++)e[t]=r.normalize(e[t]);return e},t.exports=r},{}],21:[function(e,t,n){var r=e("./promise/promise");t.exports=e("./request/request")(window,r)},{"./promise/promise":11,"./request/request":22}],22:[function(e,t,n){"use strict";var r=e("../querystring/build");t.exports=function(e,t){function n(e){p=e}function o(){0===--h&&"function"==typeof p&&p()}function i(e){var t=e.then;return e.then=function(){h++;var n=t.apply(e,arguments);return n.then(o,function(e){throw o(),e}),i(n)},e}function a(n,r){return i(new t(function(t,o){if("string"==typeof n){var i=n;n=r||{},null==n.url&&(n.url=i)}null==n.method&&(n.method="GET"),n.method=n.method.toUpperCase();var a="boolean"==typeof n.useBody?n.useBody:"GET"!==n.method&&"TRACE"!==n.method;"function"!=typeof n.serialize&&(n.serialize="undefined"!=typeof FormData&&n.data instanceof FormData?function(e){return e}:JSON.stringify),"function"!=typeof n.deserialize&&(n.deserialize=c),"function"!=typeof n.extract&&(n.extract=d),n.url=l(n.url,n.data),a?n.data=n.serialize(n.data):n.url=u(n.url,n.data);var s=new e.XMLHttpRequest;s.open(n.method,n.url,"boolean"==typeof n.async?n.async:!0,"string"==typeof n.user?n.user:void 0,"string"==typeof n.password?n.password:void 0),n.serialize===JSON.stringify&&a&&s.setRequestHeader("Content-Type","application/json; charset=utf-8"),n.deserialize===c&&s.setRequestHeader("Accept","application/json, text/*"),"function"==typeof n.config&&(s=n.config(s,n)||s),s.onreadystatechange=function(){if(4===s.readyState)try{var e=n.extract!==d?n.extract(s,n):n.deserialize(n.extract(s,n));if(s.status>=200&&s.status<300||304===s.status)t(f(n.type,e));else{var r=new Error(s.responseText);for(var i in e)r[i]=e[i];o(r)}}catch(a){o(a)}},a&&null!=n.data?s.send(n.data):s.send()}))}function s(n){return i(new t(function(t,r){var o=n.callbackName||"_mithril_"+Math.round(1e16*Math.random())+"_"+v++,i=e.document.createElement("script");e[o]=function(r){i.parentNode.removeChild(i),t(f(n.type,r)),delete e[o]},i.onerror=function(){i.parentNode.removeChild(i),r(new Error("JSONP request failed")),delete e[o]},null==n.data&&(n.data={}),n.url=l(n.url,n.data),n.data[n.callbackKey||"callback"]=o,i.src=u(n.url,n.data),e.document.documentElement.appendChild(i)}))}function l(e,t){if(null==t)return e;for(var n=e.match(/:[^\/]+/gi)||[],r=0;r<n.length;r++){var o=n[r].slice(1);null!=t[o]&&(e=e.replace(n[r],t[o]),delete t[o])}return e}function u(e,t){var n=r(t);if(""!==n){var o=e.indexOf("?")<0?"?":"&";e+=o+n}return e}function c(e){try{return""!==e?JSON.parse(e):null}catch(t){throw new Error(e)}}function d(e){return e.responseText}function f(e,t){if("function"==typeof e){if(!(t instanceof Array))return new e(t);for(var n=0;n<t.length;n++)t[n]=new e(t[n])}return t}var p,v=0,h=0;return{request:a,jsonp:s,setCompletionCallback:n}}},{"../querystring/build":12}],23:[function(e,t,n){var r=e("./mount");t.exports=e("./api/router")(window,r)},{"./api/router":6,"./mount":10}],24:[function(e,t,n){"use strict";var r=e("../querystring/build"),o=e("../querystring/parse");t.exports=function(e){function t(e){v=e}function n(t){var n=e.location[t].replace(/(?:%[a-f89][a-f0-9])+/gim,decodeURIComponent);return"pathname"===t&&"/"!==n[0]&&(n="/"+n),n}function i(e){return function(){null==d&&(d=p(function(){d=null,e()}))}}function a(e,t,n){var r=e.indexOf("?"),i=e.indexOf("#"),a=r>-1?r:i>-1?i:e.length;if(r>-1){var s=i>-1?i:e.length,l=o(e.slice(r+1,s));for(var u in l)t[u]=l[u]}if(i>-1){var c=o(e.slice(i+1));for(var u in c)n[u]=c[u]}return e.slice(0,a)}function s(){var e=v.charAt(0);switch(e){case"#":return n("hash").slice(v.length);case"?":return n("search").slice(v.length)+n("hash");default:return n("pathname").slice(v.length)+n("search")+n("hash")}}function l(t,n,o){var i={},s={};if(t=a(t,i,s),null!=n){for(var l in n)i[l]=n[l];t=t.replace(/:([^\/]+)/g,function(e,t){return delete i[t],n[t]})}var u=r(i);u&&(t+="?"+u);var c=r(s);c&&(t+="#"+c),f?(o&&o.replace?e.history.replaceState(null,null,v+t):e.history.pushState(null,null,v+t),e.onpopstate()):e.location.href=v+t}function u(t,n,r){function o(){var e=s(),o={},i=a(e,o,o);for(var l in t){var u=new RegExp("^"+l.replace(/:[^\/]+?\.{3}/g,"(.*?)").replace(/:[^\/]+/g,"([^\\/]+)")+"/?$");if(u.test(i))return void i.replace(u,function(){for(var r=l.match(/:[^\/]+/g)||[],i=[].slice.call(arguments,1,-2),a=0;a<r.length;a++)o[r[a].replace(/:|\./g,"")]=decodeURIComponent(i[a]);n(t[l],o,e,l)})}r(e,o)}return f?e.onpopstate=i(o):"#"===v.charAt(0)&&(e.onhashchange=o),o(),o}function c(e){e.dom.setAttribute("href",v+e.attrs.href),e.dom.onclick=function(e){if(!(e.ctrlKey||e.metaKey||e.shiftKey||2===e.which)){e.preventDefault(),e.redraw=!1;var t=this.getAttribute("href");0===t.indexOf(v)&&(t=t.slice(v.length)),l(t,void 0,void 0)}}}var d,f="function"==typeof e.history.pushState,p="function"==typeof setImmediate?setImmediate:setTimeout,v="#!";return{setPrefix:t,getPath:s,setPath:l,defineRoutes:u,link:c}}},{"../querystring/build":12,"../querystring/parse":13}],25:[function(e,t,n){"use strict";t.exports=function(e,t,n){return function(r){return t.call(n||this,e in r.currentTarget?r.currentTarget[e]:r.currentTarget.getAttribute(e))}}},{}],26:[function(e,t,n){function r(e,t,n){var r=n?c.invertKey(e):e;return{key:r,pos:c.key2pos(r),role:t.role,color:t.color}}function o(e,t){return e.role===t.role&&e.color===t.color}function i(e,t){return t.sort(function(t,n){return c.distance(e.pos,t.pos)-c.distance(e.pos,n.pos)})[0]}function a(e,t){var n=t.bounds(),a=n.width/8,s=n.height/8,l={},u=[],d=[],f=[],p=[],v=e.orientation!==t.orientation,h={},m="white"===t.orientation;for(var g in e.pieces){var b=r(g,e.pieces[g],v);h[b.key]=b}for(var y=0;y<c.allKeys.length;y++){var w=c.allKeys[y];if(w!==t.movable.dropped[1]){var k=t.pieces[w],x=h[w];k?x?o(k,x)||(f.push(x),p.push(r(w,k,!1))):p.push(r(w,k,!1)):x&&f.push(x)}}return p.forEach(function(e){var t=i(e,f.filter(c.partial(o,e)));if(t){var n=m?t.pos:e.pos,r=m?e.pos:t.pos,d=[(n[0]-r[0])*a,(r[1]-n[1])*s];l[e.key]=[d,d],u.push(t.key)}}),f.forEach(function(e){e.key===t.movable.dropped[0]||c.containsX(u,e.key)||(t.items?t.items.render(e.pos,e.key):!1)||d.push({piece:e,opacity:1})}),{anims:l,fadings:d}}function s(e,t){return Math.round(e*t)/t}function l(e){if(e.animation.current.start){var t=1-((new Date).getTime()-e.animation.current.start)/e.animation.current.duration;if(0>=t)e.animation.current={},e.render();else{var n=d.easeInOutCubic(t);for(var r in e.animation.current.anims){var o=e.animation.current.anims[r];o[1]=[s(o[0][0]*n,10),s(o[0][1]*n,10)]}for(var i in e.animation.current.fadings)e.animation.current.fadings[i].opacity=s(n,100);e.render(),c.requestAnimationFrame(function(){l(e)})}}}function u(e,t){var n={orientation:t.orientation,pieces:{}};for(var r in t.pieces)n.pieces[r]={role:t.pieces[r].role,color:t.pieces[r].color};var o=e();if(t.animation.enabled){var i=a(n,t);if(Object.keys(i.anims).length>0||i.fadings.length>0){var s=t.animation.current.start;t.animation.current={start:(new Date).getTime(),duration:t.animation.duration,anims:i.anims,fadings:i.fadings},s||l(t)}else t.renderRAF()}else t.renderRAF();return o}var c=e("./util"),d={easeInOutCubic:function(e){return.5>e?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}};t.exports=function(e,t,n){return function(){var r=[t].concat(Array.prototype.slice.call(arguments,0));if(t.render){if(t.animation.enabled&&!n)return u(c.partialApply(e,r),t);var o=e.apply(null,r);return t.renderRAF(),o}return e.apply(null,r)}}},{"./util":39}],27:[function(e,t,n){var r=e("./board");t.exports=function(e){return{set:e.set,toggleOrientation:e.toggleOrientation,getOrientation:e.getOrientation,getPieces:function(){return e.data.pieces},getMaterialDiff:function(){return r.getMaterialDiff(e.data)},getFen:e.getFen,move:e.apiMove,newPiece:e.apiNewPiece,setPieces:e.setPieces,setCheck:e.setCheck,playPremove:e.playPremove,playPredrop:e.playPredrop,cancelPremove:e.cancelPremove,cancelPredrop:e.cancelPredrop,cancelMove:e.cancelMove,stop:e.stop,explode:e.explode,setAutoShapes:e.setAutoShapes,setShapes:e.setShapes,data:e.data}}},{"./board":28}],28:[function(e,t,n){function r(e){setTimeout(e,1)}function o(e){e.orientation=R.opposite(e.orientation)}function i(e){e.lastMove=null,k(e,null),u(e),d(e)}function a(e,t){Object.keys(t).forEach(function(n){t[n]?e.pieces[n]=t[n]:delete e.pieces[n]}),e.movable.dropped=[]}function s(e,t){var n=t||e.turnColor;Object.keys(e.pieces).forEach(function(t){e.pieces[t].color===n&&"king"===e.pieces[t].role&&(e.check=t)})}function l(e,t,n){d(e),e.premovable.current=[t,n],r(R.partial(e.premovable.events.set,t,n))}function u(e){e.premovable.current&&(e.premovable.current=null,r(e.premovable.events.unset))}function c(e,t,n){u(e),e.predroppable.current={role:t,key:n},r(R.partial(e.predroppable.events.set,t,n))}function d(e){e.predroppable.current.key&&(e.predroppable.current={},r(e.predroppable.events.unset))}function f(e,t,n){if(e.autoCastle){var r=e.pieces[n];if("king"===r.role){var o=R.key2pos(t);if(5===o[0]&&(1===o[1]||8===o[1])){var i,a,s,l=R.key2pos(n);if(7===l[0]||8===l[0])i=R.pos2key([8,o[1]]),a=R.pos2key([6,o[1]]),s=R.pos2key([7,o[1]]);else{if(3!==l[0]&&1!==l[0])return;i=R.pos2key([1,o[1]]),a=R.pos2key([4,o[1]]),s=R.pos2key([3,o[1]])}delete e.pieces[t],delete e.pieces[n],delete e.pieces[i],e.pieces[s]={role:"king",color:r.color},e.pieces[a]={role:"rook",color:r.color}}}}}function p(e,t,n){var o=K(function(){if(t===n||!e.pieces[t])return!1;var o=e.pieces[n]&&e.pieces[n].color!==e.pieces[t].color?e.pieces[n]:null;return r(R.partial(e.events.move,t,n,o)),e.pieces[n]=e.pieces[t],delete e.pieces[t],e.lastMove=[t,n],e.check=null,f(e,t,n),r(e.events.change),!0},e)();return o&&(e.movable.dropped=[]),o}function v(e,t,n){return e.pieces[n]?!1:(r(R.partial(e.events.dropNewPiece,t,n)),e.pieces[n]=t,e.lastMove=[n,n],e.check=null,r(e.events.change),e.movable.dropped=[],e.movable.dests={},e.turnColor=R.opposite(e.turnColor),e.renderRAF(),!0)}function h(e,t,n){var r=p(e,t,n);return r&&(e.movable.dests={},e.turnColor=R.opposite(e.turnColor)),r}function m(e,t,n){return p(e,t,n)}function g(e,t,n){return v(e,t,n)}function b(e,t,n){if(n)if(P(e,t,n)){if(h(e,t,n)){var o=L.stop();return k(e,null),r(R.partial(e.movable.events.after,t,n,{premove:!1,holdTime:o})),!0}}else S(e,t,n)?(l(e,t,n),k(e,null)):x(e,n)||E(e,n)?(k(e,n),L.start()):k(e,null);else L.cancel(),k(e,null),"trash"===e.movable.dropOff&&(delete e.pieces[t],r(e.events.change))}function y(e,t,n){if(C(e,t,n)){var o=e.pieces[t];delete e.pieces[t],v(e,o,n),e.movable.dropped=[],r(R.partial(e.movable.events.afterNewPiece,o.role,n,{predrop:!1}))}else A(e,t,n)?c(e,e.pieces[t].role,n):(u(e),d(e));delete e.pieces[t],k(e,null)}function w(e,t){e.selected?t&&(e.selected!==t||e.draggable.enabled)?e.selectable.enabled&&e.selected!==t?b(e,e.selected,t)&&(e.stats.dragged=!1):L.start():(k(e,null),L.cancel()):(x(e,t)||E(e,t))&&(k(e,t),L.start()),t&&r(R.partial(e.events.select,t))}function k(e,t){e.selected=t,e.premovable.dests=t&&E(e,t)?F(e.pieces,t,e.premovable.castle):null}function x(e,t){var n=e.pieces[t];return n&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}function P(e,t,n){return t!==n&&x(e,t)&&(e.movable.free||R.containsX(e.movable.dests[t],n))}function C(e,t,n){var r=e.pieces[t];return r&&n&&(t===n||!e.pieces[n])&&("both"===e.movable.color||e.movable.color===r.color&&e.turnColor===r.color)}function E(e,t){var n=e.pieces[t];return n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function S(e,t,n){return t!==n&&E(e,t)&&R.containsX(F(e.pieces,t,e.premovable.castle),n)}function A(e,t,n){var r=e.pieces[t];return r&&n&&(!e.pieces[n]||e.pieces[n].color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==r.role||"1"!==n[1]&&"8"!==n[1])&&e.movable.color===r.color&&e.turnColor!==r.color}function M(e,t){var n=e.pieces[t];return n&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function q(e){var t=e.premovable.current;if(t){var n=t[0],o=t[1],i=!1;return P(e,n,o)&&h(e,n,o)&&(r(R.partial(e.movable.events.after,n,o,{
premove:!0})),i=!0),u(e),i}}function O(e,t){var n=e.predroppable.current,o=!1;if(n.key){if(t(n)){var i={role:n.role,color:e.movable.color};v(e,i,n.key)&&(r(R.partial(e.movable.events.afterNewPiece,n.role,n.key,{predrop:!0})),o=!0)}return d(e),o}}function z(e){u(e),d(e),w(e,null)}function T(e){e.movable.color=null,e.movable.dests={},z(e)}function j(e,t,n){if(n||e.bounds){n=n||e.bounds();var r=Math.ceil(8*((t[0]-n.left)/n.width));r="white"===e.orientation?r:9-r;var o=Math.ceil(8-8*((t[1]-n.top)/n.height));return o="white"===e.orientation?o:9-o,r>0&&9>r&&o>0&&9>o?R.pos2key([r,o]):void 0}}function N(e){var t={king:0,queen:0,rook:0,bishop:0,knight:0,pawn:0};for(var n in e.pieces){var r=e.pieces[n];t[r.role]+="white"===r.color?1:-1}var o={white:{},black:{}};for(var i in t){var a=t[i];a>0?o.white[i]=a:0>a&&(o.black[i]=-a)}return o}function D(e){var t=0;for(var n in e.pieces)t+=I[e.pieces[n].role]*("white"===e.pieces[n].color?1:-1);return t}var R=e("./util"),F=e("./premove"),K=e("./anim"),L=e("./hold"),I={pawn:1,knight:3,bishop:3,rook:5,queen:9,king:0};t.exports={reset:i,toggleOrientation:o,setPieces:a,setCheck:s,selectSquare:w,setSelected:k,isDraggable:M,canMove:P,userMove:b,dropNewPiece:y,apiMove:m,apiNewPiece:g,playPremove:q,playPredrop:O,unsetPremove:u,unsetPredrop:d,cancelMove:z,stop:T,getKeyAtDomPos:j,getMaterialDiff:N,getScore:D}},{"./anim":26,"./hold":36,"./premove":37,"./util":39}],29:[function(e,t,n){var r=e("merge"),o=e("./board"),i=e("./fen");t.exports=function(e,t){if(t&&(t.movable&&t.movable.dests&&delete e.movable.dests,r.recursive(e,t),e.fen&&(e.pieces=i.read(e.fen),e.check=t.check,e.drawable.shapes=[],delete e.fen),e.check===!0&&o.setCheck(e),e.movable.dropped=[],e.selected&&o.setSelected(e,e.selected),(!e.animation.duration||e.animation.duration<40)&&(e.animation.enabled=!1),!e.movable.rookCastle)){var n="white"===e.movable.color?1:8,a="e"+n;if(e.movable.dests){var s=e.movable.dests[a];if(!s||"king"!==e.pieces[a].role)return;e.movable.dests[a]=s.filter(function(e){return e!=="a"+n&&e!=="h"+n})}}}},{"./board":28,"./fen":35,merge:2}],30:[function(e,t,n){function r(e,t,n){var r=document.createElement("coords");return r.className=t,e.forEach(function(e){var t=document.createElement("coord");t.textContent=e,r.appendChild(t)}),r}var o=(e("mithril"),e("./util"));t.exports=function(e,t){o.requestAnimationFrame(function(){var n=document.createDocumentFragment(),i="black"===e?" black":"";n.appendChild(r(o.ranks,"ranks"+i)),n.appendChild(r(o.files,"files"+i)),t.appendChild(n)});var e;return function(n){if(n!==e){e=n;var r=t.querySelectorAll("coords");for(i=0;i<r.length;++i)r[i].classList.toggle("black","black"===n)}}}},{"./util":39,mithril:9}],31:[function(e,t,n){var r=e("./board"),o=e("./data"),i=e("./fen"),a=e("./configure"),s=e("./anim"),l=e("./drag");t.exports=function(e){this.data=o(e),this.vm={exploding:!1},this.getFen=function(){return i.write(this.data.pieces)}.bind(this),this.getOrientation=function(){return this.data.orientation}.bind(this),this.set=s(a,this.data),this.toggleOrientation=function(){s(r.toggleOrientation,this.data)(),this.data.redrawCoords&&this.data.redrawCoords(this.data.orientation)}.bind(this),this.setPieces=s(r.setPieces,this.data),this.selectSquare=s(r.selectSquare,this.data,!0),this.apiMove=s(r.apiMove,this.data),this.apiNewPiece=s(r.apiNewPiece,this.data),this.playPremove=s(r.playPremove,this.data),this.playPredrop=s(r.playPredrop,this.data),this.cancelPremove=s(r.unsetPremove,this.data,!0),this.cancelPredrop=s(r.unsetPredrop,this.data,!0),this.setCheck=s(r.setCheck,this.data,!0),this.cancelMove=s(function(e){r.cancelMove(e),l.cancel(e)}.bind(this),this.data,!0),this.stop=s(function(e){r.stop(e),l.cancel(e)}.bind(this),this.data,!0),this.explode=function(e){this.data.render&&(this.vm.exploding={stage:1,keys:e},this.data.renderRAF(),setTimeout(function(){this.vm.exploding.stage=2,this.data.renderRAF(),setTimeout(function(){this.vm.exploding=!1,this.data.renderRAF()}.bind(this),120)}.bind(this),120))}.bind(this),this.setAutoShapes=function(e){s(function(t){t.drawable.autoShapes=e},this.data,!1)()}.bind(this),this.setShapes=function(e){s(function(t){t.drawable.shapes=e},this.data,!1)()}.bind(this)}},{"./anim":26,"./board":28,"./configure":29,"./data":32,"./drag":33,"./fen":35}],32:[function(e,t,n){var r=e("./fen"),o=e("./configure");t.exports=function(e){var t={pieces:r.read(r.initial),orientation:"white",turnColor:"white",check:null,lastMove:null,selected:null,coordinates:!0,render:null,renderRAF:null,element:null,bounds:null,autoCastle:!1,viewOnly:!1,disableContextMenu:!1,resizable:!0,pieceKey:!1,highlight:{lastMove:!0,check:!0,dragOver:!0},animation:{enabled:!0,duration:200,current:{}},movable:{free:!0,color:"both",dests:{},dropOff:"revert",dropped:[],showDests:!0,events:{after:function(e,t,n){},afterNewPiece:function(e,t){}},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,dests:[],current:null,events:{set:function(e,t){},unset:function(){}}},predroppable:{enabled:!1,current:{},events:{set:function(e,t){},unset:function(){}}},draggable:{enabled:!0,distance:3,autoDistance:!0,centerPiece:!0,showGhost:!0,current:{}},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{change:function(){},move:function(e,t,n){},dropNewPiece:function(e,t){},capture:function(e,t){},select:function(e){}},items:null,drawable:{enabled:!1,eraseOnClick:!0,onChange:function(e){},shapes:[],autoShapes:[],current:{},brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"https://lichess1.org/assets/piece/cburnett/"}}};return o(t,e||{}),t}},{"./configure":29,"./fen":35}],33:[function(e,t,n){function r(e){return e?e.color+e.role:""}function o(e,t,n){var r=f.key2pos(n);return"white"!==e.orientation&&(r[0]=9-r[0],r[1]=9-r[1]),{left:t.left+t.width*(r[0]-1)/8,top:t.top+t.height*(8-r[1])/8,width:t.width/8,height:t.height/8}}function i(e,t){if(!(void 0!==t.button&&0!==t.button||t.touches&&t.touches.length>1)){t.stopPropagation(),t.preventDefault(),c=t.target;var n=e.selected,i=f.eventPosition(t),s=e.bounds(),l=d.getKeyAtDomPos(e,i,s),u=e.pieces[l];if(n||!e.drawable.eraseOnClick&&u&&u.color===e.turnColor||p.clear(e),!e.viewOnly){var v=!!e.premovable.current,h=!!e.predroppable.current.key;d.selectSquare(e,l);var m=e.selected===l;if(u&&m&&d.isDraggable(e,l)){var g=o(e,s,l);e.draggable.current={previouslySelected:n,orig:l,piece:r(u),rel:i,epos:i,pos:[0,0],dec:e.draggable.centerPiece?[i[0]-(g.left+g.width/2),i[1]-(g.top+g.height/2)]:[0,0],bounds:s,started:e.draggable.autoDistance&&e.stats.dragged}}else v&&d.unsetPremove(e),h&&d.unsetPredrop(e);a(e)}}}function a(e){f.requestAnimationFrame(function(){var t=e.draggable.current;t.orig&&(e.animation.current.start&&e.animation.current.anims[t.orig]&&(e.animation.current={}),r(e.pieces[t.orig])!==t.piece?u(e):(!t.started&&f.distance(t.epos,t.rel)>=e.draggable.distance&&(t.started=!0),t.started&&(t.pos=[t.epos[0]-t.rel[0],t.epos[1]-t.rel[1]],t.over=d.getKeyAtDomPos(e,t.epos,t.bounds)))),e.render(),t.orig&&a(e)})}function s(e,t){t.touches&&t.touches.length>1||e.draggable.current.orig&&(e.draggable.current.epos=f.eventPosition(t))}function l(e,t){var n=e.draggable.current,r=n?n.orig:null;if(r){if("touchend"===t.type&&c!==t.target&&!n.newPiece)return void(e.draggable.current={});d.unsetPremove(e),d.unsetPredrop(e);var o=f.eventPosition(t),i=o?d.getKeyAtDomPos(e,o,n.bounds):n.over;n.started&&(n.newPiece?d.dropNewPiece(e,r,i):(r!==i&&(e.movable.dropped=[r,i]),d.userMove(e,r,i)&&(e.stats.dragged=!0))),r!==n.previouslySelected||r!==i&&i?e.selectable.enabled||d.setSelected(e,null):d.setSelected(e,null),e.draggable.current={}}}function u(e){e.draggable.current.orig&&(e.draggable.current={},d.selectSquare(e,null))}var c,d=e("./board"),f=e("./util"),p=e("./draw");t.exports={start:i,move:s,end:l,cancel:u,processDrag:a}},{"./board":28,"./draw":34,"./util":39}],34:[function(e,t,n){function r(e,t){if(!(t.touches&&t.touches.length>1)){t.stopPropagation(),t.preventDefault(),p.cancelMove(e);var n=v.eventPosition(t),r=e.bounds(),i=p.getKeyAtDomPos(e,n,r);e.drawable.current={orig:i,epos:n,bounds:r,brush:h[(t.shiftKey&v.isRightButton(t))+(t.altKey?2:0)]},o(e)}}function o(e){v.requestAnimationFrame(function(){var t=e.drawable.current;if(t.orig){var n=p.getKeyAtDomPos(e,t.epos,t.bounds);t.dest=t.orig===n?void 0:n}e.render(),t.orig&&o(e)})}function i(e,t){e.drawable.current.orig&&(e.drawable.current.epos=v.eventPosition(t))}function a(e,t){var n=e.drawable,r=n.current.orig,o=n.current.dest;r&&o?d(n,r,o):r&&c(n,r),n.current={},e.render()}function s(e){e.drawable.current.orig&&(e.drawable.current={})}function l(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.render(),f(e.drawable))}function u(e){return function(t){return!e(t)}}function c(e,t){var n=e.current.brush,r=function(e){return e.orig===t&&!e.dest},o=e.shapes.filter(r)[0];o&&(e.shapes=e.shapes.filter(u(r))),o&&o.brush===n||e.shapes.push({brush:n,orig:t}),f(e)}function d(e,t,n){var r=e.current.brush,o=function(e){return e.orig&&e.dest&&(e.orig===t&&e.dest===n||e.dest===t&&e.orig===n)},i=e.shapes.filter(o).length>0;i?e.shapes=e.shapes.filter(u(o)):e.shapes.push({brush:r,orig:t,dest:n}),f(e)}function f(e){e.onChange(e.shapes)}var p=e("./board"),v=e("./util"),h=["green","red","blue","yellow"];t.exports={start:r,move:i,end:a,cancel:s,clear:l,processDraw:o}},{"./board":28,"./util":39}],35:[function(e,t,n){function r(e){"start"===e&&(e=a);var t={};return e.replace(/ .+$/,"").replace(/~/g,"").split("/").forEach(function(e,n){var r=0;e.split("").forEach(function(e){var o=parseInt(e);o?r+=o:(r++,t[i.pos2key([r,8-n])]={role:s[e.toLowerCase()],color:e===e.toLowerCase()?"black":"white"})})}),t}function o(e){return[8,7,6,5,4,3,2].reduce(function(e,t){return e.replace(new RegExp(Array(t+1).join("1"),"g"),t)},i.invRanks.map(function(t){return i.ranks.map(function(n){var r=e[i.pos2key([n,t])];if(r){var o=l[r.role];return"white"===r.color?o.toUpperCase():o}return"1"}).join("")}).join("/"))}var i=e("./util"),a="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",s={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},l={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};t.exports={initial:a,read:r,write:o}},{"./util":39}],36:[function(e,t,n){var r,o=function(){r=new Date},i=function(){r=null},a=function(){if(!r)return 0;var e=new Date-r;return r=null,e};t.exports={start:o,cancel:i,stop:a}},{}],37:[function(e,t,n){function r(e,t){return Math.abs(e-t)}function o(e,t,n,o,i){return r(t,o)<2&&("white"===e?i===n+1||2>=n&&i===n+2&&t===o:i===n-1||n>=7&&i===n-2&&t===o)}function i(e,t,n,o){var i=r(e,n),a=r(t,o);return 1===i&&2===a||2===i&&1===a}function a(e,t,n,o){return r(e,n)===r(t,o)}function s(e,t,n,r){return e===n||t===r}function l(e,t,n,r){return a(e,t,n,r)||s(e,t,n,r)}function u(e,t,n,o,i,a,s){return r(o,a)<2&&r(i,s)<2||n&&i===s&&i===("white"===e?1:8)&&(5===o&&(3===a||7===a)||f.containsX(t,a))}function c(e,t){return Object.keys(e).filter(function(n){var r=e[n];return r&&r.color===t&&"rook"===r.role}).map(function(e){return f.key2pos(e)[0]})}function d(e,t,n){var r,d=e[t],p=f.key2pos(t);switch(d.role){case"pawn":r=o.bind(null,d.color);break;case"knight":r=i;break;case"bishop":r=a;break;case"rook":r=s;break;case"queen":r=l;break;case"king":r=u.bind(null,d.color,c(e,d.color),n)}return f.allPos.filter(function(e){return(p[0]!==e[0]||p[1]!==e[1])&&r(p[0],p[1],e[0],e[1])}).map(f.pos2key)}var f=e("./util");t.exports=d},{"./util":39}],38:[function(e,t,n){function r(e,t){return(e?3:4)/512*t.width}function o(e,t,n){return(e.lineWidth||10)*(t?.85:1)/512*n.width}function i(e,t){return(e.opacity||1)*(t?.9:1)}function a(e,t){return g()?0:(e?10:20)/512*t.width}function s(e,t){var n=t.width/8;return[(e[0]-.5)*n,(8.5-e[1])*n]}function l(e,t,n,o){var a=s(t,o),l=r(n,o),u=o.width/16;return{tag:"circle",attrs:{key:n?"current":t+e.key,stroke:e.color,"stroke-width":l,fill:"none",opacity:i(e,n),cx:a[0],cy:a[1],r:u-l/2}}}function u(e,t,n,r,l){var u=a(r,l),c=s(t,l),d=s(n,l),f=d[0]-c[0],p=d[1]-c[1],v=Math.atan2(p,f),h=Math.cos(v)*u,m=Math.sin(v)*u;return{tag:"line",attrs:{key:r?"current":t+n+e.key,stroke:e.color,"stroke-width":o(e,r,l),"stroke-linecap":"round","marker-end":g()?null:"url(#arrowhead-"+e.key+")",opacity:i(e,r),x1:c[0],y1:c[1],x2:d[0]-h,y2:d[1]-m}}}function c(e,t,n,r){var o=s(t,r),i=r.width/8*(n.scale||1),a="white"===n.color?"w":"b";a+=("knight"===n.role?"n":n.role[0]).toUpperCase();var l=e.baseUrl+a+".svg";return{tag:"image",attrs:{"class":n.color+" "+n.role,x:o[0]-i/2,y:o[1]-i/2,width:i,height:i,href:l}}}function d(e){return{tag:"defs",children:[e.map(function(e){return{key:e.key,tag:"marker",attrs:{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01},children:[{tag:"path",attrs:{d:"M0,0 V4 L3,2 Z",fill:e.color}}]}})]}}function f(e,t){return"white"===t?e:[9-e[0],9-e[1]]}function p(e,t,n){return function(r,o){if(r.piece)return c(e.drawable.pieces,f(m(r.orig),e.orientation),r.piece,n);if(r.brush){var i=r.brushModifiers?v(e.drawable.brushes[r.brush],r.brushModifiers,o):e.drawable.brushes[r.brush],a=f(m(r.orig),e.orientation);if(r.orig&&r.dest)return u(i,a,f(m(r.dest),e.orientation),t,n);if(r.orig)return l(i,a,t,n)}}}function v(e,t,n){return{key:"bm"+n,color:t.color||e.color,opacity:t.opacity||e.opacity,lineWidth:t.lineWidth||e.lineWidth}}function h(e,t,n){var r=[],o=[],i=n&&n.dest?t.concat(n):t;for(var a in i){var s=i[a];if(s.dest){var l=s.brush;s.brushModifiers?r.push(v(e.brushes[l],s.brushModifiers,a)):-1===o.indexOf(l)&&(r.push(e.brushes[l]),o.push(l))}}return r}var m=(e("mithril"),e("./util").key2pos),g=e("./util").isTrident;t.exports=function(e){if(e.data.bounds){var t=e.data.drawable,n=t.shapes.concat(t.autoShapes);if(n.length||t.current.orig){var r=e.data.bounds();if(r.width===r.height){var o=h(t,n,t.current);return{tag:"svg",attrs:{key:"svg"},children:[d(o),n.map(p(e.data,!1,r)),p(e.data,!0,r)(t.current,9999)]}}}}}},{"./util":39,mithril:9}],39:[function(e,t,n){function r(e){return y[e[0]-1]+e[1]}function o(e){return[x[e[0]],parseInt(e[1])]}function i(e){return y[8-x[e[0]]]+(9-parseInt(e[1]))}function a(e){return"white"===e?"black":"white"}function s(e,t){return e&&-1!==e.indexOf(t)}function l(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function u(){return"transform"in document.body.style?"transform":"webkitTransform"in document.body.style?"webkitTransform":"mozTransform"in document.body.style?"mozTransform":"oTransform"in document.body.style?"oTransform":"msTransform"}function c(){return b||(b=u()),b}function d(){return null===S&&(S=window.navigator.userAgent.indexOf("Trident/")>-1),S}function f(e){return"translate("+e[0]+"px,"+e[1]+"px)"}function p(e){return e.clientX||0===e.clientX?[e.clientX,e.clientY]:e.touches&&e.targetTouches[0]?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0}function v(e,t){return e.bind.apply(e,[null].concat(t))}function h(){return v(arguments[0],Array.prototype.slice.call(arguments,1))}function m(e){return 2===e.buttons||2===e.button}function g(e){var t,n=function(){return void 0===t&&(t=e()),t};return n.clear=function(){t=void 0},n}var b,y="abcdefgh".split(""),w=[1,2,3,4,5,6,7,8],k=[8,7,6,5,4,3,2,1],x={a:1,b:2,c:3,d:4,e:5,f:6,g:7,h:8},P=function(){var e=[];return k.forEach(function(t){w.forEach(function(n){e.push([n,t])})}),e}(),C=P.map(r),E=C.slice(0).reverse(),S=null;t.exports={files:y,ranks:w,invRanks:k,allPos:P,allKeys:C,invKeys:E,pos2key:r,key2pos:o,invertKey:i,opposite:a,translate:f,containsX:s,distance:l,eventPosition:p,partialApply:v,partial:h,transformProp:c,isTrident:d,requestAnimationFrame:(window.requestAnimationFrame||window.setTimeout).bind(window),isRightButton:m,memo:g}},{}],40:[function(e,t,n){function r(e){return e.role+" "+e.color}function o(e,t,n){var o={key:"p"+t,style:{},"class":r(e.pieces[t])},i=a(b.key2pos(t),n),s=e.draggable.current;if(s.orig===t&&s.started)i[0]+=s.pos[0]+s.dec[0],i[1]+=s.pos[1]+s.dec[1],o["class"]+=" dragging";else if(e.animation.current.anims){var l=e.animation.current.anims[t];l&&(i[0]+=l[1][0],i[1]+=l[1][1])}return o.style[n.transformProp]=b.translate(i),e.pieceKey&&(o["data-key"]=t),{tag:x,attrs:o}}function i(e,t,n){var r={key:"s"+e,"class":t,style:{}};return r.style[n.transformProp]=b.translate(a(b.key2pos(e),n)),{tag:P,attrs:r}}function a(e,t){return[(t.asWhite?e[0]-1:8-e[0])*t.bounds.width/8,(t.asWhite?8-e[1]:e[1]-1)*t.bounds.height/8]}function s(e,t,n){if(t){var o={key:"g"+e,style:{},"class":r(t)+" ghost"};return o.style[n.transformProp]=b.translate(a(b.key2pos(e),n)),{tag:x,attrs:o}}}function l(e,t){var n={key:"f"+e.piece.key,"class":"fading "+r(e.piece),style:{opacity:e.opacity}};return n.style[t.transformProp]=b.translate(a(e.piece.pos,t)),{tag:x,attrs:n}}function u(e,t,n){e[t]?e[t].push(n):e[t]=[n]}function c(e,t){var n=e.data,r={};if(n.lastMove&&n.highlight.lastMove&&n.lastMove.forEach(function(e){u(r,e,"last-move")}),n.check&&n.highlight.check&&u(r,n.check,"check"),n.selected){u(r,n.selected,"selected");var o=n.draggable.current.over,a=n.movable.dests[n.selected];a&&a.forEach(function(e){e===o?u(r,e,"move-dest drag-over"):n.movable.showDests&&u(r,e,"move-dest"+(n.pieces[e]?" oc":""))});var s=n.premovable.dests;s&&s.forEach(function(e){e===o?u(r,e,"premove-dest drag-over"):n.movable.showDests&&u(r,e,"premove-dest"+(n.pieces[e]?" oc":""))})}var l=n.premovable.current;l?l.forEach(function(e){u(r,e,"current-premove")}):n.predroppable.current.key&&u(r,n.predroppable.current.key,"current-premove"),e.vm.exploding&&e.vm.exploding.keys.forEach(function(t){u(r,t,"exploding"+e.vm.exploding.stage)});var c=[];if(n.items)for(var d=0;64>d;d++){var f=b.allKeys[d],p=r[f],v=n.items.render(b.key2pos(f),f);if(p||v){var h=i(f,p?p.join(" ")+(v?" has-item":""):"has-item",t);v&&(h.children=[v]),c.push(h)}}else for(var f in r)c.push(i(f,r[f].join(" "),t));return c}function d(e){var t=e.data;if(t.bounds){var n={asWhite:"white"===t.orientation,bounds:t.bounds(),transformProp:b.transformProp()},r=c(e,n);t.animation.current.fadings&&t.animation.current.fadings.forEach(function(e){r.push(l(e,n))});var i=n.asWhite?b.allKeys:b.invKeys;if(t.items)for(var a=0;64>a;a++)t.pieces[i[a]]&&!t.items.render(b.key2pos(i[a]),i[a])&&r.push(o(t,i[a],n));else for(var a=0;64>a;a++)t.pieces[i[a]]&&r.push(o(t,i[a],n));if(t.draggable.showGhost){var u=t.draggable.current.orig;u&&!t.draggable.current.newPiece&&r.push(s(u,t.pieces[u],n))}return t.drawable.enabled&&r.push(y(e)),r}}function f(e){return function(t){b.isRightButton(t)&&e.draggable.current.orig?(e.draggable.current.newPiece&&delete e.pieces[e.draggable.current.orig],e.draggable.current={},e.selected=null):(t.shiftKey||b.isRightButton(t))&&e.drawable.enabled?g.start(e,t):m.start(e,t)}}function p(e,t,n){return function(r){(r.shiftKey||b.isRightButton(r))&&e.drawable.enabled?n(e,r):e.viewOnly||t(e,r)}}function v(e,t,n){var r=e.data,o=f(r),i=p(r,m.move,g.move),a=p(r,m.end,g.end),s=["touchstart","mousedown"],l=["touchmove","mousemove"],u=["touchend","mouseup"];s.forEach(function(e){t.addEventListener(e,o)}),l.forEach(function(e){document.addEventListener(e,i)}),u.forEach(function(e){document.addEventListener(e,a)}),n.onunload=function(){s.forEach(function(e){t.removeEventListener(e,o)}),l.forEach(function(e){document.removeEventListener(e,i)}),u.forEach(function(e){document.removeEventListener(e,a)})}}function h(e){var t=e.data;return{tag:"div",attrs:{"class":"cg-board orientation-"+t.orientation,config:function(n,r,o){r||((!t.viewOnly||t.drawable.enabled)&&v(e,n,o),t.render=function(){k.render(n,d(e))},t.renderRAF=function(){b.requestAnimationFrame(t.render)},t.bounds=b.memo(n.getBoundingClientRect.bind(n)),t.element=n,t.render())}},children:[]}}var m=e("./drag"),g=e("./draw"),b=e("./util"),y=e("./svg"),w=e("./coords"),k=e("mithril"),x="piece",P="square";t.exports=function(e){var t=e.data;return{tag:"div",attrs:{config:function(e,n){return n?void(t.redrawCoords&&t.redrawCoords(t.orientation)):(t.coordinates&&(t.redrawCoords=w(t.orientation,e)),e.addEventListener("contextmenu",function(e){return t.disableContextMenu||t.drawable.enabled?(e.preventDefault(),!1):void 0}),t.resizable&&document.body.addEventListener("chessground.resize",function(e){t.bounds.clear(),t.render()},!1),void["onscroll","onresize"].forEach(function(e){var n=window[e];window[e]=function(){n&&n(),t.bounds.clear()}}))},"class":["cg-board-wrap",t.viewOnly?"view-only":"manipulable"].join(" ")},children:[h(e)]}}},{"./coords":30,"./drag":33,"./draw":34,"./svg":38,"./util":39,mithril:9}]},{},[1])(1)});