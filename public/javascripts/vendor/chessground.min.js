!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.Chessground=e()}}(function(){var e;return function t(e,n,r){function o(i,s){if(!n[i]){if(!e[i]){var u="function"==typeof require&&require;if(!s&&u)return u(i,!0);if(a)return a(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[i]={exports:{}};e[i][0].call(l.exports,function(t){var n=e[i][1][t];return o(n?n:t)},l,l.exports,t,e,n,r)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,t){function n(e,t){var n=new o(t);return r.render(e,a(n)),i(n)}var r=e("mithril"),o=e("./ctrl"),a=e("./view"),i=e("./api");t.exports=n,t.exports.controller=o,t.exports.view=a,t.exports.fen=e("./fen"),t.exports.util=e("./util"),t.exports.configure=e("./configure"),t.exports.anim=e("./anim"),t.exports.board=e("./board"),t.exports.drag=e("./drag")},{"./anim":33,"./api":34,"./board":35,"./configure":36,"./ctrl":37,"./drag":39,"./fen":40,"./util":43,"./view":44,mithril:32}],2:[function(e,t){function n(e,t,n){e=+e||0,n="number"==typeof n?n:+n||1,null==t&&(t=e,e=0);for(var a=-1,i=o(0,r((t-e)/(n||1))),s=Array(i);++a<i;)s[a]=e,e+=n;return s}var r=Math.ceil,o=Math.max;t.exports=n},{}],3:[function(e,t){function n(e,t,n){var a=-1,i=e?e.length:0;if(t=t&&"undefined"==typeof n?t:r(t,n,3),"number"==typeof i)for(;++a<i&&t(e[a],a,e)!==!1;);else o(e,t);return e}var r=e("../internals/baseCreateCallback"),o=e("../objects/forOwn");t.exports=n},{"../internals/baseCreateCallback":8,"../objects/forOwn":22}],4:[function(e,t){function n(e,t){return arguments.length>2?r(e,17,o(arguments,2),null,t):r(e,1,null,null,t)}var r=e("../internals/createWrapper"),o=e("../internals/slice");t.exports=n},{"../internals/createWrapper":11,"../internals/slice":20}],5:[function(e,t){var n=[];t.exports=n},{}],6:[function(e,t){function n(e){function t(){if(s){var e=i(s);u.apply(e,arguments)}if(this instanceof t){var a=r(n.prototype),l=n.apply(a,e||arguments);return o(l)?l:a}return n.apply(c,e||arguments)}var n=e[0],s=e[2],c=e[4];return a(t,e),t}var r=e("./baseCreate"),o=e("../objects/isObject"),a=e("./setBindData"),i=e("./slice"),s=[],u=s.push;t.exports=n},{"../objects/isObject":25,"./baseCreate":7,"./setBindData":17,"./slice":20}],7:[function(e,t){(function(n){function r(e){return a(e)?i(e):{}}var o=e("./isNative"),a=e("../objects/isObject"),i=(e("../utilities/noop"),o(i=Object.create)&&i);i||(r=function(){function e(){}return function(t){if(a(t)){e.prototype=t;var r=new e;e.prototype=null}return r||n.Object()}}()),t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../objects/isObject":25,"../utilities/noop":31,"./isNative":13}],8:[function(e,t){function n(e,t,n){if("function"!=typeof e)return o;if("undefined"==typeof t||!("prototype"in e))return e;var l=e.__bindData__;if("undefined"==typeof l&&(i.funcNames&&(l=!e.name),l=l||!i.funcDecomp,!l)){var f=c.call(e);i.funcNames||(l=!s.test(f)),l||(l=u.test(f),a(e,l))}if(l===!1||l!==!0&&1&l[1])return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)};case 4:return function(n,r,o,a){return e.call(t,n,r,o,a)}}return r(e,t)}var r=e("../functions/bind"),o=e("../utilities/identity"),a=e("./setBindData"),i=e("../support"),s=/^\s*function[ \n\r\t]+\w/,u=/\bthis\b/,c=Function.prototype.toString;t.exports=n},{"../functions/bind":4,"../support":29,"../utilities/identity":30,"./setBindData":17}],9:[function(e,t){function n(e){function t(){var e=h?d:this;if(l){var a=i(l);u.apply(a,arguments)}if((f||m)&&(a||(a=i(arguments)),f&&u.apply(a,f),m&&a.length<p))return c|=16,n([s,g?c:-4&c,a,null,d,p]);if(a||(a=arguments),v&&(s=e[b]),this instanceof t){e=r(s.prototype);var y=s.apply(e,a);return o(y)?y:e}return s.apply(e,a)}var s=e[0],c=e[1],l=e[2],f=e[3],d=e[4],p=e[5],h=1&c,v=2&c,m=4&c,g=8&c,b=s;return a(t,e),t}var r=e("./baseCreate"),o=e("../objects/isObject"),a=e("./setBindData"),i=e("./slice"),s=[],u=s.push;t.exports=n},{"../objects/isObject":25,"./baseCreate":7,"./setBindData":17,"./slice":20}],10:[function(e,t){function n(e,t,s,u,c){(a(t)?r:o)(t,function(t,r){var o,l,f=t,d=e[r];if(t&&((l=a(t))||i(t))){for(var p=u.length;p--;)if(o=u[p]==t){d=c[p];break}if(!o){var h;s&&(f=s(d,t),(h="undefined"!=typeof f)&&(d=f)),h||(d=l?a(d)?d:[]:i(d)?d:{}),u.push(t),c.push(d),h||n(d,t,s,u,c)}}else s&&(f=s(d,t),"undefined"==typeof f&&(f=t)),"undefined"!=typeof f&&(d=f);e[r]=d})}var r=e("../collections/forEach"),o=e("../objects/forOwn"),a=e("../objects/isArray"),i=e("../objects/isPlainObject");t.exports=n},{"../collections/forEach":3,"../objects/forOwn":22,"../objects/isArray":23,"../objects/isPlainObject":26}],11:[function(e,t){function n(e,t,s,l,f,d){var p=1&t,h=2&t,v=4&t,m=16&t,g=32&t;if(!h&&!a(e))throw new TypeError;m&&!s.length&&(t&=-17,m=s=!1),g&&!l.length&&(t&=-33,g=l=!1);var b=e&&e.__bindData__;if(b&&b!==!0)return b=i(b),b[2]&&(b[2]=i(b[2])),b[3]&&(b[3]=i(b[3])),!p||1&b[1]||(b[4]=f),!p&&1&b[1]&&(t|=8),!v||4&b[1]||(b[5]=d),m&&u.apply(b[2]||(b[2]=[]),s),g&&c.apply(b[3]||(b[3]=[]),l),b[1]|=t,n.apply(null,b);var y=1==t||17===t?r:o;return y([e,t,s,l,f,d])}var r=e("./baseBind"),o=e("./baseCreateWrapper"),a=e("../objects/isFunction"),i=e("./slice"),s=[],u=s.push,c=s.unshift;t.exports=n},{"../objects/isFunction":24,"./baseBind":6,"./baseCreateWrapper":9,"./slice":20}],12:[function(e,t){function n(){return r.pop()||[]}var r=e("./arrayPool");t.exports=n},{"./arrayPool":5}],13:[function(e,t){function n(e){return"function"==typeof e&&a.test(e)}var r=Object.prototype,o=r.toString,a=RegExp("^"+String(o).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");t.exports=n},{}],14:[function(e,t){var n=40;t.exports=n},{}],15:[function(e,t){var n={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1};t.exports=n},{}],16:[function(e,t){function n(e){e.length=0,r.length<o&&r.push(e)}var r=e("./arrayPool"),o=e("./maxPoolSize");t.exports=n},{"./arrayPool":5,"./maxPoolSize":14}],17:[function(e,t){var n=e("./isNative"),r=e("../utilities/noop"),o={configurable:!1,enumerable:!1,value:null,writable:!1},a=function(){try{var e={},t=n(t=Object.defineProperty)&&t,r=t(e,e,e)&&t}catch(o){}return r}(),i=a?function(e,t){o.value=t,a(e,"__bindData__",o)}:r;t.exports=i},{"../utilities/noop":31,"./isNative":13}],18:[function(e,t){function n(e){var t,n;return e&&s.call(e)==a&&(t=e.constructor,!o(t)||t instanceof t)?(r(e,function(e,t){n=t}),"undefined"==typeof n||u.call(e,n)):!1}var r=e("../objects/forIn"),o=e("../objects/isFunction"),a="[object Object]",i=Object.prototype,s=i.toString,u=i.hasOwnProperty;t.exports=n},{"../objects/forIn":21,"../objects/isFunction":24}],19:[function(e,t){var n=e("./objectTypes"),r=Object.prototype,o=r.hasOwnProperty,a=function(e){var t,r=e,a=[];if(!r)return a;if(!n[typeof e])return a;for(t in r)o.call(r,t)&&a.push(t);return a};t.exports=a},{"./objectTypes":15}],20:[function(e,t){function n(e,t,n){t||(t=0),"undefined"==typeof n&&(n=e?e.length:0);for(var r=-1,o=n-t||0,a=Array(0>o?0:o);++r<o;)a[r]=e[t+r];return a}t.exports=n},{}],21:[function(e,t){var n=e("../internals/baseCreateCallback"),r=e("../internals/objectTypes"),o=function(e,t,o){var a,i=e,s=i;if(!i)return s;if(!r[typeof i])return s;t=t&&"undefined"==typeof o?t:n(t,o,3);for(a in i)if(t(i[a],a,e)===!1)return s;return s};t.exports=o},{"../internals/baseCreateCallback":8,"../internals/objectTypes":15}],22:[function(e,t){var n=e("../internals/baseCreateCallback"),r=e("./keys"),o=e("../internals/objectTypes"),a=function(e,t,a){var i,s=e,u=s;if(!s)return u;if(!o[typeof s])return u;t=t&&"undefined"==typeof a?t:n(t,a,3);for(var c=-1,l=o[typeof s]&&r(s),f=l?l.length:0;++c<f;)if(i=l[c],t(s[i],i,e)===!1)return u;return u};t.exports=a},{"../internals/baseCreateCallback":8,"../internals/objectTypes":15,"./keys":27}],23:[function(e,t){var n=e("../internals/isNative"),r="[object Array]",o=Object.prototype,a=o.toString,i=n(i=Array.isArray)&&i,s=i||function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&a.call(e)==r||!1};t.exports=s},{"../internals/isNative":13}],24:[function(e,t){function n(e){return"function"==typeof e}t.exports=n},{}],25:[function(e,t){function n(e){return!(!e||!r[typeof e])}var r=e("../internals/objectTypes");t.exports=n},{"../internals/objectTypes":15}],26:[function(e,t){var n=e("../internals/isNative"),r=e("../internals/shimIsPlainObject"),o="[object Object]",a=Object.prototype,i=a.toString,s=n(s=Object.getPrototypeOf)&&s,u=s?function(e){if(!e||i.call(e)!=o)return!1;var t=e.valueOf,a=n(t)&&(a=s(t))&&s(a);return a?e==a||s(e)==a:r(e)}:r;t.exports=u},{"../internals/isNative":13,"../internals/shimIsPlainObject":18}],27:[function(e,t){var n=e("../internals/isNative"),r=e("./isObject"),o=e("../internals/shimKeys"),a=n(a=Object.keys)&&a,i=a?function(e){return r(e)?a(e):[]}:o;t.exports=i},{"../internals/isNative":13,"../internals/shimKeys":19,"./isObject":25}],28:[function(e,t){function n(e){var t=arguments,n=2;if(!i(e))return e;if("number"!=typeof t[2]&&(n=t.length),n>3&&"function"==typeof t[n-2])var c=r(t[--n-1],t[n--],2);else n>2&&"function"==typeof t[n-1]&&(c=t[--n]);for(var l=u(arguments,1,n),f=-1,d=a(),p=a();++f<n;)o(e,l[f],c,d,p);return s(d),s(p),e}var r=e("../internals/baseCreateCallback"),o=e("../internals/baseMerge"),a=e("../internals/getArray"),i=e("./isObject"),s=e("../internals/releaseArray"),u=e("../internals/slice");t.exports=n},{"../internals/baseCreateCallback":8,"../internals/baseMerge":10,"../internals/getArray":12,"../internals/releaseArray":16,"../internals/slice":20,"./isObject":25}],29:[function(e,t){(function(n){var r=e("./internals/isNative"),o=/\bthis\b/,a={};a.funcDecomp=!r(n.WinRTError)&&o.test(function(){return this}),a.funcNames="string"==typeof Function.name,t.exports=a}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./internals/isNative":13}],30:[function(e,t){function n(e){return e}t.exports=n},{}],31:[function(e,t){function n(){}t.exports=n},{}],32:[function(t,n){Mithril=m=new function r(e,t){function n(e){return{}.toString.call(e)}function o(e){return n(e)==q}function a(e){return n(e)==R}function i(e){return"function"==typeof e}function s(e){return n(e)==B}function u(){for(var e,t=Array.prototype.slice,r=t.call(arguments,0),i=(!(null==r[1]||!o(r[1])||"tag"in r[1]||"subtree"in r[1])),s=i?r[1]:{},u=("class"in s?"class":"className"),c={tag:"div",attrs:{}},l=[];e=L.exec(r[0]);)if(""==e[1])c.tag=e[2];else if("#"==e[1])c.attrs.id=e[2];else if("."==e[1])l.push(e[2]);else if("["==e[3][0]){var f=F.exec(e[3]);c.attrs[f[1]]=f[3]||(f[2]?"":!0)}l.length>0&&(c.attrs[u]=l.join(" "));var d=i?r[2]:r[1];c.children=a(d)||"[object Arguments]"==n(d)?t.call(d,0):r.slice(i?2:1);for(var p in s)c.attrs[p]=p==u?(c.attrs[p]||"")+" "+s[p]:s[p];return c}function c(r,o,u,d,v,m,g,b,y,w,x){if(null==v&&(v=""),"retain"===v.subtree)return m;var j=n(m),k=n(v);if(null==m||j!=k){if(null!=m)if(u&&u.nodes){var O=b-d,C=O+(k==R?v:m.nodes).length;f(u.nodes.slice(O,C),u.slice(O,C))}else m.nodes&&f(m.nodes,m);m=new v.constructor,m.tag&&(m={}),m.nodes=[]}if(k==R){v=h(v);for(var E=[],N=m.length===v.length,P=0,T=1,A=2,M=3,D={},S=[],B=!1,L=0;L<m.length;L++)m[L]&&m[L].attrs&&null!=m[L].attrs.key&&(B=!0,D[m[L].attrs.key]={action:T,index:L});if(B){for(var L=0;L<v.length;L++)if(v[L]&&v[L].attrs)if(null!=v[L].attrs.key){var F=v[L].attrs.key;D[F]=D[F]?{action:M,index:L,from:D[F].index,element:r.childNodes[D[F].index]||e.document.createElement("div")}:{action:A,index:L}}else S.push({index:L,element:r.childNodes[L]||e.document.createElement("div")});for(var K,_=Object.keys(D).map(function(e){return D[e]}),z=_.sort(function(e,t){return e.action-t.action||e.index-t.index}),X=m.slice(),L=0;K=z[L];L++){if(K.action==T&&(f(m[K.index].nodes,m[K.index]),X.splice(K.index,1)),K.action==A){var U=e.document.createElement("div");U.key=v[K.index].attrs.key,r.insertBefore(U,r.childNodes[K.index]),X.splice(K.index,0,{attrs:{key:v[K.index].attrs.key},nodes:[U]})}K.action==M&&(r.childNodes[K.index]!==K.element&&null!==K.element&&r.insertBefore(K.element,r.childNodes[K.index]),X[K.index]=m[K.from])}for(var L=0;L<S.length;L++){var K=S[L];r.insertBefore(K.element,r.childNodes[K.index]),X[K.index]=m[K.index]}m=X,m.nodes=[];for(var H,L=0;H=r.childNodes[L];L++)m.nodes.push(H)}for(var L=0,$=0;L<v.length;L++){var G=c(r,o,m,b,v[L],m[$],g,b+P||P,y,w,x);G!==t&&(G.nodes.intact||(N=!1),P+=a(G)?G.length:1,m[$++]=G)}if(!N){for(var L=0;L<v.length;L++)null!=m[L]&&(E=E.concat(m[L].nodes));for(var J,L=0;J=m.nodes[L];L++)null!=J.parentNode&&E.indexOf(J)<0&&f([J],[m[L]]);for(var J,L=m.nodes.length;J=E[L];L++)null==J.parentNode&&r.appendChild(J);v.length<m.length&&(m.length=v.length),m.nodes=E}}else if(null!=v&&k==q){if((v.tag!=m.tag||Object.keys(v.attrs).join()!=Object.keys(m.attrs).join()||v.attrs.id!=m.attrs.id)&&(f(m.nodes),m.configContext&&i(m.configContext.onunload)&&m.configContext.onunload()),!s(v.tag))return;var J,W=0===m.nodes.length;if(v.attrs.xmlns?w=v.attrs.xmlns:"svg"===v.tag?w="http://www.w3.org/2000/svg":"math"===v.tag&&(w="http://www.w3.org/1998/Math/MathML"),W?(J=w===t?e.document.createElement(v.tag):e.document.createElementNS(w,v.tag),m={tag:v.tag,children:c(J,v.tag,t,t,v.children,m.children,!0,0,v.attrs.contenteditable?J:y,w,x),attrs:l(J,v.tag,v.attrs,{},w),nodes:[J]},r.insertBefore(J,r.childNodes[b]||null)):(J=m.nodes[0],l(J,v.tag,v.attrs,m.attrs,w),m.children=c(J,v.tag,t,t,v.children,m.children,!1,0,v.attrs.contenteditable?J:y,w,x),m.nodes.intact=!0,g===!0&&null!=J&&r.insertBefore(J,r.childNodes[b]||null)),i(v.attrs.config)){var Q=m.configContext=m.configContext||{},Y=function(e,t){return function(){return e.attrs.config.apply(e,t)}};x.push(Y(v,[J,!W,Q,m]))}}else if(!i(k)){var E;0===m.nodes.length?(v.$trusted?E=p(r,b,v):(E=[e.document.createTextNode(v)],r.nodeName.match(I)||r.insertBefore(E[0],r.childNodes[b]||null)),m="string number boolean".indexOf(typeof v)>-1?new v.constructor(v):v,m.nodes=E):m.valueOf()!==v.valueOf()||g===!0?(E=m.nodes,y&&y===e.document.activeElement||(v.$trusted?(f(E,m),E=p(r,b,v)):"textarea"===o?r.value=v:y?y.innerHTML=v:((1==E[0].nodeType||E.length>1)&&(f(m.nodes,m),E=[e.document.createTextNode(v)]),r.insertBefore(E[0],r.childNodes[b]||null),E[0].nodeValue=v)),m=new v.constructor(v),m.nodes=E):m.nodes.intact=!0}return m}function l(t,n,r,a,s){for(var u in r){var c=r[u],l=a[u];if(!(u in a)||l!==c){a[u]=c;try{if("config"===u)continue;if(i(c)&&0==u.indexOf("on"))t[u]=v(c,t);else if("style"===u&&o(c)){for(var f in c)(null==l||l[f]!==c[f])&&(t.style[f]=c[f]);for(var f in l)f in c||(t.style[f]="")}else null!=s?"href"===u?t.setAttributeNS("http://www.w3.org/1999/xlink","href",c):"className"===u?t.setAttribute("class",c):t.setAttribute(u,c):u in t&&"list"!=u&&"style"!=u&&"form"!=u?(t!==e.document.activeElement||"value"!=u)&&(t[u]=c):t.setAttribute(u,c)}catch(d){if(d.message.indexOf("Invalid argument")<0)throw d}}}return a}function f(e,t){for(var n=e.length-1;n>-1;n--)e[n]&&e[n].parentNode&&(e[n].parentNode.removeChild(e[n]),t=[].concat(t),t[n]&&d(t[n]));0!=e.length&&(e.length=0)}function d(e){if(e.configContext&&i(e.configContext.onunload)&&e.configContext.onunload(),e.children)if(a(e.children))for(var t=0;t<e.children.length;t++)d(e.children[t]);else e.children.tag&&d(e.children)}function p(t,n,r){var o=t.childNodes[n];if(o){var a=1!=o.nodeType,i=e.document.createElement("span");a?(t.insertBefore(i,o),i.insertAdjacentHTML("beforebegin",r),t.removeChild(i)):o.insertAdjacentHTML("beforebegin",r)}else t.insertAdjacentHTML("beforeend",r);for(var s=[];t.childNodes[n]!==o;)s.push(t.childNodes[n]),n++;return s}function h(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];a(r)?t.push.apply(t,h(r)):t.push(r)}return t}function v(e,t){return function(n){n=n||event,u.redraw.strategy("diff"),u.startComputation();try{return e.call(t,n)}finally{$||($=-1),u.endComputation()}}}function m(e){var t=_.indexOf(e);return 0>t?_.push(e)-1:t}function g(e){var t=function(){return arguments.length&&(e=arguments[0]),e};return t.toJSON=function(){return e},t}function b(){for(var e=u.redraw.strategy(),t=0;t<X.length;t++)H[t]&&"none"!=e&&u.render(X[t],U[t].view(H[t]),"all"==e);J&&(J(),J=null),$=null,G=new Date,u.redraw.strategy("diff")}function y(e){return e.slice(V[u.route.mode].length)}function w(e,t,n){et={};var r=n.indexOf("?");-1!==r&&(et=O(n.substr(r+1,n.length)),n=n.substr(0,r));for(var o in t){if(o==n)return u.module(e,t[o]),!0;var a=new RegExp("^"+o.replace(/:[^\/]+?\.{3}/g,"(.*?)").replace(/:[^\/]+/g,"([^\\/]+)")+"/?$");if(a.test(n))return n.replace(a,function(){for(var n=o.match(/:[^\/]+/g)||[],r=[].slice.call(arguments,1,-2),a=0;a<n.length;a++)et[n[a].replace(/:|\./g,"")]=decodeURIComponent(r[a]);u.module(e,t[o])}),!0}}function x(e){if(e=e||event,!e.ctrlKey&&!e.metaKey&&2!=e.which){e.preventDefault?e.preventDefault():e.returnValue=!1;var t=e.currentTarget||this;u.route(t[u.route.mode].slice(V[u.route.mode].length))}}function j(){"hash"!=u.route.mode&&e.location.hash?e.location.hash=e.location.hash:e.scrollTo(0,0)}function k(e,t){var n=[];for(var r in e){var a=t?t+"["+r+"]":r,i=e[r];n.push(o(i)?k(i,a):encodeURIComponent(a)+"="+encodeURIComponent(i))}return n.join("&")}function O(e){for(var t=e.split("&"),n={},r=0;r<t.length;r++){var o=t[r].split("=");n[C(o[0])]=o[1]?C(o[1]):1===o.length?!0:""}return n}function C(e){return decodeURIComponent(e.replace(/\+/g," "))}function E(e){var n=m(e);f(e.childNodes,z[n]),z[n]=t}function N(e){return prop=u.prop(),e.then(prop),prop.then=function(t,n){return N(e.then(t,n))},prop}function P(e,t){function n(e){p=e||f,v.map(function(e){p==l&&e.resolve(h)||e.reject(h)})}function r(e,t,n,r){if((o(h)||i(h))&&i(e))try{var a=0;e.call(h,function(e){a++||(h=e,t())},function(e){a++||(h=e,n())})}catch(s){u.deferred.onerror(s),h=s,n()}else r()}function a(){var o;try{o=h&&h.then}catch(f){return u.deferred.onerror(f),h=f,p=c,a()}r(o,function(){p=s,a()},function(){p=c,a()},function(){try{p==s&&i(e)?h=e(h):p==c&&i(t)&&(h=t(h),p=s)}catch(a){return u.deferred.onerror(a),h=a,n()}h==d?(h=TypeError(),n()):r(o,function(){n(l)},n,function(){n(p==s&&l)})})}var s=1,c=2,l=3,f=4,d=this,p=0,h=0,v=[];d.promise={},d.resolve=function(e){return p||(h=e,p=s,a()),this},d.reject=function(e){return p||(h=e,p=c,a()),this},d.promise.then=function(e,t){var n=new P(e,t);return p==l?n.resolve(h):p==f?n.reject(h):v.push(n),n.promise}}function T(e){return e}function A(t){if(!t.dataType||"jsonp"!==t.dataType.toLowerCase()){var n=new e.XMLHttpRequest;if(n.open(t.method,t.url,!0,t.user,t.password),n.onreadystatechange=function(){4===n.readyState&&(n.status>=200&&n.status<300?t.onload({type:"load",target:n}):t.onerror({type:"error",target:n}))},t.serialize==JSON.stringify&&t.data&&"GET"!=t.method&&n.setRequestHeader("Content-Type","application/json; charset=utf-8"),t.deserialize==JSON.parse&&n.setRequestHeader("Accept","application/json, text/*"),i(t.config)){var r=t.config(n,t);null!=r&&(n=r)}return n.send("GET"!=t.method&&t.data?t.data:""),n}var o="mithril_callback_"+(new Date).getTime()+"_"+Math.round(1e16*Math.random()).toString(36),a=e.document.createElement("script");e[o]=function(n){delete e[o],e.document.body.removeChild(a),t.onload({type:"load",target:{responseText:n}})},a.onerror=function(){return delete e[o],e.document.body.removeChild(a),t.onerror({type:"error",target:{status:500,responseText:JSON.stringify({error:"Error making jsonp request"})}}),!1},a.onload=function(){return!1},a.src=t.url+(t.url.indexOf("?")>0?"&":"?")+(t.callbackKey?t.callbackKey:"callback")+"="+o+"&"+k(t.data||{}),e.document.body.appendChild(a)}function M(e,t,n){return t&&Object.keys(t).length>0&&("GET"==e.method?e.url=e.url+(e.url.indexOf("?")<0?"?":"&")+k(t):e.data=n(t)),e}function D(e,t){var n=e.match(/:[a-z]\w+/gi);if(n&&t)for(var r=0;r<n.length;r++){var o=n[r].slice(1);e=e.replace(n[r],t[o]),delete t[o]}return e}var S,q="[object Object]",R="[object Array]",B="[object String]",L=/(?:(^|#|\.)([^#\.\[\]]+))|(\[.+?\])/g,F=/\[(.+?)(?:=("|'|)(.*?)\2)?\]/,I=/AREA|BASE|BR|COL|COMMAND|EMBED|HR|IMG|INPUT|KEYGEN|LINK|META|PARAM|SOURCE|TR‌​ACK|WBR/,K={appendChild:function(n){S===t&&(S=e.document.createElement("html")),e.document.documentElement&&e.document.documentElement!==n?e.document.replaceChild(n,e.document.documentElement):e.document.appendChild(n),this.childNodes=e.document.childNodes},insertBefore:function(e){this.appendChild(e)},childNodes:[]},_=[],z={};u.render=function(n,r,o){var a=[];if(!n)throw new Error("Please ensure the DOM element exists before rendering a template into it.");var i=m(n),s=n==e.document,u=s||n==e.document.documentElement?K:n;s&&"html"!=r.tag&&(r={tag:"html",attrs:{},children:r}),z[i]===t&&f(u.childNodes),o===!0&&E(n),z[i]=c(u,null,t,t,r,z[i],!1,0,null,t,a);for(var l=0;l<a.length;l++)a[l]()},u.trust=function(e){return e=new String(e),e.$trusted=!0,e},u.prop=function(e){return(o(e)||i(e))&&null!==e&&i(e.then)?N(e):g(e)};var X=[],U=[],H=[],$=null,G=0,J=null,W=16;u.module=function(e,t){var n=X.indexOf(e);0>n&&(n=X.length);var r=!1;if(H[n]&&i(H[n].onunload)){var o={preventDefault:function(){r=!0}};H[n].onunload(o)}return r?void 0:(u.redraw.strategy("all"),u.startComputation(),X[n]=e,U[n]=t,H[n]=new t.controller,u.endComputation(),H[n])},u.redraw=function(t){var n=e.cancelAnimationFrame||e.clearTimeout,r=e.requestAnimationFrame||e.setTimeout;$&&t!==!0?(new Date-G>W||r==e.requestAnimationFrame)&&($>0&&n($),$=r(b,W)):(b(),$=r(function(){$=null},W))},u.redraw.strategy=u.prop();var Q=0;u.startComputation=function(){Q++},u.endComputation=function(){Q=Math.max(Q-1,0),0==Q&&u.redraw()},u.withAttr=function(e,t){return function(n){n=n||event;var r=n.currentTarget||this;t(e in r?r[e]:r.getAttribute(e))}};var Y,V={pathname:"",hash:"#",search:"?"},Z=function(){},et={};return u.route=function(){if(0===arguments.length)return Y;if(3===arguments.length&&s(arguments[1])){var t=arguments[0],n=arguments[1],r=arguments[2];Z=function(e){var o=Y=y(e);w(t,r,o)||u.route(n,!0)};var a="hash"==u.route.mode?"onhashchange":"onpopstate";e[a]=function(){Y!=y(e.location[u.route.mode])&&Z(e.location[u.route.mode])},J=j,e[a]()}else if(arguments[0].addEventListener){var i=arguments[0],c=arguments[1],l=arguments[2];c||(l.href=i.getAttribute("href"),i.href=e.location.pathname+V[u.route.mode]+l.href,i.removeEventListener("click",x),i.addEventListener("click",x))}else if(s(arguments[0])){Y=arguments[0];var f=o(arguments[1])?k(arguments[1]):null;f&&(Y+=(-1===Y.indexOf("?")?"?":"&")+f);var d=(3==arguments.length?arguments[2]:arguments[1])===!0;e.history.pushState?(J=function(){e.history[d?"replaceState":"pushState"](null,e.document.title,V[u.route.mode]+Y),j()},Z(V[u.route.mode]+Y)):e.location[u.route.mode]=Y}},u.route.param=function(e){return et[e]},u.route.mode="search",u.deferred=function(){var e=new P;return e.promise=N(e.promise),e},u.deferred.onerror=function(e){if("[object Error]"==n(e)&&!e.constructor.toString().match(/ Error/))throw e},u.sync=function(e){function t(e,t){return function(i){return a[e]=i,t||(n="reject"),0==--o&&(r.promise(a),r[n](a)),i}}var n="resolve",r=u.deferred(),o=e.length,a=new Array(o);if(e.length>0)for(var i=0;i<e.length;i++)e[i].then(t(i,!0),t(i,!1));else r.resolve();return r.promise},u.request=function(e){e.background!==!0&&u.startComputation();var t=u.deferred(),n=e.dataType&&"jsonp"===e.dataType.toLowerCase(),r=e.serialize=n?T:e.serialize||JSON.stringify,o=e.deserialize=n?T:e.deserialize||JSON.parse,i=e.extract||function(e){return 0===e.responseText.length&&o===JSON.parse?null:e.responseText};return e.url=D(e.url,e.data),e=M(e,e.data,r),e.onload=e.onerror=function(n){try{n=n||event;var r=("load"==n.type?e.unwrapSuccess:e.unwrapError)||T,s=r(o(i(n.target,e)));if("load"==n.type)if(a(s)&&e.type)for(var c=0;c<s.length;c++)s[c]=new e.type(s[c]);else e.type&&(s=new e.type(s));t["load"==n.type?"resolve":"reject"](s)}catch(n){u.deferred.onerror(n),t.reject(n)}e.background!==!0&&u.endComputation()},A(e),t.promise},u.deps=function(t){return e=t},u.deps.factory=r,u}("undefined"!=typeof window?window:{}),"undefined"!=typeof n&&null!==n&&(n.exports=m),"function"==typeof e&&e.amd&&e(function(){return m})},{}],33:[function(e,t){function n(e,t,n){var r=n?u.invertKey(e):e;return{key:r,pos:u.key2pos(r),role:t.role,color:t.color}}function r(e,t){return e.role===t.role&&e.color===t.color}function o(e,t){return t.sort(function(t,n){return u.distance(e.pos,t.pos)-u.distance(e.pos,n.pos)})[0]}function a(e,t){var a=t.bounds(),i=a.width/8,s=a.height/8,c={},l=[],f=[],d=[],p=[],h=e.orientation!==t.orientation,v={},m="white"===t.orientation;for(var g in e.pieces){var b=n(g,e.pieces[g],h);v[b.key]=b}return u.allKeys.forEach(function(e){if(e!==t.movable.dropped[1]){var o=t.pieces[e],a=v[e];o?a?r(o,a)||(d.push(a),p.push(n(e,o,!1))):p.push(n(e,o,!1)):a&&d.push(a)}}),p.forEach(function(e){var t=o(e,d.filter(u.partial(r,e)));if(t){var n=m?t.pos:e.pos,a=m?e.pos:t.pos,f=[(n[0]-a[0])*i,(a[1]-n[1])*s];c[e.key]=[f,f],l.push(t.key)}}),d.forEach(function(e){e.key===t.movable.dropped[0]||u.containsX(l,e.key)||f.push({piece:{role:e.role,color:e.color},left:12.5*(m?e.pos[0]-1:8-e.pos[0])+"%",bottom:12.5*(m?e.pos[1]-1:8-e.pos[1])+"%",opacity:1})}),{anims:c,fadings:f}}function i(e){if(e.animation.current.start){var t=1-((new Date).getTime()-e.animation.current.start)/e.animation.current.duration;if(0>=t)e.animation.current={},e.render();else{var n=c.easeInOutCubic(t);for(var r in e.animation.current.anims){var o=e.animation.current.anims[r];o[1]=[o[0][0]*n,o[0][1]*n]}for(var a in e.animation.current.fadings)e.animation.current.fadings[a].opacity=c.easeOutQuad(t);e.render(),requestAnimationFrame(function(){i(e)})}}}function s(e,t){var n={orientation:t.orientation,pieces:{}};for(var r in t.pieces)n.pieces[r]={role:t.pieces[r].role,color:t.pieces[r].color};var o=e(),s=a(n,t);if(Object.keys(s.anims).length>0||s.fadings.length>0){var u=t.animation.current.start;t.animation.current={start:(new Date).getTime(),duration:t.animation.duration,anims:s.anims,fadings:s.fadings},u||i(t)}else t.renderRAF();return o}var u=(e("mithril"),e("./util")),c={easeInOutQuad:function(e){return.5>e?2*e*e:-1+(4-2*e)*e},easeInOutCubic:function(e){return.5>e?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeOutQuad:function(e){return e*(2-e)},easeOutCubic:function(e){return--e*e*e+1}};t.exports=function(e,t,n){return function(){var r=[t].concat(Array.prototype.slice.call(arguments,0));if(t.animation.enabled&&!n&&t.render)return s(u.partialApply(e,r),t);var o=e.apply(null,r);return t.renderRAF(),o}}},{"./util":43,mithril:32}],34:[function(e,t){var n=(e("mithril"),e("./board"));t.exports=function(e){return{set:e.set,toggleOrientation:e.toggleOrientation,getOrientation:function(){return e.data.orientation},getPieces:function(){return e.data.pieces},getMaterialDiff:function(){return n.getMaterialDiff(e.data)},getFen:e.getFen,dump:function(){return e.data},move:e.apiMove,setPieces:e.setPieces,setCheck:e.setCheck,playPremove:e.playPremove,cancelPremove:e.cancelPremove,stop:e.stop}}},{"./board":35,mithril:32}],35:[function(e,t){function n(e){setTimeout(e,1)}function r(e){e.orientation=O.opposite(e.orientation)}function o(e){e.lastMove=null,p(e,null)}function a(e,t){k(t,function(t,n){t?e.pieces[n]=t:delete e.pieces[n]}),e.movable.dropped=[]}function i(e,t){var n=t||e.turnColor;k(e.pieces,function(t,r){return t.color===n&&"king"===t.role?void(e.check=r):void 0})}function s(e,t,r){e.premovable.current=[t,r],n(O.partial(e.premovable.events.set,t,r))}function u(e){e.premovable.current&&(e.premovable.current=null,n(e.premovable.events.unset))}function c(e,t,r){var o=E(function(){return t!==r&&e.pieces[t]?(e.pieces[r]=e.pieces[t],delete e.pieces[t],e.lastMove=[t,r],e.check=null,n(e.events.change),!0):!1},e)();return o&&(e.movable.dropped=[]),o}function l(e,t,n){return c(e,t,n)}function f(e,t,r){r?v(e,t,r)?c(e,t,r)&&(p(e,null),n(O.partial(e.movable.events.after,t,r,{premove:!1,holdTime:N.stop()}))):g(e,t,r)?(s(e,t,r),p(e,null)):h(e,r)||m(e,r)?p(e,r):p(e,null):(p(e,null),"trash"===e.movable.dropOff&&(delete e.pieces[t],n(e.events.change)))}function d(e,t){u(e),e.selected?t?e.selected!==t&&f(e,e.selected,t):p(e,null):(h(e,t)||m(e,t))&&p(e,t),t&&n(O.partial(e.events.select,t))}function p(e,t){e.selected=t,e.premovable.dests=t&&m(e,t)?C(e.pieces,t):null}function h(e,t){var n=e.pieces[t];return n&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}function v(e,t,n){return t!==n&&h(e,t)&&(e.movable.free||O.containsX(e.movable.dests[t],n))}function m(e,t){var n=e.pieces[t];return n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function g(e,t,n){return t!==n&&m(e,t)&&O.containsX(C(e.pieces,t),n)}function b(e,t){var n=e.pieces[t];return n&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function y(e){var t=e.premovable.current;if(t){var r=t[0],o=t[1];v(e,r,o)&&c(e,r,o)&&n(O.partial(e.movable.events.after,r,o,{premove:!0})),u(e)}}function w(e){e.movable.color=null,e.movable.dests={},d(e,null)}function x(e,t,n){if(n||e.bounds){n=n||e.bounds();var r=Math.ceil(8*((t[0]-n.left)/n.width));r="white"===e.orientation?r:9-r;var o=Math.ceil(8-8*((t[1]-n.top)/n.height));return o="white"===e.orientation?o:9-o,r>0&&9>r&&o>0&&9>o?O.pos2key([r,o]):void 0}}function j(e){var t={king:0,queen:0,rook:0,bishop:0,knight:0,pawn:0};for(var n in e.pieces){var r=e.pieces[n];t[r.role]+="white"===r.color?1:-1}var o={white:{},black:{}};for(var a in t){var i=t[a];i>0?o.white[a]=i:0>i&&(o.black[a]=-i)}return o}var k=e("lodash-node/modern/objects/forIn"),O=e("./util"),C=e("./premove"),E=e("./anim"),N=e("./hold");t.exports={reset:o,toggleOrientation:r,setPieces:a,setCheck:i,selectSquare:d,setSelected:p,isDraggable:b,canMove:v,userMove:f,apiMove:l,playPremove:y,unsetPremove:u,stop:w,getKeyAtDomPos:x,getMaterialDiff:j}},{"./anim":33,"./hold":41,"./premove":42,"./util":43,"lodash-node/modern/objects/forIn":21}],36:[function(e,t){var n=e("lodash-node/modern/objects/merge"),r=e("./board"),o=e("./fen");t.exports=function(e,t){var a;t.movable&&(a=t.movable.dests,delete t.movable.dests),n(e,t),void 0!==a&&(e.movable.dests=a),e.fen&&(e.pieces=o.read(e.fen),e.check=t.check,delete e.fen),e.movable.dropped=[],e.selected&&r.setSelected(e,e.selected),e.animation.duration<10&&(e.animation.enabled=!1)}},{"./board":35,"./fen":40,"lodash-node/modern/objects/merge":28}],37:[function(e,t){var n=e("./board"),r=e("./data"),o=e("./fen"),a=e("./configure"),i=e("./anim"),s=e("./drag");t.exports=function(e){this.data=r(e),this.getFen=function(){return o.write(this.data.pieces)}.bind(this),this.set=i(a,this.data),this.toggleOrientation=i(n.toggleOrientation,this.data),this.setPieces=i(n.setPieces,this.data),this.selectSquare=i(n.selectSquare,this.data,!0),this.apiMove=i(n.apiMove,this.data),this.playPremove=i(n.playPremove,this.data),this.cancelPremove=i(n.unsetPremove,this.data,!0),this.setCheck=i(n.setCheck,this.data,!0),this.stop=i(function(e){n.stop(e),s.end(e)}.bind(this),this.data,!0)}},{"./anim":33,"./board":35,"./configure":36,"./data":38,"./drag":39,"./fen":40}],38:[function(e,t){var n=e("./fen"),r=e("./configure");t.exports=function(e){var t={pieces:n.read(n.initial),orientation:"white",turnColor:"white",check:null,lastMove:null,selected:null,coordinates:!0,render:null,renderRAF:null,element:null,bounds:null,viewOnly:!1,highlight:{lastMove:!0,check:!0,dragOver:!0},animation:{enabled:!0,duration:200,current:{}},movable:{free:!0,color:"both",dests:{},dropOff:"revert",dropped:[],showDests:!0,events:{after:function(){}}},premovable:{enabled:!0,showDests:!0,dests:[],current:null,events:{set:function(){},unset:function(){}}},draggable:{enabled:!0,distance:3,squareTarget:!1,centerPiece:!0,showGhost:!0,current:{}},events:{change:function(){},select:function(){}}};
return r(t,e||{}),t}},{"./configure":36,"./fen":40}],39:[function(e,t){function n(e,t){if(!(void 0!==t.button&&0!==t.button||t.touches&&t.touches.length>1)){t.stopPropagation(),t.preventDefault(),i=t.target;var n=u.eventPosition(t),o=e.bounds(),a=s.getKeyAtDomPos(e,n,o);s.selectSquare(e,a);var l=e.selected===a;if(e.pieces[a]&&l&&s.isDraggable(e,a)){var f=e.element.querySelector("."+a).getBoundingClientRect();e.draggable.current={orig:a,rel:n,epos:n,pos:[0,0],dec:e.draggable.centerPiece?[n[0]-(f.left+f.width/2),n[1]-(f.top+f.height/2)]:[0,0],bounds:o,started:!1},c.start()}r(e)}}function r(e){requestAnimationFrame(function(){var t=e.draggable.current;t.orig&&(e.animation.current.start&&-1!==Object.keys(e.animation.current.anims).indexOf(t.orig)&&(e.animation.current={}),!t.started&&u.distance(t.epos,t.rel)>=e.draggable.distance&&(t.started=!0),t.started&&(t.pos=[t.epos[0]-t.rel[0],t.epos[1]-t.rel[1]],t.over=s.getKeyAtDomPos(e,t.epos,t.bounds))),e.render(),t.orig&&r(e)})}function o(e,t){t.touches&&t.touches.length>1||e.draggable.current.orig&&(e.draggable.current.epos=u.eventPosition(t))}function a(e,t){var n=e.draggable,r=n.current?n.current.orig:null;r&&("touchend"!==t.type||i===t.target)&&(n.current.started&&(dest=n.current.over,r!==dest&&(e.movable.dropped=[r,dest]),s.userMove(e,r,dest)),n.current={})}{var i,s=e("./board"),u=e("./util"),c=e("./hold");e("mithril")}t.exports={start:n,move:o,end:a,processDrag:r}},{"./board":35,"./hold":41,"./util":43,mithril:32}],40:[function(e,t){function n(e){"start"===e&&(e=i);var t={};return e.replace(/ .+$/,"").split("/").forEach(function(e,n){var r=0;e.split("").forEach(function(e){var o=parseInt(e);o?r+=o:(r++,t[a.pos2key([r,8-n])]={role:s[e.toLowerCase()],color:e===e.toLowerCase()?"black":"white"})})}),t}function r(e){return o(8,1,-1).reduce(function(e,t){return e.replace(new RegExp(Array(t+1).join("1"),"g"),t)},o(8,0,-1).map(function(t){return o(1,9).map(function(n){var r=e[a.pos2key([n,t])];if(r){var o=u[r.role];return"white"===r.color?o.toUpperCase():o}return"1"}).join("")}).join("/"))}var o=e("lodash-node/modern/arrays/range"),a=e("./util"),i="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",s={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},u={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};t.exports={initial:i,read:n,write:r}},{"./util":43,"lodash-node/modern/arrays/range":2}],41:[function(e,t){var n,r=function(){n=new Date},o=function(){n=null},a=function(){if(!n)return 0;var e=new Date-n;return n=null,e};t.exports={start:r,cancel:o,stop:a}},{}],42:[function(e,t){function n(e,t){return Math.abs(e-t)}function r(e,t,r,o,a){return n(t,o)<2&&("white"===e?a===r+1||2===r&&4===a&&t===o:a===r-1||7===r&&5===a&&t===o)}function o(e,t,r,o){var a=n(e,r),i=n(t,o);return 1===a&&2===i||2===a&&1===i}function a(e,t,r,o){return n(e,r)===n(t,o)}function i(e,t,n,r){return e===n||t===r}function s(e,t,n,r){return a(e,t,n,r)||i(e,t,n,r)}function u(e,t,r,o,a,i){return n(r,a)<2&&n(o,i)<2||o===i&&o===("white"===e?1:8)&&(5===r&&(3===a||7===a)||f.containsX(t,a))}function c(e,t){return Object.keys(e).filter(function(n){var r=e[n];return r&&r.color===t&&"rook"===r.role}).map(function(e){return f.key2pos(e)[0]})}function l(e,t){var n,l=e[t],d=f.key2pos(t);switch(l.role){case"pawn":n=r.bind(null,l.color);break;case"knight":n=o;break;case"bishop":n=a;break;case"rook":n=i;break;case"queen":n=s;break;case"king":n=u.bind(null,l.color,c(e,l.color))}return f.allPos.filter(function(e){return(d[0]!==e[0]||d[1]!==e[1])&&n(d[0],d[1],e[0],e[1])}).map(f.pos2key)}var f=e("./util");t.exports=l},{"./util":43}],43:[function(e,t){function n(e){return y[e[0]-1]+e[1]}function r(e){return[y.indexOf(e[0])+1,parseInt(e[1])]}function o(e){return y[7-y.indexOf(e[0])]+(9-parseInt(e[1]))}function a(e){var t=[];for(var n in e)e[n]&&t.push(n);return t.join(" ")}function i(e){return"white"===e?"black":"white"}function s(e,t){return e&&(e[0]===t||e[1]===t)}function u(e,t){return e&&-1!==e.indexOf(t)}function c(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function l(e){return console.log(e),e}function f(){return g||(g=d()),g}function d(){return"transform"in document.body.style?"transform":"webkitTransform"in document.body.style?"webkitTransform":"mozTransform"in document.body.style?"mozTransform":"oTransform"in document.body.style?"oTransform":"msTransform"}function p(e){return"translate3d("+e[0]+"px,"+e[1]+"px,0)"}function h(e){return e.touches?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:[e.clientX,e.clientY]}function v(e,t){return e.bind.apply(e,[null].concat(t))}function m(){return v(arguments[0],Array.prototype.slice.call(arguments,1))}var g,b=e("lodash-node/modern/arrays/range"),y="abcdefgh".split(""),w=b(1,9),x=b(8,0,-1),j=function(){var e=[];return x.forEach(function(t){w.forEach(function(n){e.push([n,t])})}),e}(),k=j.slice().reverse(),O=j.map(n);t.exports={files:y,ranks:w,allPos:j,invPos:k,allKeys:O,pos2key:n,key2pos:r,invertKey:o,classSet:a,opposite:i,translate:p,contains2:s,containsX:u,distance:c,eventPosition:h,partialApply:v,partial:m,transformProp:f,pp:l}},{"lodash-node/modern/arrays/range":2}],44:[function(e,t){function n(e){return["cg-piece",e.role,e.color].join(" ")}function r(e,t,r){var o={style:{},"class":n(r)},a=e.data.draggable.current;if(a.orig!==t||0===a.pos[0]&&0===a.pos[1]){if(e.data.animation.current.anims){var i=e.data.animation.current.anims[t];i&&(o.style[f.transformProp()]=f.translate(i[1]))}}else o.style[f.transformProp()]=f.translate([a.pos[0]+a.dec[0],a.pos[1]+a.dec[1]]),o.class+=" dragging";return{tag:"div",attrs:o}}function o(e){return{tag:"div",attrs:{"class":n(e)+" ghost"}}}function a(e,t,n){var a=f.files[t[0]-1],i=t[1],s=a+i,u=e.data.pieces[s],c=e.data.highlight.dragOver&&e.data.draggable.current.over===s,l={"class":"cg-square "+s+" "+f.classSet({selected:e.data.selected===s,check:e.data.highlight.check&&e.data.check===s,"last-move":e.data.highlight.lastMove&&f.contains2(e.data.lastMove,s),"move-dest":(c||e.data.movable.showDests)&&f.containsX(e.data.movable.dests[e.data.selected],s),"premove-dest":(c||e.data.premovable.showDests)&&f.containsX(e.data.premovable.dests,s),"current-premove":f.contains2(e.data.premovable.current,s),"drag-over":c,occupied:!!u}),style:{left:12.5*(n?t[0]-1:8-t[0])+"%",bottom:12.5*(n?t[1]-1:8-t[1])+"%"}};e.data.coordinates&&(t[1]===(n?1:8)&&(l["data-coord-x"]=a),t[0]===(n?8:1)&&(l["data-coord-y"]=i));var d=[];return u&&(d.push(r(e,s,u)),e.data.draggable.current.orig===s&&e.data.draggable.showGhost&&d.push(o(u))),{tag:"div",attrs:l,children:d}}function i(e){var t=f.key2pos(e.over);return{tag:"div",attrs:{id:"cg-square-target",style:{width:e.bounds.width/4+"px",height:e.bounds.height/4+"px",left:(t[0]-1.5)*e.bounds.width/8+"px",top:(7.5-t[1])*e.bounds.height/8+"px"}}}}function s(e){return{tag:"div",attrs:{"class":"cg-square fading",style:{left:e.left,bottom:e.bottom,opacity:e.opacity}},children:{tag:"div",attrs:{"class":n(e.piece)}}}}function u(e){var t="white"==e.data.orientation,n=(t?f.allPos:f.invPos).map(function(n){return a(e,n,t)});return e.data.draggable.current.over&&e.data.draggable.squareTarget&&n.push(i(e.data.draggable.current)),e.data.animation.current.fadings&&e.data.animation.current.fadings.forEach(function(e){n.push(s(e))}),n}function c(e,t,n){var r=f.partial(d.start,e.data),o=f.partial(d.move,e.data),a=f.partial(d.end,e.data),i=["touchstart","mousedown"],s=["touchmove","mousemove"],u=["touchend","mouseup"];i.forEach(function(e){t.addEventListener(e,r)}),s.forEach(function(e){document.addEventListener(e,o)}),u.forEach(function(e){document.addEventListener(e,a)}),n.onunload=function(){i.forEach(function(e){t.removeEventListener(e,r)}),s.forEach(function(e){document.removeEventListener(e,o)}),u.forEach(function(e){document.removeEventListener(e,a)})}}function l(e){return{tag:"div",attrs:{"class":"cg-board orientation-"+e.data.orientation,config:function(t,n,r){n||(e.data.viewOnly||c(e,t,r),e.data.render=function(){m.render(t,u(e))},e.data.renderRAF=function(){requestAnimationFrame(e.data.render)},e.data.bounds=t.getBoundingClientRect.bind(t),e.data.element=t,e.data.render())}},children:null}}var f=e("./util"),d=(e("./board"),e("./drag")),f=e("./util");t.exports=function(e){return{tag:"div",attrs:{"class":"cg-board-wrap "+(e.data.viewOnly?"view-only":"manipulable")},children:l(e)}}},{"./board":35,"./drag":39,"./util":43}]},{},[1])(1)});