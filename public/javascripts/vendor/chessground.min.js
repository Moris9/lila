!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Chessground=e()}}(function(){return function e(t,r,n){function o(a,s){if(!r[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){var r=t[a][1][e];return o(r?r:e)},l,l.exports,e,t,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,r){"use strict";function n(e,t){return t.animation.enabled?u(e,t):o(e,t)}function o(e,t){var r=e(t);return t.dom.redraw(),r}function i(e,t){return{key:e,pos:v.key2pos(e),piece:t}}function a(e,t){return t.sort(function(t,r){return v.distanceSq(e.pos,t.pos)-v.distanceSq(e.pos,r.pos)})[0]}function s(e,t){var r,n,o,s,c,u,l=t.dom.bounds(),d=l.width/8,f=l.height/8,p={},h=[],g={},m=[],b=[],y={},w="white"===t.orientation;for(o in e)y[o]=i(o,e[o]);for(var k=0,P=v.allKeys;k<P.length;k++){var C=P[k];r=t.pieces[C],n=y[C],r?n?v.samePiece(r,n.piece)||(m.push(n),b.push(i(C,r))):b.push(i(C,r)):n&&m.push(n)}return b.forEach(function(e){n=a(e,m.filter(function(t){return v.samePiece(e.piece,t.piece)})),n&&(s=w?n.pos:e.pos,c=w?e.pos:n.pos,u=[(s[0]-c[0])*d,(c[1]-s[1])*f],p[e.key]=[u,u],h.push(n.key))}),m.forEach(function(e){v.containsX(h,e.key)||t.items&&t.items(e.pos,e.key)||(g[e.key]=e.piece)}),{anims:p,fadings:g}}function c(e){var t=e.animation.current;if(!t)return void(e.dom.destroyed||e.dom.redrawNow());var r=1-(Date.now()-t.start)/t.duration;if(r<=0)e.animation.current=void 0,e.dom.redrawNow();else{var n=d(r);for(var o in t.plan.anims){var i=t.plan.anims[o];i[1]=[f(i[0][0]*n,10),f(i[0][1]*n,10)]}e.dom.redrawNow(!0),v.raf(function(){return c(e)})}}function u(e,t){var r=p({},t.pieces),n=e(t),o=s(r,t);if(l(o.anims)&&l(o.fadings))t.dom.redraw();else{var i=t.animation.current&&t.animation.current.start;t.animation.current={start:Date.now(),duration:t.animation.duration,plan:o},i||c(t)}return n}function l(e){for(var t in e)return!1;return!0}function d(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}function f(e,t){return Math.round(e*t)/t}var p=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(r,"__esModule",{value:!0});var v=e("./util");r.anim=n,r.render=o},{"./util":17}],2:[function(e,t,r){"use strict";function n(e,t){function r(){o.toggleOrientation(e),t()}return{set:function(t){t.orientation&&t.orientation!==e.orientation&&r(),(t.fen?s.anim:s.render)(function(e){return a.configure(e,t)},e)},state:e,getFen:function(){return i.write(e.pieces)},toggleOrientation:r,setPieces:function(t){s.anim(function(e){return o.setPieces(e,t)},e)},selectSquare:function(t,r){t?s.anim(function(e){return o.selectSquare(e,t,r)},e):e.selected&&(o.unselect(e),e.dom.redraw())},move:function(t,r){s.anim(function(e){return o.baseMove(e,t,r)},e)},newPiece:function(t,r){s.anim(function(e){return o.baseNewPiece(e,t,r)},e)},playPremove:function(){if(e.premovable.current){if(s.anim(o.playPremove,e))return!0;e.dom.redraw()}return!1},playPredrop:function(t){if(e.predroppable.current){var r=o.playPredrop(e,t);return e.dom.redraw(),r}return!1},cancelPremove:function(){s.render(o.unsetPremove,e)},cancelPredrop:function(){s.render(o.unsetPredrop,e)},cancelMove:function(){s.render(function(e){o.cancelMove(e),c.cancel(e)},e)},stop:function(){s.render(function(e){o.stop(e),c.cancel(e)},e)},explode:function(t){u.default(e,t)},setAutoShapes:function(t){s.render(function(e){return e.drawable.autoShapes=t},e)},setShapes:function(t){s.render(function(e){return e.drawable.shapes=t},e)},getKeyAtDomPos:function(t){return o.getKeyAtDomPos(t,"white"===e.orientation,e.dom.bounds())},redrawAll:t,dragNewPiece:function(t,r,n){c.dragNewPiece(e,t,r,n)},destroy:function(){o.stop(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}Object.defineProperty(r,"__esModule",{value:!0});var o=e("./board"),i=e("./fen"),a=e("./config"),s=e("./anim"),c=e("./drag"),u=e("./explosion");r.start=n},{"./anim":1,"./board":3,"./config":5,"./drag":6,"./explosion":9,"./fen":10}],3:[function(e,t,r){"use strict";function n(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];e&&setTimeout(function(){return e.apply(void 0,t)},1)}function o(e){e.orientation=j.opposite(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function i(e){e.lastMove=void 0,w(e),u(e),d(e)}function a(e,t){for(var r in t){var n=t[r];n?e.pieces[r]=n:delete e.pieces[r]}}function s(e,t){if(t===!0&&(t=e.turnColor),t)for(var r in e.pieces)"king"===e.pieces[r].role&&e.pieces[r].color===t&&(e.check=r);else e.check=void 0}function c(e,t,r,o){d(e),e.premovable.current=[t,r],n(e.premovable.events.set,t,r,o)}function u(e){e.premovable.current&&(e.premovable.current=void 0,n(e.premovable.events.unset))}function l(e,t,r){u(e),e.predroppable.current={role:t,key:r},n(e.predroppable.events.set,t,r)}function d(e){var t=e.predroppable;t.current&&(t.current=void 0,n(t.events.unset))}function f(e,t,r){if(!e.autoCastle)return!1;var n=e.pieces[t];if("king"!==n.role)return!1;var o=j.key2pos(t);if(5!==o[0])return!1;if(1!==o[1]&&8!==o[1])return!1;var i,a,s,c=j.key2pos(r);if(7===c[0]||8===c[0])i=j.pos2key([8,o[1]]),a=j.pos2key([6,o[1]]),s=j.pos2key([7,o[1]]);else{if(3!==c[0]&&1!==c[0])return!1;i=j.pos2key([1,o[1]]),a=j.pos2key([4,o[1]]),s=j.pos2key([3,o[1]])}var u=e.pieces[i];return"rook"===u.role&&(delete e.pieces[t],delete e.pieces[i],e.pieces[s]=n,e.pieces[a]=u,!0)}function p(e,t,r){if(t===r||!e.pieces[t])return!1;var o=e.pieces[r]&&e.pieces[r].color!==e.pieces[t].color?e.pieces[r]:void 0;return r==e.selected&&w(e),n(e.events.move,t,r,o),f(e,t,r)||(e.pieces[r]=e.pieces[t],delete e.pieces[t]),e.lastMove=[t,r],e.check=void 0,n(e.events.change),o||!0}function v(e,t,r,o){if(e.pieces[r]){if(!o)return!1;delete e.pieces[r]}return n(e.events.dropNewPiece,t,r),e.pieces[r]=t,e.lastMove=[r],e.check=void 0,n(e.events.change),e.movable.dests=void 0,e.turnColor=j.opposite(e.turnColor),!0}function h(e,t,r){var n=p(e,t,r);return n&&(e.movable.dests=void 0,e.turnColor=j.opposite(e.turnColor),e.animation.current=void 0),n}function g(e,t,r){if(P(e,t,r)){var o=h(e,t,r);if(o){var i=e.hold.stop();w(e);var a={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:i};return o!==!0&&(a.captured=o),n(e.movable.events.after,t,r,a),!0}}else O(e,t,r)?(c(e,t,r,{ctrlKey:e.stats.ctrlKey}),w(e)):k(e,r)||M(e,r)?(y(e,r),e.hold.start()):w(e);return!1}function m(e,t,r,o){if(C(e,t,r)||o){var i=e.pieces[t];delete e.pieces[t],v(e,i,r,o),n(e.movable.events.afterNewPiece,i.role,r,{predrop:!1})}else x(e,t,r)?l(e,e.pieces[t].role,r):(u(e),d(e));delete e.pieces[t],w(e)}function b(e,t,r){e.selected?e.selected!==t||e.draggable.enabled?(e.selectable.enabled||r)&&e.selected!==t?g(e,e.selected,t)&&(e.stats.dragged=!1):e.hold.start():(w(e),e.hold.cancel()):(k(e,t)||M(e,t))&&(y(e,t),e.hold.start()),n(e.events.select,t)}function y(e,t){e.selected=t,M(e,t)?e.premovable.dests=S.default(e.pieces,t,e.premovable.castle):e.premovable.dests=void 0}function w(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function k(e,t){var r=e.pieces[t];return r&&("both"===e.movable.color||e.movable.color===r.color&&e.turnColor===r.color)}function P(e,t,r){return t!==r&&k(e,t)&&(e.movable.free||!!e.movable.dests&&j.containsX(e.movable.dests[t],r))}function C(e,t,r){var n=e.pieces[t];return n&&r&&(t===r||!e.pieces[r])&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}function M(e,t){var r=e.pieces[t];return r&&e.premovable.enabled&&e.movable.color===r.color&&e.turnColor!==r.color}function O(e,t,r){return t!==r&&M(e,t)&&j.containsX(S.default(e.pieces,t,e.premovable.castle),r)}function x(e,t,r){var n=e.pieces[t];return n&&r&&(!e.pieces[r]||e.pieces[r].color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==n.role||"1"!==r[1]&&"8"!==r[1])&&e.movable.color===n.color&&e.turnColor!==n.color}function _(e,t){var r=e.pieces[t];return r&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===r.color&&(e.turnColor===r.color||e.premovable.enabled))}function D(e){var t=e.premovable.current;if(!t)return!1;var r=t[0],o=t[1],i=!1;if(P(e,r,o)){var a=h(e,r,o);if(a){var s={premove:!0};a!==!0&&(s.captured=a),n(e.movable.events.after,r,o,s),i=!0}}return u(e),i}function E(e,t){var r=e.predroppable.current,o=!1;if(!r)return!1;if(t(r)){var i={role:r.role,color:e.movable.color};v(e,i,r.key)&&(n(e.movable.events.afterNewPiece,r.role,r.key,{predrop:!0}),o=!0)}return d(e),o}function T(e){u(e),d(e),w(e)}function K(e){e.movable.color=e.movable.dests=e.animation.current=void 0,T(e)}function A(e,t,r){var n=Math.ceil(8*((e[0]-r.left)/r.width));t||(n=9-n);var o=Math.ceil(8-8*((e[1]-r.top)/r.height));return t||(o=9-o),n>0&&n<9&&o>0&&o<9?j.pos2key([n,o]):void 0}Object.defineProperty(r,"__esModule",{value:!0});var j=e("./util"),S=e("./premove");r.callUserFunction=n,r.toggleOrientation=o,r.reset=i,r.setPieces=a,r.setCheck=s,r.unsetPremove=u,r.unsetPredrop=d,r.baseMove=p,r.baseNewPiece=v,r.userMove=g,r.dropNewPiece=m,r.selectSquare=b,r.setSelected=y,r.unselect=w,r.canMove=P,r.isDraggable=_,r.playPremove=D,r.playPredrop=E,r.cancelMove=T,r.stop=K,r.getKeyAtDomPos=A},{"./premove":12,"./util":17}],4:[function(e,t,r){"use strict";function n(e,t){function r(){var t=n.dom&&n.dom.unbind;e.classList.add("cg-board-wrap");var i=f.memo(function(){return e.getBoundingClientRect()}),a=c.default(e,n,i()),s=function(e){l.default(n),!e&&a.svg&&d.renderSvg(n,a.svg)};n.dom={elements:a,bounds:i,redraw:o(s),redrawNow:s,unbind:t},d.clearCache(),s(!1),u.bindBoard(n),t||(n.dom.unbind=u.bindDocument(n,r))}var n=s.defaults();a.configure(n,t||{}),r();var p=i.start(n,r);return p}function o(e){var t=!1;return function(){t||(t=!0,f.raf(function(){e(),t=!1}))}}Object.defineProperty(r,"__esModule",{value:!0});var i=e("./api"),a=e("./config"),s=e("./state"),c=e("./wrap"),u=e("./events"),l=e("./render"),d=e("./svg"),f=e("./util");r.Chessground=n},{"./api":2,"./config":5,"./events":8,"./render":13,"./state":14,"./svg":15,"./util":17,"./wrap":18}],5:[function(e,t,r){"use strict";function n(e,t){if(t.movable&&t.movable.dests&&(e.movable.dests=void 0),o(e,t),t.fen&&(e.pieces=s.read(t.fen),e.drawable.shapes=[]),t.hasOwnProperty("check")&&a.setCheck(e,t.check||!1),t.hasOwnProperty("lastMove")&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&a.setSelected(e,e.selected),(!e.animation.duration||e.animation.duration<100)&&(e.animation.enabled=!1),!e.movable.rookCastle&&e.movable.dests){var r="white"===e.movable.color?1:8,n="e"+r,i=e.movable.dests[n];if(!i||"king"!==e.pieces[n].role)return;e.movable.dests[n]=i.filter(function(e){return(e!=="a"+r||i.indexOf("c"+r)===-1)&&(e!=="h"+r||i.indexOf("g"+r)===-1)})}}function o(e,t){for(var r in t)i(e[r])&&i(t[r])?o(e[r],t[r]):e[r]=t[r]}function i(e){return"object"==typeof e}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./board"),s=e("./fen");r.configure=n},{"./board":3,"./fen":10}],6:[function(e,t,r){"use strict";function n(e,t){if(!(void 0!==t.button&&0!==t.button||t.touches&&t.touches.length>1)){t.preventDefault();var r="white"===e.orientation,n=e.dom.bounds(),o=p.eventPosition(t),a=f.getKeyAtDomPos(o,r,n);if(a){var s=e.pieces[a],c=e.selected;if(c||!e.drawable.eraseOnClick&&s&&s.color===e.turnColor||v.clear(e),!e.viewOnly){var u=!!e.premovable.current,g=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&f.canMove(e,e.selected,a)?h.anim(function(e){return f.selectSquare(e,a)},e):f.selectSquare(e,a);var m=e.selected===a,b=d(e,a);if(s&&b&&m&&f.isDraggable(e,a)){var y=l(a,r,n);e.draggable.current={orig:a,origPos:p.key2pos(a),piece:s,rel:o,epos:o,pos:[0,0],dec:e.draggable.centerPiece?[o[0]-(y.left+y.width/2),o[1]-(y.top+y.height/2)]:[0,0],started:e.draggable.autoDistance&&e.stats.dragged,element:b,previouslySelected:c,originTarget:t.target},b.cgDragging=!0,b.classList.add("dragging");var w=e.dom.elements.ghost;w&&(w.className="ghost "+s.color+" "+s.role,w.style.transform=p.translate(p.posToTranslate(p.key2pos(a),r,n))),i(e)}else u&&f.unsetPremove(e),g&&f.unsetPredrop(e);e.dom.redraw()}}}}function o(e,t,r,n){var o="a0";e.pieces[o]=t,e.dom.redraw();var a=p.eventPosition(r),s="white"===e.orientation,c=e.dom.bounds(),u=l(o,s,c),f=[(s?0:7)*u.width+c.left,(s?8:-1)*u.height+c.top];e.draggable.current={orig:o,origPos:p.key2pos(o),piece:t,rel:f,epos:a,pos:[a[0]-f[0],a[1]-f[1]],dec:[-u.width/2,-u.height/2],started:!0,element:function(){return d(e,o)},originTarget:r.target,newPiece:!0,force:n||!1},i(e)}function i(e){p.raf(function(){var t=e.draggable.current;if(t){e.animation.current&&e.animation.current.plan.anims[t.orig]&&(e.animation.current=void 0);var r=e.pieces[t.orig];if(r&&p.samePiece(r,t.piece)){if(!t.started&&p.distanceSq(t.epos,t.rel)>=Math.pow(e.draggable.distance,2)&&(t.started=!0),t.started){if("function"==typeof t.element){var n=t.element();if(!n)return;t.element=n,t.element.cgDragging=!0,t.element.classList.add("dragging")}var o="white"===e.orientation,a=e.dom.bounds();t.pos=[t.epos[0]-t.rel[0],t.epos[1]-t.rel[1]],t.over=f.getKeyAtDomPos(t.epos,o,a);var s=p.posToTranslate(t.origPos,o,a);s[0]+=t.pos[0]+t.dec[0],s[1]+=t.pos[1]+t.dec[1],t.element.style.transform=p.translate(s);var u=e.dom.elements.over;if(u&&t.over&&t.over!==t.overPrev){var l=e.movable.dests;if(e.movable.free||p.containsX(l&&l[t.orig],t.over)||p.containsX(e.premovable.dests,t.over)){var d=p.key2pos(t.over),v=[(o?d[0]-1:8-d[0])*a.width/8,(o?8-d[1]:d[1]-1)*a.height/8];u.style.transform=p.translate(v)}else u.style.transform=p.translateAway;t.overPrev=t.over}}}else c(e);i(e)}})}function a(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.epos=p.eventPosition(t))}function s(e,t){var r=e.draggable.current;if(r){if("touchend"===t.type&&r&&r.originTarget!==t.target&&!r.newPiece)return void(e.draggable.current=void 0);f.unsetPremove(e),f.unsetPredrop(e);var n=p.eventPosition(t)||r.epos,o=f.getKeyAtDomPos(n,"white"===e.orientation,e.dom.bounds());o&&r.started?r.newPiece?f.dropNewPiece(e,r.orig,o,r.force):(e.stats.ctrlKey=t.ctrlKey,f.userMove(e,r.orig,o)&&(e.stats.dragged=!0)):r.newPiece?delete e.pieces[r.orig]:e.draggable.deleteOnDropOff&&(delete e.pieces[r.orig],f.callUserFunction(e.events.change)),!r||r.orig!==r.previouslySelected||r.orig!==o&&o?e.selectable.enabled||f.unselect(e):f.unselect(e),u(e),e.draggable.current=void 0,e.dom.redraw()}}function c(e){var t=e.draggable.current;t&&(t.newPiece&&delete e.pieces[t.orig],e.draggable.current=void 0,f.unselect(e),u(e),e.dom.redraw())}function u(e){var t=e.dom.elements;t.over&&(t.over.style.transform=p.translateAway),t.ghost&&(t.ghost.style.transform=p.translateAway)}function l(e,t,r){var n=p.key2pos(e);return t||(n[0]=9-n[0],n[1]=9-n[1]),{left:r.left+r.width*(n[0]-1)/8,top:r.top+r.height*(8-n[1])/8,width:r.width/8,height:r.height/8}}function d(e,t){for(var r=e.dom.elements.board.firstChild;r;){if(r.cgKey===t&&"PIECE"===r.tagName)return r;r=r.nextSibling}}Object.defineProperty(r,"__esModule",{value:!0});var f=e("./board"),p=e("./util"),v=e("./draw"),h=e("./anim");r.start=n,r.dragNewPiece=o,r.move=a,r.end=s,r.cancel=c},{"./anim":1,"./board":3,"./draw":7,"./util":17}],7:[function(e,t,r){"use strict";function n(e,t){if(!(t.touches&&t.touches.length>1)){t.stopPropagation(),t.preventDefault(),v.cancelMove(e);var r=h.eventPosition(t),n=v.getKeyAtDomPos(r,"white"===e.orientation,e.dom.bounds());n&&(e.drawable.current={orig:n,dest:n,pos:r,brush:u(t)},o(e))}}function o(e){h.raf(function(){var t=e.drawable.current;if(t){var r=v.getKeyAtDomPos(t.pos,"white"===e.orientation,e.dom.bounds()),n=t.orig===r?void 0:r;n!==t.dest&&(t.dest=n,e.dom.redrawNow()),o(e)}})}function i(e,t){e.drawable.current&&(e.drawable.current.pos=h.eventPosition(t))}function a(e){var t=e.drawable.current;t&&(t.dest&&t.dest!==t.orig?f(e.drawable,t,t.dest):d(e.drawable,t),s(e))}function s(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function c(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),p(e.drawable))}function u(e){var t=e.shiftKey&&h.isRightButton(e)?1:0,r=e.altKey?2:0;return g[t+r]}function l(e){return function(t){return!e(t)}}function d(e,t){var r=t.orig,n=function(e){return e.orig===r&&!e.dest},o=e.shapes.filter(n)[0];o&&(e.shapes=e.shapes.filter(l(n))),o&&o.brush===t.brush||e.shapes.push({brush:t.brush,orig:r}),p(e)}function f(e,t,r){var n=t.orig,o=function(e){return!!e.dest&&(e.orig===n&&e.dest===r||e.dest===n&&e.orig===r)},i=e.shapes.filter(o).length>0;i?e.shapes=e.shapes.filter(l(o)):e.shapes.push({brush:t.brush,orig:n,dest:r}),p(e)}function p(e){e.onChange&&e.onChange(e.shapes)}Object.defineProperty(r,"__esModule",{value:!0});var v=e("./board"),h=e("./util"),g=["green","red","blue","yellow"];r.start=n,r.processDraw=o,r.move=i,r.end=a,r.cancel=s,r.clear=c},{"./board":3,"./util":17}],8:[function(e,t,r){"use strict";function n(e){var t=e.dom.elements.board;e.viewOnly||["touchstart","mousedown"].forEach(function(r){return t.addEventListener(r,a(e))}),(e.disableContextMenu||e.drawable.enabled)&&t.addEventListener("contextmenu",function(e){return e.preventDefault(),!1})}function o(e,t){var r=s(e,c.move,u.move),n=s(e,c.end,u.end),o=[];e.viewOnly||(["touchmove","mousemove"].forEach(function(e){return o.push(i(document,e,r))}),["touchend","mouseup"].forEach(function(e){return o.push(i(document,e,n))}));var a=function(){e.dom.bounds.clear(),l.raf(t)};e.resizable&&o.push(i(document.body,"chessground.resize",a));var d=function(){return e.dom.bounds.clear()};return o.push(i(window,"scroll",d,{passive:!0})),o.push(i(window,"resize",d,{passive:!0})),function(){return o.forEach(function(e){return e()})}}function i(e,t,r,n){return e.addEventListener(t,r,n),function(){return e.removeEventListener(t,r)}}function a(e){return function(t){e.draggable.current?c.cancel(e):e.drawable.current?u.cancel(e):t.shiftKey||l.isRightButton(t)?e.drawable.enabled&&u.start(e,t):e.viewOnly||c.start(e,t)}}function s(e,t,r){return function(n){n.shiftKey||l.isRightButton(n)?e.drawable.enabled&&r(e,n):e.viewOnly||t(e,n)}}Object.defineProperty(r,"__esModule",{value:!0});var c=e("./drag"),u=e("./draw"),l=e("./util");r.bindBoard=n,r.bindDocument=o},{"./drag":6,"./draw":7,"./util":17}],9:[function(e,t,r){"use strict";function n(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(function(){o(e,2),setTimeout(function(){return o(e,void 0)},120)},120)}function o(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}Object.defineProperty(r,"__esModule",{value:!0}),r.default=n},{}],10:[function(e,t,r){"use strict";function n(e){"start"===e&&(e=r.initial);for(var t={},n=8,o=0,a=0,c=e;a<c.length;a++){var u=c[a];switch(u){case" ":return t;case"/":if(--n,0===n)return t;o=0;break;case"~":t[i.pos2key([o,n])].promoted=!0;break;default:var l=u.charCodeAt(0);if(l<57)o+=l-48;else{++o;var d=u.toLowerCase();t[i.pos2key([o,n])]={role:s[d],color:u===d?"black":"white"}}}}return t}function o(e){var t,r;return i.invRanks.map(function(n){return a.ranks.map(function(o){return t=e[i.pos2key([o,n])],t?(r=c[t.role],"white"===t.color?r.toUpperCase():r):"1"}).join("")}).join("/").replace(/1{2,}/g,function(e){return e.length.toString()})}Object.defineProperty(r,"__esModule",{value:!0});var i=e("./util"),a=e("./types");r.initial="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR";var s={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},c={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};r.read=n,r.write=o},{"./types":16,"./util":17}],11:[function(e,t,r){t.exports=e("./chessground").Chessground},{"./chessground":4}],12:[function(e,t,r){"use strict";function n(e,t){return Math.abs(e-t)}function o(e){return function(t,r,o,i){return n(t,o)<2&&("white"===e?i===r+1||r<=2&&i===r+2&&t===o:i===r-1||r>=7&&i===r-2&&t===o)}}function i(e,t,r){return function(o,i,a,s){return n(o,a)<2&&n(i,s)<2||r&&i===s&&i===("white"===e?1:8)&&(5===o&&(3===a||7===a)||c.containsX(t,a))}}function a(e,t){var r;return Object.keys(e).filter(function(n){return r=e[n],r&&r.color===t&&"rook"===r.role}).map(function(e){return c.key2pos(e)[0]})}function s(e,t,r){var n,s=e[t],p=c.key2pos(t);switch(s.role){case"pawn":n=o(s.color);break;case"knight":n=u;break;case"bishop":n=l;break;case"rook":n=d;break;case"queen":n=f;break;case"king":n=i(s.color,a(e,s.color),r)}return c.allKeys.map(c.key2pos).filter(function(e){return(p[0]!==e[0]||p[1]!==e[1])&&n(p[0],p[1],e[0],e[1])}).map(c.pos2key)}Object.defineProperty(r,"__esModule",{value:!0});var c=e("./util"),u=function(e,t,r,o){var i=n(e,r),a=n(t,o);return 1===i&&2===a||2===i&&1===a},l=function(e,t,r,o){return n(e,r)===n(t,o)},d=function(e,t,r,n){return e===r||t===n},f=function(e,t,r,n){return l(e,t,r,n)||d(e,t,r,n)};r.default=s},{"./util":17}],13:[function(e,t,r){"use strict";function n(e){var t,r,n,f,v,h,g,m,b,y,w,k,P="white"===e.orientation,C=e.dom.bounds(),M=e.dom.elements.board,O=e.pieces,x=e.animation.current,_=x?x.plan.anims:{},D=x?x.plan.fadings:{},E=e.draggable.current,T=d(e),K={},A={},j={},S={},N=Object.keys(O);for(n=M.firstChild;n;){if(t=n.cgKey,o(n))f=O[t],g=_[t],m=D[t],v=n.cgPiece,!n.cgDragging||E&&E.orig===t||(n.classList.remove("dragging"),n.style.transform=p.translate(p.posToTranslate(p.key2pos(t),P,C)),n.cgDragging=!1),!m&&n.cgFading&&(n.cgFading=!1,n.classList.remove("fading")),f?(g&&n.cgAnimating&&v===l(f)?(h=p.posToTranslate(p.key2pos(t),P,C),h[0]+=g[1][0],h[1]+=g[1][1],n.style.transform=p.translate(h),n.classList.add("anim")):n.cgAnimating&&(n.style.transform=p.translate(p.posToTranslate(p.key2pos(t),P,C)),n.cgAnimating=!1,n.classList.remove("anim")),v!==l(f)||m&&n.cgFading?m&&v===l(m)?(n.classList.add("fading"),n.cgFading=!0):j[v]?j[v].push(n):j[v]=[n]:K[t]=!0):j[v]?j[v].push(n):j[v]=[n];else if(i(n)){var q=n.className;T[t]===q?A[t]=!0:S[q]?S[q].push(n):S[q]=[n]}n=n.nextSibling}for(var L in T)A[L]||(w=S[T[L]],k=w&&w.pop(),h=p.posToTranslate(p.key2pos(L),P,C),k?(k.cgKey=L,k.style.transform=p.translate(h)):M.insertBefore(s(L,T[L],h),M.firstChild));for(var W in N)if(t=N[W],r=O[t],g=_[t],!K[t])if(b=j[l(r)],y=b&&b.pop()){y.cgKey=t,y.cgFading&&(y.classList.remove("fading"),y.cgFading=!1);var B=p.key2pos(t);e.addPieceZIndex&&(y.style.zIndex=u(B,P)),h=p.posToTranslate(B,P,C),g&&(y.cgAnimating=!0,y.classList.add("anim"),h[0]+=g[1][0],h[1]+=g[1][1]),y.style.transform=p.translate(h)}else M.appendChild(c(e,r,t,P,g,C));for(var X in j)a(e,j[X]);for(var X in S)a(e,S[X])}function o(e){return"PIECE"===e.tagName}function i(e){return"SQUARE"===e.tagName}function a(e,t){for(var r in t)e.dom.elements.board.removeChild(t[r])}function s(e,t,r){var n=p.createEl("square",t);return n.cgKey=e,n.style.transform=p.translate(r),n}function c(e,t,r,n,o,i){var a=l(t),s=p.createEl("piece",a),c=p.key2pos(r);s.cgPiece=a,s.cgKey=r;var d=p.posToTranslate(c,n,i);return o&&(s.cgAnimating=!0,d[0]+=o[1][0],d[1]+=o[1][1]),s.style.transform=p.translate(d),e.addPieceZIndex&&(s.style.zIndex=u(c,n)),s}function u(e,t){var r=2+8*(e[1]-1)+(8-e[0]);return t&&(r=67-r),r+""}function l(e){return e.color+" "+e.role}function d(e){var t,r,n={};if(e.lastMove&&e.highlight.lastMove)for(t in e.lastMove)f(n,e.lastMove[t],"last-move");if(e.check&&e.highlight.check&&f(n,e.check,"check"),e.selected&&(f(n,e.selected,"selected"),e.movable.showDests)){var o=e.movable.dests&&e.movable.dests[e.selected];if(o)for(t in o)r=o[t],f(n,r,"move-dest"+(e.pieces[r]?" oc":""));var i=e.premovable.dests;if(i)for(t in i)r=i[t],f(n,r,"premove-dest"+(e.pieces[r]?" oc":""))}var a=e.premovable.current;if(a)for(t in a)f(n,a[t],"current-premove");else e.predroppable.current&&f(n,e.predroppable.current.key,"current-premove");var s=e.exploding;if(s)for(t in s.keys)f(n,s.keys[t],"exploding"+s.stage);return n}function f(e,t,r){e[t]?e[t]+=" "+r:e[t]=r}Object.defineProperty(r,"__esModule",{value:!0});var p=e("./util");r.default=n},{"./util":17}],14:[function(e,t,r){"use strict";function n(){return{pieces:o.read(o.initial),orientation:"white",turnColor:"white",coordinates:!0,autoCastle:!0,viewOnly:!1,disableContextMenu:!1,resizable:!0,addPieceZIndex:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,centerPiece:!0,showGhost:!0,deleteOnDropOff:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"https://lichess1.org/assets/piece/cburnett/"}},hold:i.timer()}}Object.defineProperty(r,"__esModule",{value:!0});var o=e("./fen"),i=e("./util");r.defaults=n},{"./fen":10,"./util":17}],15:[function(e,t,r){"use strict";function n(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function o(){x=""}function i(e,t){var r=e.drawable,n=r.shapes.concat(r.autoShapes).map(function(e){return{shape:e,current:!1,hash:c(e,!1)}});r.current&&n.push({shape:r.current,current:!0,hash:c(r.current,!0)});var o=n.map(function(e){return e.hash}).join("");if(o!==x){x=o;var i=t.firstChild;a(r,n,i),s(e,n,r.brushes,t,i)}}function a(e,t,r){var n,o={};t.forEach(function(t){t.shape.dest&&(n=e.brushes[t.shape.brush],t.shape.modifiers&&(n=b(n,t.shape.modifiers)),o[n.key]=n)});for(var i={},a=r.firstChild;a;)i[a.getAttribute("cgKey")]=!0,a=a.nextSibling;for(var s in o)i[s]||r.appendChild(h(o[s]))}function s(e,t,r,n,o){void 0===O&&(O=M.computeIsTrident());var i=e.dom.bounds(),a={},s=[];t.forEach(function(e){a[e.hash]=!1});for(var c,u=o.nextSibling;u;)c=u.getAttribute("cgHash"),a.hasOwnProperty(c)?a[c]=!0:s.push(u),u=u.nextSibling;s.forEach(function(e){return n.removeChild(e)}),t.forEach(function(t){a[t.hash]||n.appendChild(d(e,t,r,i))})}function c(e,t){var r=e.orig,n=e.dest,o=e.brush,i=e.piece,a=e.modifiers;return[t,r,n,o,i&&u(i),a&&l(a)].filter(function(e){return e}).join("")}function u(e){return[e.color,e.role,e.scale].filter(function(e){return e}).join("")}function l(e){return""+(e.lineWidth||"")}function d(e,t,r,n){var o,i=t.shape,a=t.current,s=t.hash;if(i.piece)o=v(e.drawable.pieces.baseUrl,m(M.key2pos(i.orig),e.orientation),i.piece,n);else{var c=m(M.key2pos(i.orig),e.orientation);if(i.orig&&i.dest){var u=r[i.brush];i.modifiers&&(u=b(u,i.modifiers)),o=p(u,c,m(M.key2pos(i.dest),e.orientation),a,n)}else o=f(r[i.brush],c,a,n)}return o.setAttribute("cgHash",s),o}function f(e,t,r,o){var i=C(t,o),a=y(r,o),s=(o.width+o.height)/32;return g(n("circle"),{stroke:e.color,"stroke-width":a,fill:"none",opacity:k(e,r),cx:i[0],cy:i[1],r:s-a/2})}function p(e,t,r,o,i){var a=P(i,o),s=C(t,i),c=C(r,i),u=c[0]-s[0],l=c[1]-s[1],d=Math.atan2(l,u),f=Math.cos(d)*a,p=Math.sin(d)*a;return g(n("line"),{stroke:e.color,"stroke-width":w(e,o,i),"stroke-linecap":"round","marker-end":O?void 0:"url(#arrowhead-"+e.key+")",opacity:k(e,o),x1:s[0],y1:s[1],x2:c[0]-f,y2:c[1]-p})}function v(e,t,r,o){var i=C(t,o),a=o.width/8*(r.scale||1),s=r.color[0]+("knight"===r.role?"n":r.role[0]).toUpperCase();return g(n("image"),{className:r.role+" "+r.color,x:i[0]-a/2,y:i[1]-a/2,width:a,height:a,href:e+s+".svg"})}function h(e){var t=g(n("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return t.appendChild(g(n("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function g(e,t){for(var r in t)e.setAttribute(r,t[r]);return e}function m(e,t){return"white"===t?e:[9-e[0],9-e[1]]}function b(e,t){var r={color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth)};return r.key=[e.key,t.lineWidth].filter(function(e){return e}).join(""),r}function y(e,t){return(e?3:4)/512*t.width}function w(e,t,r){return(e.lineWidth||10)*(t?.85:1)/512*r.width}function k(e,t){return(e.opacity||1)*(t?.9:1)}function P(e,t){return O?0:(t?10:20)/512*e.width}function C(e,t){return[(e[0]-.5)*t.width/8,(8.5-e[1])*t.height/8]}Object.defineProperty(r,"__esModule",{value:!0});var M=e("./util");r.createElement=n;var O,x="";r.clearCache=o,r.renderSvg=i},{"./util":17}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.files=["a","b","c","d","e","f","g","h"],r.ranks=[1,2,3,4,5,6,7,8]},{}],17:[function(e,t,r){"use strict";function n(e){var t,r=function(){return void 0===t&&(t=e()),t};return r.clear=function(){t=void 0},r}function o(e,t){return!!e&&e.indexOf(t)!==-1}Object.defineProperty(r,"__esModule",{value:!0});var i=e("./types");r.colors=["white","black"],r.invRanks=[8,7,6,5,4,3,2,1],r.allKeys=(a=Array.prototype).concat.apply(a,i.files.map(function(e){return i.ranks.map(function(t){return e+t})})),r.pos2key=function(e){return r.allKeys[8*e[0]+e[1]-9]},r.key2pos=function(e){return[e.charCodeAt(0)-96,e.charCodeAt(1)-48]},r.memo=n,r.timer=function(){var e;return{start:function(){e=new Date},cancel:function(){e=void 0},stop:function(){if(!e)return 0;var t=Date.now()-e.getTime();return e=void 0,t}}},r.opposite=function(e){return"white"===e?"black":"white"},r.containsX=o,r.distanceSq=function(e,t){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)},r.samePiece=function(e,t){return e.role===t.role&&e.color===t.color},r.computeIsTrident=function(){return window.navigator.userAgent.indexOf("Trident/")>-1},r.posToTranslate=function(e,t,r){return[(t?e[0]-1:8-e[0])*r.width/8,(t?8-e[1]:e[1]-1)*r.height/8]},r.translate=function(e){return"translate("+e[0]+"px,"+e[1]+"px)"},r.translateAway=r.translate([-99999,-99999]),r.eventPosition=function(e){return e.clientX||0===e.clientX?[e.clientX,e.clientY]:e.touches&&e.targetTouches[0]?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0},r.isRightButton=function(e){return 2===e.buttons||2===e.button},r.createEl=function(e,t){var r=document.createElement(e);return t&&(r.className=t),r},r.raf=(window.requestAnimationFrame||window.setTimeout).bind(window);var a},{"./types":16}],18:[function(e,t,r){"use strict";function n(e,t,r){e.innerHTML="",e.classList.add("cg-board-wrap"),i.colors.forEach(function(r){e.classList.toggle("orientation-"+r,t.orientation===r)}),e.classList.toggle("manipulable",!t.viewOnly);var n=i.createEl("div","cg-board");e.appendChild(n);var c;if(t.drawable.enabled&&(c=s.createElement("svg"),c.appendChild(s.createElement("defs")),e.appendChild(c)),t.coordinates){var u="black"===t.orientation?" black":"";e.appendChild(o(a.ranks,"ranks"+u)),e.appendChild(o(a.files,"files"+u))}var l;t.viewOnly||!t.movable.showDests&&!t.premovable.showDests||(l=i.createEl("div","over"),l.style.transform=i.translateAway,l.style.width=r.width/8+"px",l.style.height=r.height/8+"px",e.appendChild(l));var d;return!t.viewOnly&&t.draggable.showGhost&&(d=i.createEl("piece","ghost"),d.style.transform=i.translateAway,e.appendChild(d)),{board:n,over:l,ghost:d,svg:c}}function o(e,t){var r,n=i.createEl("coords",t);for(var o in e)r=i.createEl("coord"),r.textContent=e[o],n.appendChild(r);return n}Object.defineProperty(r,"__esModule",{value:!0});var i=e("./util"),a=e("./types"),s=e("./svg");r.default=n},{"./svg":15,"./types":16,"./util":17}]},{},[11])(11)});