@(puzzle: lila.puzzle.Puzzle, attempt: Option[lila.puzzle.Attempt], userInfos: Option[lila.puzzle.UserInfos], win: Option[Boolean])(implicit ctx: Context)

<div id="puzzle"
  data-mode="view"
  data-fen="@puzzle.fen"
  data-color="@puzzle.color"
  data-move="@puzzle.initialMove"
  data-lines="@lila.puzzle.Line.toJsonString(puzzle.lines)"
  data-new-url="@routes.Puzzle.newPuzzle">

  <div class="side">
    @trainingBox(userInfos)
    @win.map { w =>
    @if(w) {
    <p class="comment win"><strong>Victory!</strong></p>
    } else {
    <p class="comment loss"><strong>Puzzle failed</strong></p>
    }
    }.getOrElse {
    @attempt.map { a =>
    @if(a.win) {
    <p class="comment win"><strong>Victory!</strong>Puzzle solved in @showMillis(a.time) seconds.</p>
    } else {
    <p class="comment loss"><strong>Puzzle failed</strong></p>
    }
    }
    }
  </div>

  <div class="center">

    <div id="chessboard"></div>

    <div class="prev_next">
      <button class="prev button" value="prev">&lt;</button>
      <button class="next button" value="next">&gt;</button>
    </div>

    @userInfos.map(history(_))

  </div>

  <div class="right">
    <div class="box">
      <div class="vote_wrap">@vote(puzzle, attempt)</div>
      <h2 class="puzzle_link">
        <a href="@routes.Puzzle.show(puzzle.id)">Puzzle @puzzle.id</a>
      </h2>
      <p>
        Rating: <strong>@puzzle.perf.intRating</strong>
        <small title="Glicko rating deviation"> Â±@puzzle.perf.glicko.intDeviationDoubled</small>
      </p>
      <p>
        Played <strong>
          @puzzle.attempts match {
          case 1 => { once }
          case 2 => { twice }
          case x => { @x times }
          }
        </strong>
      </p>
      <p>
        Win rate: <strong>@puzzle.winPercent</strong>%
      </p>
      <p>
        Average time: <strong>@showMillis(puzzle.time)</strong> seconds
      </p>
    </div>
    <div class="continue_wrap">
      @if(win.isDefined) {
      <a class="continue button" href="@routes.Puzzle.home">Start training &#9654;</a>
      } else {
      <button class="continue button">Continue training &#9654;</button>
      }
      @if(win.fold(attempt.exists(_.loss))(!_)) {
      <a class="retry" href="@routes.Puzzle.show(puzzle.id)">Retry this puzzle</a>
      }
    </div>
  </div>

</div>
