@(u: User, playing: Option[Pov], blocked: Boolean, followable: Boolean, rel: Option[lila.relation.Relation], ping: Option[Int], crosstable: Option[lila.game.Crosstable])(implicit ctx: Context)
<div class="title">
  <div>
    @defining((u.lameOrTroll || u.disabled) && isGranted(_.UserSpy)) { trollIcons =>
      @if(trollIcons) { <span class="mod_user_state"> @userMarks(u, None) </span>}
      @ping.map { p => @signalBars(p) }
      @u.profileOrDefault.countryInfo.map { c =>
        @defining(!trollIcons && u.username.size + c.shortName.size < 20) { spaceForNameText =>
          <span @if(!spaceForNameText){class="country hint--top" data-hint="@c.name"} else {class="country"}>
            <img class="flag" src="@staticUrl(s"images/flags/${c.code}.png")" alt="@c.name" />
            @if(spaceForNameText) { @c.shortName }
          </span>
        }
      }
    }
    @userLink(u, withPowerTip = false, cssClass =
      if (u.disabled) "closed_user".some
      else if (isGranted(_.UserSpy) && !u.title && !u.createdSinceDays(7)) "new_user".some
      else None
    )
  </div>
  @defining(u.engine && ctx.me.fold(true)(u !=)) { showEngine =>
     @if(showEngine) { <div class="warning" data-icon="j">@trans.thisPlayerUsesChessComputerAssistance()</div> }
     @if(!showEngine || isGranted(_.UserSpy)) {
       <div class="ratings">
        @u.best8Perfs.map { pt =>
          @showPerfRating(u, pt)
        }
       </div>
     }
  }
</div>
@if(!ctx.pref.isBlindfold) {
@playing.map { pov =>
@gameFen(pov)
<div class="game_legend">
  @playerText(pov.opponent, withRating = true)
  @pov.game.clock.map { c =>
  â€¢ @c.config.show
  }
</div>
}
}
@ctx.userId.map { myId =>
@crosstable.filter(_.nonEmpty).map { cross =>
<a class="score hint--bottom" href="@routes.User.games(u.username, "me")#games" data-hint="@trans.nbGames.plural(cross.nbGames, cross.nbGames.localize)">
  @trans.yourScore {
  <strong>@cross.showScore(myId)</strong> - <strong>@cross.showOpponentScore(myId)</strong>
  }
</a>
}

@if(isGranted(_.UserSpy)) {
 <div class="mod_info_box">
  <p>@trans.nbGames.plural(u.count.game, u.count.game.localize)</p>
  <p>Created: @momentFromNow(u.createdAt)</p>
  @u.seenAt.map { seen => <p>Active: @momentFromNow(seen)</p> }
</div>
}

@if(myId != u.id) {
<table class="actions">
  <tbody>
    <tr>
      <td>
        <a class="button hint--bottom" data-hint="@trans.watchGames()" href="@routes.User.tv(u.username)">
          <span data-icon="1"></span>
        </a>
      </td>
      @if(!blocked) {
      <td>
        <a class="button hint--bottom" data-hint="@trans.chat()" href="@routes.Message.form()?user=@u.username">
          <span data-icon="c"></span>
        </a>
      </td>
      <td>
        <a class="button hint--bottom" data-hint="@trans.play()" href="@routes.Lobby.home()?user=@u.username#friend">
          <span data-icon="U"></span>
        </a>
      </td>
      }
      <td class="relation_actions">@relation.mini(u.id, blocked, followable, rel)</td>
    </tr>
  </tbody>
</table>
}
}
