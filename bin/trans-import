#!/usr/bin/env ruby

require 'fileutils' 
include FileUtils

lichess_dir = File.expand_path(pwd() + '/../lichess')
lichess_trans_dir = lichess_dir + '/src/Bundle/LichessBundle/Resources/translations'

lila_dir = pwd()
lila_trans_dir = lila_dir + '/conf'

puts 'Import translations'
puts 'from ' + lichess_trans_dir 
puts 'to ' + lila_trans_dir

Dir[lila_trans_dir + '/messages.*'].each { |file| File.delete(file) }

Dir[lichess_trans_dir + '/*'].each { |file| 
  lang = file.gsub(/[\w\/]+\.(\w{2,3})\.yml/, '\1')
  lines = File.open(file).readlines.map { |l|
    parts = l.split('":').each { |p| p.strip.gsub('"', '') }
    key = parts[0].downcase.strip
    .gsub(' ', '.')
    .gsub(/[^\w\.]/, '')
    .gsub(/\.{2,}/, '.')
    val = parts[1].gsub('"', '').strip
    key + '=' + val
  }
  if lang == 'frp' then lang = 'fp' end
  new_file = lila_trans_dir + '/messages.' + lang
  text = lines.join("\n")
  File.open(new_file, 'w') { |f| f.puts text }
}
