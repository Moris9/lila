#!/usr/bin/env ruby

require 'fileutils'
include FileUtils

lila_dir = pwd()
lila_source_file = lila_dir + '/translation/source/site.csv'
lila_keys_file = lila_dir + '/modules/i18n/src/main/I18nKeys.scala'

code = """// Generated with bin/gen/trans-dump at #{Time.new.utc}
package lila.i18n

object I18nKeys {

  def untranslated(message: String) = new Untranslated(message)

%vals%
}
"""

puts 'Dump translation keys to scala'

def literal(s)
  '`' + s + '`'
end

lines = File.open(lila_source_file).readlines
keys = lines.map { |l| l.gsub(/(\w+),.+/, '\1').strip }
if keys.uniq.length != keys.length
  abort '[ERROR] Duplicate translation key detected!'
end
vals = keys.map { |k| '  val ' + literal(k) + ' = new Translated("' + k + '")' }
allCode = code.gsub(/%vals%/, vals.join("\n"))

File.open(lila_keys_file, 'w') { |f| f.puts allCode }
