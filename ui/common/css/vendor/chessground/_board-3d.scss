$td-height-ratio: 464.5 / 512;
$td-height-percent: $td-height-ratio * 100%;

.is3d .main-board {
  padding-bottom: $td-height-percent;
}
.is3d .cg-board-wrap coords.files {
  bottom: calc(-12px - 3%);
}
.is3d .cg-board-wrap coords.ranks {
  height: 100%;
}
.is3d piece {
  /* original size:
  width: 140.625%;
  height: 179.6875%; */
/* size on 3D board, with height/width = 90.78571% */
width: 16.741%;
height: 23.563%;
left: -1.85%;
top: -9.1%;
}
.is3d piece.dragging,
.is3d #promotion_choice {
  z-index: z('cg__piece.dragging.3d');
}
.is3d .is2d piece {
  /* copy of board.css to override miniboards */
  left: 0;
  top: 0;
  width: 12.5%;
  height: 12.5%;
}
.is3d .cg-board::before {
  position: absolute;
  top: -0.730688%;
  left: 0;
  width: 100%;
  height: 103.2%;
  content: '';
  background-size: cover;
}
.is3d .is2d .cg-board {
  /* copy of board.css to override miniboards */
  top: 0;
  height: 100%;
}
.is3d .is2d .cg-board::before {
  content: none;
}

$board-files: (
'Black-White-Aluminium',
'Brushed-Aluminium',
'China-Blue',
'China-Green',
'China-Grey',
'China-Scarlet',
'China-Yellow',
'Classic-Blue',
'Transparent-Glass',
'Gold-Silver',
'Green-Glass',
'Light-Wood',
'Power-Coated',
'Purple-Black',
'Rosewood',
'Wood-Glass',
'Wax',
'Jade',
'Marble',
'Woodi',
);
@each $name in $board-files {
  .#{$name} .is3d .cg-board::before {
    background-image: img-url('staunton/board/#{$name}.png');
  }
}

$piece-files: (
'Staunton': false,
'Basic': true,
'Experimental': true,
'Glass': true,
'Metal': true,
'ModernJade': true,
'ModernWood': true,
'RedVBlue': true,
'Trimmed': true,
'Wood': true,
'CubesAndPi': true,
);
@each $name, $flips in $piece-files {
  @each $color in ('White', 'Black') {
    @each $type in ('Pawn', 'Bishop', 'Knight', 'Rook', 'Queen', 'King') {
      .#{$name} .is3d .#{to-lower-case($type)}.#{to-lower-case($color)} {
        background-image: img-url('staunton/piece/#{$name}/#{$color}-#{$type}.png');
      }
    }
    @if $flips {
      @each $color, $orientation in ('White': 'black', 'Black': 'white') {
        @each $type in ('Bishop', 'Knight') {
          .#{$name} .is3d .main-board .orientation-#{$orientation} .#{to-lower-case($type)}.#{to-lower-case($color)} {
            background-image: img-url('staunton/piece/#{$name}/#{$color}-#{$type}-Flipped.png');
          }
        }
      }
    }
  }
}

.is3d #promotion_choice piece {
  width: 140.625%;
  height: 197.925%;
  top: 0;
  left: -18%;
  transform: scale(0.7) translateY(-45%);
  background-position: 0 -6px;
}

.is3d div.current_player piece {
  width: 100%;
  height: 132%;
  left: 0;
  top: -6px;
  background-size: cover;
  background-position: 0 67%;
}
