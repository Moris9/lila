package org.lichess.compression.game;

class ZobristHash {
    public static int hashBoard(Board board) {
        return hashPieces(board) ^ hashCastling(board) ^ hashTurn(board) ^ hashEnPassant(board);
    }

    public static int hashPieces(Board board) {
        int hash = 0;
        long occupied = board.occupied;
        while (occupied != 0) {
            int sq = Bitboard.lsb(occupied);
            hash ^= hashPiece(sq, board.whiteAt(sq), board.roleAt(sq));
            occupied ^= 1L << sq;
        }
        return hash;
    }

    public static int hashPiece(int square, boolean color, Role role) {
        int index = role.index * 2 + (color ? 1 : 0);
        return POLYGLOT[64 * index + square];
    }

    public static int hashCastling(Board board) {
        int hash = 0;
        long cr = board.castlingRights;
        if (Bitboard.contains(cr, Square.H1)) hash ^= POLYGLOT[768];
        if (Bitboard.contains(cr, Square.A1)) hash ^= POLYGLOT[768 + 1];
        if (Bitboard.contains(cr, Square.H8)) hash ^= POLYGLOT[768 + 2];
        if (Bitboard.contains(cr, Square.A8)) hash ^= POLYGLOT[768 + 3];
        return hash;
    }

    public static int hashTurn(Board board) {
        return board.turn ? POLYGLOT[780] : 0;
    }

    public static int hashEnPassant(Board board) {
        return board.hasLegalEnPassant() ? POLYGLOT[772 + Square.file(board.epSquare)] : 0;
    }

    // The lower 32 bits of polyglot compatible pseudo random masks for
    // Zobrist hashing.
    public static final int POLYGLOT[] = {
        0x33776D41, 0x05AAA5C7, 0x24623547, 0x62A76AE2,
        0x489C0C89, 0x203001BF, 0x61042279, 0xF2FB60CA,
        0x58755C10, 0xCEAFE02D, 0xE25EC3B0, 0xD13A2ED5,
        0x4A672E32, 0x6FD56395, 0x46F3D9E5, 0x7FF719CC,
        0x85B49AA1, 0x6E8FC971, 0x801FED0B, 0xC3B7ADF0,
        0x781EB7CC, 0x9510786C, 0xAF51BBE6, 0xE7219443,
        0xBCFD50FC, 0x52AFD40B, 0x81D79217, 0xD3E92AE1,
        0x62B19ABF, 0x42047AC4, 0x1A09D85D, 0x4DA27500,
        0x7501B447, 0x3C910841, 0x461CBD93, 0xB0F1850F,
        0xFF93C040, 0x3DD90A94, 0x34A1DD3B, 0xA4C45A23,
        0xF1BD400B, 0x59BF02E7, 0xCE9B6555, 0xFE5D8244,
        0x7454A824, 0xB9BA3035, 0xDB9AB0FA, 0x3430B241,
        0xB9BA3DDE, 0x081B3075, 0x167C33E7, 0x83024E20,
        0xC351BD7F, 0x2C76A243, 0x0F32A7B8, 0x0CC37E5D,
        0x63689F2F, 0xE2919661, 0x36E4D951, 0x98171BB6,
        0x79F92F88, 0x7356388B, 0x8D231B78, 0xEA98AD76,
        0xC2A82DC7, 0x5A997142, 0xA8A7ED5E, 0xA25A7F3C,
        0x8CF4B6D4, 0xDECFC0D9, 0xEE0E41F7, 0x01E7D1E8,
        0x777D5776, 0xCCDEA195, 0x201752FC, 0xF9C8D3F6,
        0xF03912EA, 0x95C980D9, 0xBFBF7CC4, 0xF4243939,
        0x91165C3F, 0xB9744FF1, 0x5F40D873, 0x127FED2B,
        0x7B411F47, 0x9A24EAA1, 0xF04F21F5, 0x99A075C2,
        0xB5C907B1, 0xC54F48B8, 0xCC3F7CF2, 0x47267BBD,
        0xB49E2AE9, 0x237F3859, 0xF8ED14D0, 0xF03CC54E,
        0x4DB49C89, 0x0B0B38ED, 0x4D01144B, 0x712768E9,
        0x1FA78984, 0x64E78CB3, 0x35DAFB04, 0x0B3738C4,
        0x83023A08, 0x9CEFF80C, 0x89889342, 0xA3A701D6,
        0x40750644, 0x9CDBF4A7, 0xF00C20F2, 0xE03680EC,
        0xE7316243, 0x7DB91B77, 0x15630A75, 0xCE9573F7,
        0x899A2F8A, 0xE705B824, 0x5580EF7F, 0x8477609D,
        0x5BC93F31, 0xF3428A8C, 0x60087B73, 0xFF328532,
        0x0CC0EBA0, 0x35DD359E, 0x15B290CC, 0x16591CBD,
        0xE1A1AA8D, 0x633B8F81, 0xD45DF7AF, 0xF24F1768,
        0xE8EB7462, 0xCFD75EA1, 0x7468AA70, 0x4BC8D8FC,
        0x54CF2DD9, 0x01165F1C, 0x8FB99929, 0x6AC10365,
        0x5B7605F6, 0xAEF53302, 0xD6C55602, 0x691CCB7A,
        0x92EFEE56, 0x3C7E11AE, 0xCAD004F6, 0xF420E565,
        0x7DA94E3C, 0x9ECB6350, 0xE0ED804A, 0xBE0BB7DD,
        0x724FA456, 0xF11A2741, 0xF0B7DAB3, 0xF729ABD4,
        0x08F6A2BC, 0xCC5C2858, 0xB7F5BE2A, 0x563DFE43,
        0xE451497F, 0xDFF1E840, 0x5F2CE6F0, 0x747D5AF3,
        0x8682C115, 0xE836994F, 0x3FE09017, 0x9B671A1C,
        0x712457C3, 0xC31FB4B4, 0xE64A6E7C, 0xABE61C87,
        0x3A522A20, 0x1598AA4F, 0x71B368FD, 0x02E086A0,
        0x2AEB8D31, 0x4BC1C44B, 0x8D079F23, 0x177326B3,
        0x03EB6064, 0xE53C8E1B, 0x64268D99, 0xBC9474E8,
        0xFC5558CA, 0x58FC4E76, 0xA4C03DFE, 0xACC67C96,
        0x4B8655FB, 0xC4D24417, 0x17456ED0, 0x2924E97E,
        0x42A7444E, 0xE7CAD29E, 0x362F05FA, 0x38336615,
        0x3A129ACE, 0x1E04DF75, 0x784BA010, 0x8871B59D,
        0xDED1F73F, 0x3BC373F8, 0x8C0CEB81, 0xD210FFA7,
        0xFF4728E7, 0xC312AC71, 0xE437FDB5, 0x7F6A35B3,
        0xA5BF7859, 0x6C453A21, 0x8A0FD54E, 0xD9A2E38C,
        0xDE437BA2, 0xBF8A4424, 0x573FA594, 0x9F495AC3,
        0x1A00930D, 0x2EB642C1, 0x3261169F, 0xD27579E2,
        0x076F5B6F, 0xB6F65BA2, 0x4AB5F9B1, 0x09DD038A,
        0x9FCFAFB1, 0x7CC2C6BD, 0x4C70E331, 0x3F692F12,
        0x4B20A45B, 0x02C5807B, 0xB9613989, 0xFC557F73,
        0xF572C348, 0x1107FE97, 0xEC0C9BA2, 0xE8F7F2D6,
        0x58B920A0, 0x658A5698, 0xF9715A4C, 0x9D887AAE,
        0xBDB619CB, 0x1C60BA83, 0x5904AD3C, 0x3B51B9E2,
        0xCD974924, 0x6FFC6A79, 0xC66ED37E, 0x5873D484,
        0x3519AC6E, 0xD0F20CC5, 0x25D89021, 0xADB73615,
        0xDCC0F019, 0xAEF98FFB, 0xBE000731, 0x6DDF285A,
        0xEBF78BAF, 0x149BBA21, 0xBD791E33, 0xF0977996,
        0x344A6EED, 0xB9CFA741, 0x1D78C5DE, 0xB3034D07,
        0xA48FA6E9, 0x700CFF4E, 0x4E31188A, 0x6ABCA345,
        0x89C432E0, 0xFEBF21B8, 0x336139D3, 0x464EE52E,
        0xDC314222, 0xCA418FC0, 0x91E513AF, 0x4B609F93,
        0x364E3228, 0x887E8175, 0x8531294B, 0x397BBA52,
        0xDAF3CEBD, 0xA97511E2, 0x93D6F6A7, 0x1C38434D,
        0xBEDC4FF5, 0x16C524D2, 0xE2F2EA28, 0xC3115544,
        0xE7C6A9F9, 0x6E6F8794, 0x28B03343, 0xDE89EA27,
        0x84119414, 0x1292ED4F, 0x8E17DEBC, 0x64A76E94,
        0xEE56E63C, 0xF9475F5F, 0xA91F81CA, 0x3D9808E4,
        0xEDC29FCA, 0xACA0B0B9, 0xB4516E84, 0x871448AF,
        0x05542E4E, 0xD7254B59, 0x0D532280, 0x7F2D34F3,
        0x28297551, 0x7DD949BF, 0x19C5126A, 0xCC2BDECB,
        0x2819E230, 0x007503B8, 0x0A5061CB, 0x32CD8021,
        0xBC76492F, 0x4DA55CC9, 0x064FCF56, 0x1FFF6580,
        0x1955C4BF, 0x6430F69D, 0xE8A45C0A, 0xB780A08D,
        0xF03CE0BB, 0x5E1419C7, 0x2CF3D73F, 0x70E59750,
        0x7905E790, 0x8A1F45EC, 0xCB045B00, 0xD5E2B207,
        0xF016D66D, 0x9328A0AC, 0xBCDE44B7, 0x39BA63B1,
        0xCD53486A, 0xFD719F85, 0x27357AFA, 0xC8B35EBD,
        0xC6B9C28D, 0x43B17F26, 0xF89695A2, 0x4A98307F,
        0xCFF6F36E, 0x29AF48AD, 0xD9704A68, 0xAF2F8B1C,
        0x1E43A07E, 0xDEE33360, 0xD0C20584, 0xAB90A559,
        0x35C6A72F, 0x94A70F4D, 0x376FA72B, 0xF030BC24,
        0x32503B12, 0xB81CCB94, 0xF70902CB, 0x438E9B24,
        0x892D95D7, 0x91F2B3F1, 0x7B9C3403, 0x60284A1C,
        0x50659AE7, 0x96A8736D, 0x6509A440, 0x72E9052F,
        0x9930578C, 0x2D49EECD, 0x81EA17FE, 0x74B14AEF,
        0xFC6F290F, 0xB2C0CF57, 0xBA5E0CA7, 0x3EAFB413,
        0x1D31AB39, 0x21F40CB4, 0x2537DF62, 0x6D1D6E03,
        0x0041E8A9, 0x8F7515D7, 0x7AD310D1, 0x1EBE1327,
        0x1C5157B1, 0x903D0C25, 0xD068F707, 0x79893389,
        0x8DD05F34, 0x52DC25E5, 0x7F98E5E9, 0x3851A492,
        0x447822BF, 0xF82CA382, 0x167B4C84, 0x048EAC50,
        0x369FFEBD, 0x0904BF45, 0x1817EEE7, 0x77DDA93D,
        0x6E65C744, 0x04E5E932, 0xF8D6F2BA, 0x8CAAC9E9,
        0x5A6507FF, 0x4ED681DA, 0xCCEF96CB, 0x4D259236,
        0xB0B4DB31, 0x1F12DD5E, 0xB32781A5, 0x285279F5,
        0x790C0EFE, 0x3C94938A, 0x1CC0542C, 0x6508C4FE,
        0xDF48229F, 0xE43CAC40, 0x6EF6748F, 0xF3318DEA,
        0x48F296BF, 0x5957B511, 0x3260B45C, 0xCFB56DAE,
        0x989993E0, 0x5B93CAE6, 0xAE538BBE, 0xCE371425,
        0x2DDFB636, 0xE72CD38C, 0xB7552210, 0xAB3B546D,
        0x5FBF70E2, 0x4FB7AC9E, 0x2B941148, 0x03D9BEA0,
        0x7FA4F3A6, 0x70A9BE8B, 0x57EF4743, 0x32D29981,
        0xFDF5ADFE, 0x04EC9F9D, 0x08D1908C, 0x59D80055,
        0x20A3A545, 0xBDF4C5CE, 0xD6FC5C5C, 0x305E2AB6,
        0x35AB96DE, 0x83325753, 0xC617C699, 0x9E7557E3,
        0x81680AF8, 0xA9E724E5, 0x0D681639, 0xD140CAEA,
        0x9DC91335, 0x4473F5D2, 0x44D5AEFE, 0x3910DA55,
        0x1F6EC39A, 0xBAA28D97, 0xC85BAFAB, 0x740847D5,
        0xA60CD889, 0x42A3E4C1, 0xBADC0805, 0xB602C329,
        0x9CDDD023, 0x9EAFEA22, 0x6FFC81BD, 0x0A333A9D,
        0x6517DB90, 0x8816EDBB, 0x4DC089C8, 0x259B27DE,
        0x801EB9AA, 0x10CAB243, 0x21A42B0E, 0xA4FA6800,
        0x3173E0CE, 0x7C5A3603, 0x32ADAA8A, 0xC7204C4B,
        0x4D44885D, 0xE660F855, 0xEC8941C3, 0xB0DFB40D,
        0x7C2D0484, 0xB459AEB5, 0xCC1D45EC, 0xAE3D6174,
        0x01731A28, 0xCB948F09, 0x052F6E9F, 0x60A968E3,
        0xDDE06FF1, 0x06A2068D, 0xFBD986E0, 0x3CE802D7,
        0x0116F336, 0x624EC390, 0xE6116AC7, 0x10F5FB53,
        0xDF4321C7, 0xEE587A30, 0x17AF9924, 0xD8520548,
        0xE4B1B4EF, 0x95091A36, 0x26F14431, 0xAF9418C2,
        0xC7350524, 0x57A764D5, 0xF17F58EE, 0x2D36D310,
        0xCE64A656, 0x0D9F04BB, 0x6D113600, 0xE7E4586E,
        0x26C619BF, 0xF088F94E, 0x30BE846E, 0x3AF5F6F4,
        0x61B3F743, 0xE9E4FA16, 0xBFF53B55, 0x4AD1E87D,
        0x72D2E822, 0x10E5CA30, 0x6CB569D8, 0xCD894A29,
        0x3E224774, 0x0F91B123, 0x50275779, 0xB9E9D4FB,
        0xE2FBFCE1, 0xCD97FB09, 0x5FD64E6B, 0x6017F67F,
        0xDB084E9B, 0xB25396C1, 0xC2D5BCF0, 0xF7A2322E,
        0x05E69B5F, 0x06F90CF3, 0x6A6591E9, 0x0421AFF3,
        0x7C66E300, 0xE27E0D48, 0x8B888B20, 0xAF287E07,
        0x6FFDB432, 0x66DF6C0A, 0x001332C8, 0xA48DB6CF,
        0x34305C14, 0xC97DF93D, 0xAE4E125B, 0x88572E0B,
        0x507A8359, 0xE045F54D, 0xC0DFF5D1, 0x55326F9F,
        0x6DA814BA, 0x083F4558, 0x81E2C590, 0x39F7D952,
        0x764CA04B, 0xFAE4FA77, 0xC3E56167, 0x03B33FD9,
        0x9FB69F6D, 0xA61EA5EF, 0xBFAF7F5B, 0xEB4D7A59,
        0x1B637FB3, 0x36D8B9CA, 0xEA8838B3, 0xD96B9F63,
        0xA57D1D13, 0xE3E2B3FB, 0x0F0946BE, 0x6F4D2EAA,
        0x1CC609DB, 0x5A371195, 0x649A260E, 0xB7F5C5CA,
        0x380841EE, 0x73F910A3, 0x77671A17, 0xFA3469F8,
        0x0EF4CDCF, 0x4377B28C, 0x199B8175, 0xD90E8B1D,
        0x7A19255F, 0x5A314CD1, 0x16235097, 0xFF7296E2,
        0xB672E811, 0x6BF68235, 0xC6ECC6B0, 0x9134DFB6,
        0x83A7DE39, 0x30A12104, 0xA0AB4067, 0xAFF07862,
        0x0A16DA0B, 0x052B8E7B, 0xFE30E3F5, 0x95AD0CF8,
        0xBAD6BF27, 0x5BB9C169, 0x56B9AE70, 0x5A213CF6,
        0x2777B874, 0x94AF1EED, 0x26A50E68, 0xF06791ED,
        0x696703D3, 0xE70757A7, 0x6120F37D, 0x92607890,
        0x15F6DC9C, 0x965C6B65, 0x184CCCF4, 0x73F24C13,
        0x4A9A80D2, 0x1FD6109C, 0x6BB8417E, 0x5EC05779,
        0x001A4778, 0x064480CA, 0xFFCFC14A, 0x061A9E60,
        0xA9F2FE9B, 0x7797DA9B, 0x078735A1, 0xBFC73A66,
        0xFBA08D33, 0x0FAE657D, 0xBCB05C63, 0x4D2DBC4F,
        0x35F6A8C9, 0xC8E63528, 0x0E7A8D6B, 0x7651DD7E,
        0x7CB39E2D, 0x062DC67D, 0x132D0A26, 0x67E2F199,
        0x1914F7AF, 0xF3EEAB37, 0xE272B933, 0x4AE8AE5F,
        0x1170FC20, 0x85818A06, 0x3F900978, 0xADA5156E,
        0xB0364963, 0x93AE7DC1, 0xF8B383F2, 0x87A1EE60,
        0xFF26DA89, 0x69AE2C15, 0x544C19F9, 0x90CF2456,
        0x7ED25117, 0x7B72F0C1, 0xB7097475, 0x881EDB4F,
        0x6EB5DBCB, 0x157064C8, 0x1E7F268B, 0xEDFE552C,
        0x9624C7DA, 0x3E203C94, 0x5071D263, 0x16EEFC89,
        0x31714200, 0xA332F41C, 0x1555A786, 0x5D120902,
        0xB49C9921, 0x355FC492, 0x435DCB0F, 0x43848A2C,
        0x6B33BE31, 0xB05A2E7D, 0xD2B1FB18, 0xC2E134B1,
        0xE59AEA61, 0xA0D7C22F, 0x3B5E0B35, 0xED5C0860,
        0xAC8D77B0, 0xEBF4A71E, 0x2158C4A6, 0x46BF719E,
        0x09FE5557, 0x921549FF, 0x92903BA4, 0xC14F0A3A,
        0xF97AAFAE, 0x055B6960, 0xDDD2CDB4, 0x9FE96B5F,
        0x3132C498, 0xDB6F7503, 0x217A360E, 0x6EBB1148,
        0x3AA5E00D, 0xCC42261A, 0xE78FEAAE, 0xD96BD438,
        0x5D8F45DA, 0xD2DEEEB4, 0xA82E1C84, 0xAF453CE9,
        0x81949A4C, 0x734B3C84, 0x81CE5FBD, 0x925E319E,
        0xFC32F791, 0xA6F3B3F2, 0x61725606, 0xCC3D6780,
        0x8EFDFC80, 0xC02BA980, 0x29A2DDF7, 0x22CD065A,
        0x7844F20C, 0xB70019B0, 0xA6CFE6AD, 0xC5C217F6,
        0x5F29BC2B, 0x8C94094B, 0xBFE39272, 0x4EE20D06,
        0xBAA4BF37, 0xB0DEE640, 0xFCF90BC6, 0x99C2585D,
        0x7A2B6D79, 0x292504D5, 0x71471A6F, 0xB4561E00,
        0xCA0712DC, 0xBB2E8988, 0x47F2BA08, 0x41E50E8C,
        0xAB9DEC26, 0x382595F4, 0x24FE7AC9, 0xFF7A7C3D,
        0x857FA9E7, 0xEAE45305, 0xC4BBB92E, 0x90D20B07,
        0x75AFE51A, 0x3C334074, 0x12884624, 0xD6573DA5,
        0xAF35E149, 0xF3ED091B, 0xF8886C61, 0xC8FFE65F,
        0x64B2C310, 0xDF898190, 0xDD2CF3A0, 0xB1961EC9,
        0x0BC26E24, 0xDF0C3AD7, 0xB2806962, 0x3CB890A1,
        0x0ADD4289, 0x5514FB72, 0x9FB3A483, 0x4356550B,
        0xAF278509
    };
}
